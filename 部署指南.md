# Xs-Blog å®Œæ•´éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v1.0.3
**ä»£ç çŠ¶æ€**: âœ… å·²ä¼˜åŒ–æ„å»ºï¼Œç”Ÿäº§å°±ç»ª
**æ›´æ–°æ—¥æœŸ**: 2025-11-21

æ¬¢è¿ä½¿ç”¨ Xs-Blog ä¸ªäººä¸»é¡µç³»ç»Ÿï¼æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿå®Œæˆç³»ç»Ÿéƒ¨ç½²ã€‚

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### ç¯å¢ƒè¦æ±‚

|   è½¯ä»¶   |       ç‰ˆæœ¬è¦æ±‚       |     è¯´æ˜     |
| -------- | ------------------- | ----------- |
| Node.js | >= 14.0.0           |             |
| MySQL    | >= 5.7              | æ•°æ®åº“æœåŠ¡   |
| æ“ä½œç³»ç»Ÿ | Windows/Linux/macOS | ä»»æ„ç³»ç»Ÿå‡å¯ |

### æ£€æŸ¥ç¯å¢ƒ

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version

# æ£€æŸ¥ npm ç‰ˆæœ¬
npm --version

# æ£€æŸ¥ MySQL ç‰ˆæœ¬
mysql --version
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5æ­¥å®Œæˆï¼‰

### ç¬¬ 1 æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
# ç™»å½• MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE xsblog888 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# é€€å‡º MySQL
EXIT;

# å¯¼å…¥æ•°æ®åº“ç»“æ„
mysql -u root -p xsblog888 < database/schema.sql
```

âœ… **å®Œæˆå**ï¼šæ•°æ®åº“å·²åˆ›å»ºï¼ŒåŒ…å«é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼ˆadmin/admin123ï¼‰

---

### ç¬¬ 2 æ­¥ï¼šé…ç½®åç«¯

```bash
cd backend

# å®‰è£…ä¾èµ–
npm install --production

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env
```

**ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š**

Windows ç”¨æˆ·ï¼š
```cmd
notepad .env
```

Linux/Mac ç”¨æˆ·ï¼š
```bash
nano .env
```

**å¿…é¡»ä¿®æ”¹çš„é…ç½®é¡¹ï¼š**

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost          # æ•°æ®åº“åœ°å€
DB_USER=root              # æ•°æ®åº“ç”¨æˆ·å
DB_PASSWORD=ä½ çš„MySQLå¯†ç   # âš ï¸ å¿…é¡»ä¿®æ”¹

# JWT å¯†é’¥ï¼ˆç”¨äºç”¨æˆ·è®¤è¯ï¼‰
JWT_SECRET=è¯·ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²è‡³å°‘32ä½  # âš ï¸ å¿…é¡»ä¿®æ”¹
```

ğŸ’¡ **ç”Ÿæˆéšæœºå¯†é’¥ï¼š**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

âœ… **å®Œæˆå**ï¼šåç«¯é…ç½®å®Œæˆ

---

### ç¬¬ 3 æ­¥ï¼šé…ç½®å‰ç«¯

```bash
cd ../frontend

# å®‰è£…ä¾èµ–
npm install --production
```


**å‰ç«¯è¯´æ˜**ï¼š

  - **è‡ªåŠ¨æ£€æµ‹æ¨¡å¼**ï¼ˆæ¨èï¼‰ï¼š`PORT=3000` + `NEXT_PUBLIC_BACKEND_PORT=3001`
  - **å®Œæ•´ URL æ¨¡å¼**ï¼š`NEXT_PUBLIC_API_URL=http://åç«¯IP:3001/api`
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨åœ°å€ï¼š
  - è®¿é—® `http://119.8.116.13:3000` â†’ è‡ªåŠ¨ä½¿ç”¨ `http://119.8.116.13:3001/api`
  - è®¿é—® `https://yourdomain.com:3000` â†’ è‡ªåŠ¨ä½¿ç”¨ `https://yourdomain.com:3001/api`
- ä¿®æ”¹é…ç½®ååªéœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆ

âœ… **å®Œæˆå**ï¼šå‰ç«¯é…ç½®å®Œæˆ

---

### ç¬¬ 4 æ­¥ï¼šå¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šæµ‹è¯•ç¯å¢ƒï¼ˆé€‚åˆæœ¬åœ°æµ‹è¯•ï¼‰

**å¯åŠ¨åç«¯ï¼š**
```bash
cd backend
node src/app.js
```

**å¯åŠ¨å‰ç«¯ï¼ˆæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰ï¼š**
```bash
cd frontend
npm start
```

#### æ–¹å¼äºŒï¼šç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼Œé€‚åˆæœåŠ¡å™¨éƒ¨ç½²ï¼‰

**å®‰è£… PM2ï¼š**
```bash
npm install -g pm2
```

**å¯åŠ¨åç«¯ï¼š**
```bash
cd backend
pm2 start src/app.js --name xs-blog-backend
```

**å¯åŠ¨å‰ç«¯ï¼š**
```bash
cd ../frontend
mkdir -p logs
pm2 start ecosystem.config.js
```

**ä¿å­˜é…ç½®ï¼ˆå¼€æœºè‡ªå¯ï¼‰ï¼š**
```bash
pm2 save
pm2 startup
```

âœ… **å®Œæˆå**ï¼šæœåŠ¡å·²å¯åŠ¨

---

### ç¬¬ 5 æ­¥ï¼šè®¿é—®ç³»ç»Ÿ

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- ğŸ  **å‰å°é¦–é¡µ**ï¼šhttp://localhost:3000
- ğŸ” **ç®¡ç†åå°**ï¼šhttp://localhost:3000/admins

**é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

âš ï¸ **å®‰å…¨æç¤º**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
xs-blog-release-xxx/
â”œâ”€â”€ backend/              # âœ… åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/             # âœ… åç«¯ä»£ç 
â”‚   â”œâ”€â”€ uploads/         # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ logs/            # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ backups/         # å¤‡ä»½ç›®å½•
â”‚   â”œâ”€â”€ node_modules/    # âœ… ç”Ÿäº§ä¾èµ–
â”‚   â”œâ”€â”€ package.json     # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ .env             # â­ ç¯å¢ƒå˜é‡é…ç½®
â”‚
â”œâ”€â”€ frontend/            # âœ… å‰ç«¯æœåŠ¡
â”‚   â”œâ”€â”€ .next/          # âœ… Next.js æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ public/         # é™æ€èµ„æº
â”‚   â”œâ”€â”€ node_modules/   # âœ… ç”Ÿäº§ä¾èµ–
â”‚   â”œâ”€â”€ package.json    # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ .env.production # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ CONFIG_README.md # é…ç½®è¯´æ˜æ–‡æ¡£
â”‚
â”œâ”€â”€ database/           # æ•°æ®åº“è„šæœ¬
â”‚   â””â”€â”€ schema.sql     # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚
â””â”€â”€ README.md          # é¡¹ç›®ä»‹ç»
```

---

## âš™ï¸ é…ç½®ä¿®æ”¹æŒ‡å—

### åœºæ™¯ä¸€ï¼šå‰åç«¯åŒæœåŠ¡å™¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### ä¿®æ”¹åç«¯ç«¯å£

**æ­¥éª¤ 1**: ç¼–è¾‘ `backend/.env`ï¼Œä¿®æ”¹ `PORT`ï¼š

```bash
PORT=3002
```

**æ­¥éª¤ 2**: åŒæ—¶ä¿®æ”¹ `backend/.env` ä¸­çš„ `CORS_ORIGIN`ï¼ˆå¦‚æœä¹‹å‰è®¾ç½®è¿‡ï¼‰ï¼š

```bash
# ä¿æŒä¸ºç©ºå³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ–°ç«¯å£
CORS_ORIGIN=
```

**æ­¥éª¤ 3**: é‡å¯æœåŠ¡ï¼š
```bash
pm2 restart xs-blog-backend
pm2 restart xs-blog-frontend
```

âœ… **æ— éœ€ä¿®æ”¹å‰ç«¯é…ç½®**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‚é…æ–°ç«¯å£ï¼

---

### åœºæ™¯äºŒï¼šå‰åç«¯åˆ†ç¦»éƒ¨ç½²

#### ä¿®æ”¹åç«¯ API åœ°å€

**æ­¥éª¤ 1**: ç¼–è¾‘ `backend/.env`ï¼Œé…ç½®å…è®¸çš„å‰ç«¯åœ°å€ï¼š

```bash
# å•ä¸ªå‰ç«¯åœ°å€
CORS_ORIGIN=https://frontend.yourdomain.com

# æˆ–å¤šä¸ªå‰ç«¯åœ°å€ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
CORS_ORIGIN=https://frontend.yourdomain.com,https://www.yourdomain.com
```

**æ­¥éª¤ 2**: ç¼–è¾‘ `frontend/.env.production`ï¼Œé…ç½®åç«¯åœ°å€ï¼š

```bash
# æ–¹å¼ä¸€ï¼šå®Œæ•´ URLï¼ˆæ¨èï¼‰
NEXT_PUBLIC_API_URL=https://backend.yourdomain.com/api

# æ–¹å¼äºŒï¼šæ‹†åˆ†é…ç½®
NEXT_PUBLIC_API_HOST=backend.yourdomain.com
NEXT_PUBLIC_API_PORT=3001
NEXT_PUBLIC_API_PROTOCOL=https
```

**æ­¥éª¤ 3**: é‡å¯æœåŠ¡ï¼š
```bash
pm2 restart xs-blog-backend
pm2 restart xs-blog-frontend
```

---

### é…ç½®ä¼˜å…ˆçº§è¯´æ˜

#### åç«¯ CORS é…ç½®ä¼˜å…ˆçº§ï¼š
1. âœ… **è®¾ç½®äº† `CORS_ORIGIN`**ï¼šä½¿ç”¨æŒ‡å®šçš„åœ°å€
2. âœ… **æœªè®¾ç½® `CORS_ORIGIN`**ï¼šè‡ªåŠ¨å…è®¸åŒåŸŸåè¯·æ±‚

#### å‰ç«¯ API é…ç½®ä¼˜å…ˆçº§ï¼š
1. âœ… **è®¾ç½®äº† `NEXT_PUBLIC_API_URL`**ï¼šä½¿ç”¨æŒ‡å®šçš„å®Œæ•´ URL
2. âœ… **è®¾ç½®äº†æ‹†åˆ†é…ç½®**ï¼šä½¿ç”¨ `NEXT_PUBLIC_API_HOST` + `PORT` + `PROTOCOL`
3. âœ… **æœªè®¾ç½®ä»»ä½•é…ç½®**ï¼šè‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸå + 3001 ç«¯å£

---

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨

**é”™è¯¯æç¤º**ï¼š`EADDRINUSE: address already in use`

**è§£å†³æ–¹æ³•**ï¼š

Windowsï¼š
```cmd
netstat -ano | findstr :3001
taskkill /PID <è¿›ç¨‹ID> /F
```

Linux/Macï¼š
```bash
lsof -i :3001
kill -9 <è¿›ç¨‹ID>
```

æˆ–ä¿®æ”¹ç«¯å£ï¼ˆè§ä¸Šæ–¹é…ç½®ä¿®æ”¹æŒ‡å—ï¼‰

---

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯æç¤º**ï¼š`connect ECONNREFUSED`

**æ£€æŸ¥æ¸…å•**ï¼š
- âœ… MySQL æœåŠ¡æ˜¯å¦è¿è¡Œ
- âœ… `.env` ä¸­æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
- âœ… æ•°æ®åº“ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- âœ… æ•°æ®åº“ `xsblog888` æ˜¯å¦å·²åˆ›å»º

**æµ‹è¯•è¿æ¥**ï¼š
```bash
mysql -u root -p -e "SHOW DATABASES;"
```

---

### 3. å‰ç«¯æ— æ³•è®¿é—®åç«¯

**æ£€æŸ¥æ¸…å•**ï¼š
- âœ… åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨
- âœ… é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†ç«¯å£
- âœ… æœåŠ¡å™¨å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ç«¯å£

**å‰åç«¯åŒæœåŠ¡å™¨éƒ¨ç½²**ï¼š
- âœ… æ£€æŸ¥ `.env.production` æ˜¯å¦ä¸ºç©ºé…ç½®ï¼ˆåº”è¯¥ä¸ºç©ºï¼Œç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ï¼‰
- âœ… æ£€æŸ¥åç«¯ `CORS_ORIGIN` æ˜¯å¦ä¸ºç©ºï¼ˆåº”è¯¥ä¸ºç©ºï¼‰

**å‰åç«¯åˆ†ç¦»éƒ¨ç½²**ï¼š
- âœ… æ£€æŸ¥ `frontend/.env.production` ä¸­ `NEXT_PUBLIC_API_URL` æ˜¯å¦æ­£ç¡®
- âœ… æ£€æŸ¥ `backend/.env` ä¸­ `CORS_ORIGIN` æ˜¯å¦åŒ…å«å‰ç«¯åœ°å€

---

### 4. PM2 è¿›ç¨‹ç®¡ç†

#### åŸºç¡€å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 list
pm2 ls        # ç®€å†™

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show xs-blog-backend
pm2 info xs-blog-backend

# æŸ¥çœ‹è¿›ç¨‹ç›‘æ§é¢æ¿
pm2 monit
```

#### å¯åŠ¨å’Œåœæ­¢

```bash
# å¯åŠ¨åº”ç”¨
pm2 start src/app.js --name xs-blog-backend

# åœæ­¢æœåŠ¡
pm2 stop xs-blog-backend
pm2 stop all              # åœæ­¢æ‰€æœ‰

# é‡å¯æœåŠ¡
pm2 restart xs-blog-backend
pm2 restart all           # é‡å¯æ‰€æœ‰

# é‡è½½æœåŠ¡ï¼ˆ0ç§’åœæœºï¼‰
pm2 reload xs-blog-backend

# åˆ é™¤è¿›ç¨‹
pm2 delete xs-blog-backend
pm2 delete all            # åˆ é™¤æ‰€æœ‰
```

#### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs xs-blog-backend
pm2 logs                  # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—

# æŸ¥çœ‹æœ€è¿‘ N è¡Œæ—¥å¿—
pm2 logs xs-blog-backend --lines 100

# æ¸…ç©ºæ—¥å¿—
pm2 flush xs-blog-backend
pm2 flush                 # æ¸…ç©ºæ‰€æœ‰æ—¥å¿—

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs xs-blog-backend --err

# æŸ¥çœ‹è¾“å‡ºæ—¥å¿—
pm2 logs xs-blog-backend --out
```

#### è¿›ç¨‹ç®¡ç†

```bash
# ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# ç„¶åæŒ‰ç…§æç¤ºæ‰§è¡Œå‘½ä»¤

# å–æ¶ˆå¼€æœºè‡ªå¯
pm2 unstartup

# æ›´æ–° PM2
pm2 update

# é‡ç½®é‡å¯æ¬¡æ•°
pm2 reset xs-blog-backend
```

#### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ
pm2 monit

# æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯
pm2 describe xs-blog-backend

# æŸ¥çœ‹è¿›ç¨‹ ID
pm2 id xs-blog-backend
```

#### æ‰¹é‡æ“ä½œ

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
pm2 restart all

# åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all

# åˆ é™¤æ‰€æœ‰æœåŠ¡
pm2 delete all

# é‡è½½æ‰€æœ‰æœåŠ¡
pm2 reload all
```

#### å¸¸ç”¨ç»„åˆå‘½ä»¤

```bash
# é‡å¯å¹¶æŸ¥çœ‹æ—¥å¿—
pm2 restart xs-blog-backend && pm2 logs xs-blog-backend

# åœæ­¢ã€åˆ é™¤ã€é‡æ–°å¯åŠ¨
pm2 delete xs-blog-backend && pm2 start src/app.js --name xs-blog-backend

# æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—
pm2 list && pm2 logs xs-blog-backend --lines 50
```

#### ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
pm2 start ecosystem.config.js

# æŒ‡å®šç¯å¢ƒå˜é‡å¯åŠ¨
pm2 start src/app.js --name xs-blog-backend --env production

# é‡å¯å¹¶åº”ç”¨æ–°ç¯å¢ƒå˜é‡
pm2 restart xs-blog-backend --update-env
```

#### æ•…éšœæ’æŸ¥

```bash
# æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œ
pm2 list | grep xs-blog

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
pm2 logs xs-blog-backend --err --lines 50

# æŸ¥çœ‹è¿›ç¨‹é‡å¯æ¬¡æ•°
pm2 list

# å¦‚æœè¿›ç¨‹é¢‘ç¹é‡å¯ï¼ŒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 describe xs-blog-backend
```

ğŸ’¡ **å¸¸ç”¨åœºæ™¯**ï¼š

**åœºæ™¯ä¸€ï¼šä¿®æ”¹é…ç½®åé‡å¯**
```bash
pm2 restart xs-blog-backend
pm2 logs xs-blog-backend
```

**åœºæ™¯äºŒï¼šæŸ¥çœ‹æœåŠ¡çŠ¶æ€**
```bash
pm2 list
pm2 monit
```

**åœºæ™¯ä¸‰ï¼šæ’æŸ¥é”™è¯¯**
```bash
pm2 logs xs-blog-backend --err --lines 100
```

**åœºæ™¯å››ï¼šå®Œå…¨é‡æ–°éƒ¨ç½²**
```bash
pm2 delete xs-blog-backend
pm2 delete xs-blog-frontend
cd backend && pm2 start src/app.js --name xs-blog-backend
cd ../frontend && mkdir -p logs && pm2 start ecosystem.config.js
pm2 save
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. âœ… **ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç **
2. âœ… **ä½¿ç”¨å¼ºå¯†ç çš„ JWT_SECRET**ï¼ˆè‡³å°‘32ä½éšæœºå­—ç¬¦ï¼‰
3. âœ… **ç”Ÿäº§ç¯å¢ƒå¯ç”¨ HTTPS**
4. âœ… **å®šæœŸå¤‡ä»½æ•°æ®åº“**
5. âœ… **é™åˆ¶æ•°æ®åº“è¿œç¨‹è®¿é—®**
6. âœ… **é…ç½®æœåŠ¡å™¨é˜²ç«å¢™**

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æ“ä½œç³»ç»Ÿç‰ˆæœ¬
2. Node.js ç‰ˆæœ¬ï¼ˆ`node --version`ï¼‰
3. é”™è¯¯æ—¥å¿—æˆªå›¾
4. è¯¦ç»†æ“ä½œæ­¥éª¤

---

## ğŸ“ ç³»ç»Ÿä¿¡æ¯

**ç‰ˆæœ¬**: v1.0.3
**å‘å¸ƒæ—¥æœŸ**: 2025-11-21


---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
