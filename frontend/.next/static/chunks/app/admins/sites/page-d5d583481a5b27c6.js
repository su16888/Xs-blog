(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{53742:function(e,s,t){Promise.resolve().then(t.bind(t,82749))},82749:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(57437),r=t(2265),i=t(99376),l=t(71837),n=t(20441),o=t(99950),c=t(69853);function d(){(0,n.T)("网站导航管理");let e=(0,i.useRouter)(),[s,t]=(0,r.useState)(null),[d,m]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[u,p]=(0,r.useState)(!0),[g,b]=(0,r.useState)("sites"),[y,v]=(0,r.useState)(null),[j,f]=(0,r.useState)(!1),[N,w]=(0,r.useState)({name:"",link:"",description:"",logo:"",sort_order:0,is_frontend_visible:!0,category_id:null,is_recommended:!1,is_dashboard_visible:!1}),[_,k]=(0,r.useState)(null),[C,L]=(0,r.useState)(!1),[S,F]=(0,r.useState)({name:"",description:"",icon:"",sort_order:0,is_visible:!0}),[D,I]=(0,r.useState)(""),[E,A]=(0,r.useState)(!1),[P,V]=(0,r.useState)({show:!1,type:"success",message:""});(0,r.useEffect)(()=>{q()},[]);let q=async()=>{try{if(!localStorage.getItem("token")){e.push((0,c.V9)("login"));return}let s=await (0,l.tse)();t(s),await Promise.all([R(),B()])}catch(s){localStorage.removeItem("token"),localStorage.removeItem("user"),e.push((0,c.V9)("login"))}finally{p(!1)}},R=async()=>{try{let e=await (0,l.f8h)();if(e.success){let s=Array.isArray(e.data)?e.data:[];m(s)}}catch(e){V({show:!0,type:"error",message:"加载网站导航失败"}),m([])}},B=async()=>{try{let e=await (0,l.v5P)();if(e.success){let s=Array.isArray(e.data)?e.data:[];h(s)}}catch(e){console.error("加载导航分类失败:",e),h([])}},G=e=>{let{name:s,value:t,type:a}=e.target,r=e.target.checked,i=t;"checkbox"===a?i=r:"sort_order"===s?i=parseInt(t)||0:"category_id"===s&&(i=""===t?null:parseInt(t)),w({...N,[s]:i})},O=async e=>{var s,t,a;let r=null===(s=e.target.files)||void 0===s?void 0:s[0];if(r){A(!0);try{let e=await (0,l.CGE)(r);e.success&&(w({...N,logo:e.data.url}),V({show:!0,type:"success",message:"Logo上传成功"}))}catch(e){V({show:!0,type:"error",message:(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Logo上传失败"})}finally{A(!1)}}},T=async()=>{if(N.logo&&N.logo.startsWith("/uploads/"))try{await (0,l.k0S)(N.logo)}catch(e){console.error("删除网站Logo文件失败:",e)}w({...N,logo:""}),V({show:!0,type:"success",message:"Logo删除成功"})},U=async e=>{e.preventDefault();try{(null==y?void 0:y.id)?(await (0,l.kTP)(y.id,N)).success&&(V({show:!0,type:"success",message:"网站更新成功"}),await R(),W()):(await (0,l.lip)(N)).success&&(V({show:!0,type:"success",message:"网站添加成功"}),await R(),W())}catch(e){var s,t;V({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"操作失败"})}},H=e=>{v(e),w({name:e.name,link:e.link,description:e.description||"",logo:e.logo||"",sort_order:e.sort_order||0,is_frontend_visible:void 0===e.is_frontend_visible||e.is_frontend_visible,category_id:e.category_id||null,is_recommended:e.is_recommended||!1,is_dashboard_visible:e.is_dashboard_visible||!1}),f(!0)},J=async e=>{if(confirm("确定要删除这个网站吗？"))try{(await (0,l.VX8)(e)).success&&(V({show:!0,type:"success",message:"网站删除成功"}),await R())}catch(e){var s,t;V({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败"})}},W=()=>{w({name:"",link:"",description:"",logo:"",sort_order:0,is_frontend_visible:!0,category_id:null,is_recommended:!1}),v(null),f(!1)},X=e=>{let{name:s,value:t,type:a}=e.target,r=e.target.checked,i=t;"checkbox"===a?i=r:"sort_order"===s&&(i=parseInt(t)||0),F({...S,[s]:i})},Z=async e=>{if(e.preventDefault(),!S.name.trim()){V({show:!0,type:"error",message:"分类名称不能为空"});return}try{(null==_?void 0:_.id)?(await (0,l.vt2)(_.id,S)).success&&(V({show:!0,type:"success",message:"分类更新成功"}),await B(),K()):(await (0,l.d24)(S)).success&&(V({show:!0,type:"success",message:"分类添加成功"}),await B(),K())}catch(e){var s,t;V({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"操作失败"})}},$=e=>{k(e),F({name:e.name,description:e.description||"",icon:e.icon||"",sort_order:e.sort_order||0,is_visible:void 0===e.is_visible||e.is_visible}),L(!0)},z=async e=>{if(confirm("确定要删除这个分类吗？如果有站点使用此分类，将无法删除。"))try{(await (0,l.l7u)(e)).success&&(V({show:!0,type:"success",message:"分类删除成功"}),await B())}catch(e){var s,t;V({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败"})}},K=()=>{F({name:"",description:"",icon:"",sort_order:0,is_visible:!0}),k(null),L(!1)};return u?null:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("nav",{className:"bg-white shadow-sm",children:(0,a.jsx)("div",{className:"max-w-5xl mx-auto px-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>e.push((0,c.V9)("dashboard")),className:"text-gray-600 hover:text-gray-900",children:"← 返回"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"网站导航管理"})]})})})}),P.show&&(0,a.jsx)(o.Z,{message:P.message,type:P.type,onClose:()=>V({...P,show:!1})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>b("sites"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("sites"===g?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"网站导航管理"}),(0,a.jsx)("button",{onClick:()=>b("categories"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("categories"===g?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"导航分类管理"})]})}),"sites"===g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{onClick:()=>f(!j),className:"btn btn-primary",children:j?"取消":"+ 添加网站"})}),j&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:y?"编辑网站":"添加网站"}),(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"网站名称"}),(0,a.jsx)("input",{id:"name",name:"name",type:"text",required:!0,value:N.name,onChange:G,className:"input",placeholder:"例如：GitHub"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"link",className:"block text-sm font-medium text-gray-700 mb-2",children:"网站地址"}),(0,a.jsx)("input",{id:"link",name:"link",type:"url",required:!0,value:N.link,onChange:G,className:"input",placeholder:"https://..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"描述 (可选)"}),(0,a.jsx)("textarea",{id:"description",name:"description",rows:3,value:N.description,onChange:G,className:"input",placeholder:"简单描述这个网站..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo (可选)"}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[N.logo&&(0,a.jsx)("div",{className:"flex-shrink-0 w-16 h-16 flex items-center justify-center bg-gray-50 rounded border border-gray-200",children:(0,a.jsx)("img",{src:(0,l.Jn$)(N.logo),alt:"Logo",className:"max-w-full max-h-full object-contain"})}),(0,a.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[!N.logo&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"file",id:"logoInput",accept:"image/*",onChange:O,disabled:E,className:"hidden"}),(0,a.jsx)("label",{htmlFor:"logoInput",className:"px-4 py-2 bg-blue-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-blue-600 hover:shadow-md text-xs cursor-pointer whitespace-nowrap ".concat(E?"opacity-50 cursor-not-allowed":""),children:E?"上传中...":"选择文件"})]}),(0,a.jsx)("input",{id:"logo",name:"logo",type:"text",value:N.logo,onChange:G,placeholder:"Logo URL",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white placeholder-gray-400"})]}),N.logo&&(0,a.jsx)("button",{type:"button",onClick:T,className:"flex-shrink-0 px-3 py-2 bg-red-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-red-600 hover:shadow-md text-xs whitespace-nowrap",children:"删除"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"上传Logo图片或输入自定义URL"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"导航分类"}),(0,a.jsxs)("select",{id:"category_id",name:"category_id",value:N.category_id||"",onChange:G,className:"input",children:[(0,a.jsx)("option",{value:"",children:"未分类"}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.icon?"".concat(e.icon," "):"",e.name]},e.id))]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"选择导航所属的分类，未选择则不会在前台分类展示中显示"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"sort_order",className:"block text-sm font-medium text-gray-700 mb-2",children:"排序 (可选)"}),(0,a.jsx)("input",{id:"sort_order",name:"sort_order",type:"number",value:N.sort_order,onChange:G,className:"input",placeholder:"0"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"is_frontend_visible",name:"is_frontend_visible",type:"checkbox",checked:N.is_frontend_visible,onChange:G,className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"is_frontend_visible",className:"ml-2 text-sm font-medium text-gray-700",children:"在前端展示（勾选后前后台都显示，不勾选只在后台显示）"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"is_recommended",name:"is_recommended",type:"checkbox",checked:N.is_recommended,onChange:G,className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"is_recommended",className:"ml-2 text-sm font-medium text-gray-700",children:'推荐导航（勾选后会在"导航推荐"区块中显示）'})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"is_dashboard_visible",name:"is_dashboard_visible",type:"checkbox",checked:N.is_dashboard_visible,onChange:G,className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"is_dashboard_visible",className:"ml-2 text-sm font-medium text-gray-700",children:"在后台首页显示（勾选后会在后台首页的常用导航中显示，最多6个）"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",children:y?"更新":"添加"}),(0,a.jsx)("button",{type:"button",onClick:W,className:"btn btn-secondary",children:"取消"})]})]})]}),d.length>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("input",{type:"text",placeholder:"搜索网站名称、链接或描述...",value:D,onChange:e=>I(e.target.value),className:"input w-full"})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4",children:["已添加的网站",D&&d.filter(e=>{var s;let t=D.toLowerCase();return e.name.toLowerCase().includes(t)||e.link.toLowerCase().includes(t)||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(t))}).length>0&&(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(找到 ",d.filter(e=>{var s;let t=D.toLowerCase();return e.name.toLowerCase().includes(t)||e.link.toLowerCase().includes(t)||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(t))}).length," 个结果)"]})]}),0===d.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"还没有添加任何网站"}):(()=>{let e=d.filter(e=>{var s;if(!D.trim())return!0;let t=D.toLowerCase();return e.name.toLowerCase().includes(t)||e.link.toLowerCase().includes(t)||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(t))});return 0===e.length?(0,a.jsxs)("p",{className:"text-gray-500 text-center py-8",children:['没有找到匹配 "',D,'" 的网站']}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("div",{className:"flex items-start justify-between py-4 first:pt-0 last:pb-0",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),void 0!==e.sort_order&&(0,a.jsxs)("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["排序: ",e.sort_order]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(!1!==e.is_frontend_visible?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:!1!==e.is_frontend_visible?"前后台":"仅后台"})]}),(0,a.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary-600 hover:underline",children:e.link}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>H(e),className:"btn btn-secondary text-sm",children:"编辑"}),(0,a.jsx)("button",{onClick:()=>e.id&&J(e.id),className:"btn bg-red-600 hover:bg-red-700 text-white text-sm",children:"删除"})]})]},e.id))})})()]})]}),"categories"===g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{onClick:()=>L(!C),className:"btn btn-primary",children:C?"取消":"+ 添加分类"})}),C&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:_?"编辑分类":"添加分类"}),(0,a.jsxs)("form",{onSubmit:Z,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["分类名称 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"name",value:S.name,onChange:X,className:"input",placeholder:"例如：开发工具",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分类描述"}),(0,a.jsx)("textarea",{name:"description",value:S.description,onChange:X,rows:3,className:"input",placeholder:"分类的详细描述"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分类图标"}),(0,a.jsx)("input",{type:"text",name:"icon",value:S.icon,onChange:X,className:"input",placeholder:"例如：\uD83D\uDCBB 或 emoji 表情"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"可以使用 emoji 表情作为图标"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"排序顺序"}),(0,a.jsx)("input",{type:"number",name:"sort_order",value:S.sort_order,onChange:X,className:"input",placeholder:"数字越小越靠前"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",name:"is_visible",checked:S.is_visible,onChange:X,className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),(0,a.jsx)("label",{className:"ml-2 text-sm font-medium text-gray-700",children:"前端可见"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",children:_?"更新":"添加"}),(0,a.jsx)("button",{type:"button",onClick:K,className:"btn btn-secondary",children:"取消"})]})]})]}),(0,a.jsxs)("div",{className:"card overflow-hidden",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4 px-6 pt-6",children:"分类列表"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"图标"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"名称"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"描述"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"排序"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===x.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"暂无分类数据"})}):x.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-2xl",children:e.icon||"\uD83D\uDCC1"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:e.description||"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.sort_order}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.is_visible?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_visible?"可见":"隐藏"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>$(e),className:"text-primary-600 hover:text-primary-900 mr-4",children:"编辑"}),(0,a.jsx)("button",{onClick:()=>e.id&&z(e.id),className:"text-red-600 hover:text-red-900",children:"删除"})]})]},e.id))})]})})]})]})]})})]})}}},function(e){e.O(0,[660,278,833,543,811,351,744],function(){return e(e.s=53742)}),_N_E=e.O()}]);