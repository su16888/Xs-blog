(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[474],{70403:function(e,s,t){Promise.resolve().then(t.bind(t,44038))},44038:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var a=t(57437),l=t(2265),r=t(99376),n=t(71837),i=t(20441),o=t(99950),c=t(69853),d=t(33182);function m(){(0,i.T)("社交链接管理");let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(null),[m,u]=(0,l.useState)([]),[h,x]=(0,l.useState)(!0),[p,g]=(0,l.useState)(null),[b,f]=(0,l.useState)(!1),[y,j]=(0,l.useState)({platform:"",account:"",link:"",icon:"",qrcode:"",show_in_profile:!1}),[v,w]=(0,l.useState)({show:!1,type:"success",message:""}),[N,k]=(0,l.useState)(!1),[_,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{q()},[]);let q=async()=>{try{if(!localStorage.getItem("token")){e.push((0,c.V9)("login"));return}let s=await (0,n.tse)();t(s),await S()}catch(s){localStorage.removeItem("token"),localStorage.removeItem("user"),e.push((0,c.V9)("login"))}finally{x(!1)}},S=async()=>{try{let e=await (0,n.ldR)();if(e.success){let s=Array.isArray(e.data)?e.data:[];u(s)}}catch(e){console.error("Failed to load social links:",e),u([])}},F=e=>{j({...y,[e.target.name]:e.target.value})},I=async e=>{e.preventDefault();try{(null==p?void 0:p.id)?(await (0,n.zlg)(p.id,y)).success&&(w({show:!0,type:"success",message:"社交链接更新成功"}),await S(),z()):(await (0,n.H6F)(y)).success&&(w({show:!0,type:"success",message:"社交链接添加成功"}),await S(),z())}catch(e){var s,t;w({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"操作失败"})}},L=e=>{g(e),j({platform:e.platform,account:e.account,link:e.link||"",icon:e.icon||"",qrcode:e.qrcode||"",show_in_profile:e.show_in_profile||!1}),f(!0)},T=async e=>{if(confirm("确定要删除这个社交链接吗？"))try{(await (0,n.ZhF)(e)).success&&(w({show:!0,type:"success",message:"社交链接删除成功"}),await S())}catch(e){var s,t;w({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败"})}},z=()=>{j({platform:"",account:"",link:"",icon:"",qrcode:"",show_in_profile:!1}),g(null),f(!1)},P=async e=>{var s,t,a;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(l){k(!0);try{let s=await (0,n.TXj)(l);s.success&&(j({...y,icon:s.data.url}),w({show:!0,type:"success",message:"图标上传成功"}),e.target.value="")}catch(e){w({show:!0,type:"error",message:(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"图标上传失败"})}finally{k(!1)}}},R=async e=>{var s,t,a;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(l){C(!0);try{let s=await (0,n.PP9)(l);s.success&&(j({...y,qrcode:s.data.url}),w({show:!0,type:"success",message:"二维码上传成功"}),e.target.value="")}catch(e){w({show:!0,type:"error",message:(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"二维码上传失败"})}finally{C(!1)}}};return h?null:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[v.show&&(0,a.jsx)(o.Z,{message:v.message,type:v.type,onClose:()=>w({...v,show:!1})}),(0,a.jsx)("nav",{className:"bg-white shadow-sm",children:(0,a.jsx)("div",{className:"max-w-5xl mx-auto px-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>e.push((0,c.V9)("dashboard")),className:"text-gray-600 hover:text-gray-900",children:"← 返回"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"社交链接管理"})]})})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{onClick:()=>f(!b),className:"btn btn-primary",children:b?"取消":"+ 添加社交链接"})}),b&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:p?"编辑社交链接":"添加社交链接"}),(0,a.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"platform",className:"block text-sm font-medium text-gray-700 mb-2",children:"平台名称"}),(0,a.jsx)("input",{id:"platform",name:"platform",type:"text",required:!0,value:y.platform,onChange:F,className:"input",placeholder:"例如：GitHub, Twitter, LinkedIn"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"account",className:"block text-sm font-medium text-gray-700 mb-2",children:"账号/用户名"}),(0,a.jsx)("input",{id:"account",name:"account",type:"text",required:!0,value:y.account,onChange:F,className:"input",placeholder:"例如：yourusername"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"link",className:"block text-sm font-medium text-gray-700 mb-2",children:"链接地址 (可选)"}),(0,a.jsx)("input",{id:"link",name:"link",type:"url",value:y.link,onChange:F,className:"input",placeholder:"https://..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"icon",className:"block text-sm font-medium text-gray-700 mb-2",children:"图标 (可选)"}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[y.icon&&(0,a.jsx)("div",{className:"flex-shrink-0 w-16 h-16 flex items-center justify-center bg-gray-50 rounded border border-gray-200",children:(0,a.jsx)("img",{src:y.icon,alt:"图标",className:"max-w-full max-h-full object-contain"})}),(0,a.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[!y.icon&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"file",id:"iconInput",accept:".jpg,.jpeg,.png,.gif,.webp,.svg",onChange:P,disabled:N,className:"hidden"}),(0,a.jsx)("label",{htmlFor:"iconInput",className:"px-4 py-2 bg-blue-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-blue-600 hover:shadow-md text-xs cursor-pointer whitespace-nowrap ".concat(N?"opacity-50 cursor-not-allowed":""),children:N?"上传中...":"选择文件"})]}),(0,a.jsx)("input",{id:"icon",name:"icon",type:"text",value:y.icon,onChange:F,placeholder:"图标 URL",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white placeholder-gray-400"})]}),y.icon&&(0,a.jsx)("button",{type:"button",onClick:()=>{j({...y,icon:""}),w({show:!0,type:"success",message:"图标删除成功"})},className:"flex-shrink-0 px-3 py-2 bg-red-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-red-600 hover:shadow-md text-xs whitespace-nowrap",children:"删除"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"支持 jpg、png、gif、webp、svg 格式"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"qrcode",className:"block text-sm font-medium text-gray-700 mb-2",children:"二维码图片 (可选)"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"上传二维码后，前台点击社交链接将显示二维码弹窗，不会跳转URL"}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[y.qrcode&&(0,a.jsx)("div",{className:"flex-shrink-0 w-20 h-20 flex items-center justify-center bg-gray-50 rounded border border-gray-200",children:(0,a.jsx)("img",{src:y.qrcode,alt:"二维码",className:"w-full h-full object-contain"})}),(0,a.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[!y.qrcode&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"file",id:"qrcodeInput",accept:".jpg,.jpeg,.png,.gif,.webp,.svg",onChange:R,disabled:_,className:"hidden"}),(0,a.jsx)("label",{htmlFor:"qrcodeInput",className:"px-4 py-2 bg-blue-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-blue-600 hover:shadow-md text-xs cursor-pointer whitespace-nowrap ".concat(_?"opacity-50 cursor-not-allowed":""),children:_?"上传中...":"选择文件"})]}),(0,a.jsx)("input",{id:"qrcode",name:"qrcode",type:"text",value:y.qrcode,onChange:F,placeholder:"二维码图片 URL",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white placeholder-gray-400"})]}),y.qrcode&&(0,a.jsx)("button",{type:"button",onClick:()=>{j({...y,qrcode:""}),w({show:!0,type:"success",message:"二维码删除成功"})},className:"flex-shrink-0 px-3 py-2 bg-red-500 text-white rounded-lg font-medium transition-all duration-300 hover:bg-red-600 hover:shadow-md text-xs whitespace-nowrap",children:"删除"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"支持 jpg、png、gif、webp、svg 格式"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",id:"show_in_profile",name:"show_in_profile",checked:y.show_in_profile||!1,onChange:e=>j({...y,show_in_profile:e.target.checked}),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"在个人资料卡片中显示（最多显示6个），博客模式下建议只选择4个！"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"勾选后，此社交链接将显示在博客主题的个人资料卡片下方，图标会根据数量自动调整大小和间距"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",children:p?"更新":"添加"}),(0,a.jsx)("button",{type:"button",onClick:z,className:"btn btn-secondary",children:"取消"})]})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"已添加的社交链接"}),0===m.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"还没有添加任何社交链接"}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:m.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between py-4 first:pt-0 last:pb-0",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1 mr-3",children:[(0,a.jsx)("button",{onClick:async()=>{if(0===s)return;let e=[...m],t=e[s];e[s]=e[s-1],e[s-1]=t,u(e);try{let s=e.map((e,s)=>({id:e.id,sort_order:s}));await (0,d.wz)("/api/admin/social-links/sort/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({sortData:s})})}catch(e){console.error("Failed to update sort order:",e)}},disabled:0===s,className:"p-1 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"上移",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),(0,a.jsx)("button",{onClick:async()=>{if(s===m.length-1)return;let e=[...m],t=e[s];e[s]=e[s+1],e[s+1]=t,u(e);try{let s=e.map((e,s)=>({id:e.id,sort_order:s}));await (0,d.wz)("/api/admin/social-links/sort/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({sortData:s})})}catch(e){console.error("Failed to update sort order:",e)}},disabled:s===m.length-1,className:"p-1 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"下移",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.platform}),e.show_in_profile&&(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs bg-primary-100 text-primary-700 rounded-full",children:"显示在资料卡"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["账号：",e.account]}),e.link&&(0,a.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary-600 hover:underline",children:e.link})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>L(e),className:"btn btn-secondary text-sm",children:"编辑"}),(0,a.jsx)("button",{onClick:()=>e.id&&T(e.id),className:"btn bg-red-600 hover:bg-red-700 text-white text-sm",children:"删除"})]})]},e.id))})]})]})})]})}}},function(e){e.O(0,[660,278,833,543,811,351,744],function(){return e(e.s=70403)}),_N_E=e.O()}]);