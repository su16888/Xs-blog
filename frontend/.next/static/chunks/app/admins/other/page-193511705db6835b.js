(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62],{10265:function(e,s,t){Promise.resolve().then(t.bind(t,47168))},47168:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var a=t(57437),r=t(2265),l=t(99376),c=t(71837),n=t(20441),d=t(69853),i=t(99950);function o(){var e;(0,n.T)("留言管理");let s=(0,l.useRouter)(),[t,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(!0),[u,h]=(0,r.useState)("messages"),[g,p]=(0,r.useState)([]),[y,b]=(0,r.useState)([]),[v,j]=(0,r.useState)(!1),[N,f]=(0,r.useState)(null),[w,k]=(0,r.useState)(""),[C,_]=(0,r.useState)(null),[S,E]=(0,r.useState)({show:!1,type:"success",message:""});(0,r.useEffect)(()=>{I()},[]),(0,r.useEffect)(()=>{"messages"===u?F():"message-categories"===u&&R()},[u]);let I=async()=>{try{if(!localStorage.getItem("token")){s.push((0,d.V9)("login"));return}let e=await (0,c.tse)();o(e)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user"),s.push((0,d.V9)("login"))}finally{m(!1)}},F=async()=>{j(!0);try{let e=await (0,c.yRm)();e.success&&e.data?p(e.data.messages||[]):p([])}catch(e){console.error("Failed to load messages:",e),p([])}finally{j(!1)}},R=async()=>{try{let e=await (0,c.HXp)();e.success&&e.data&&b(e.data)}catch(e){console.error("Failed to load message categories:",e),b([])}},V=async(e,s)=>{try{(await (0,c.Rje)(e,s)).success&&(E({show:!0,type:"success",message:"状态更新成功"}),F())}catch(e){var t,a;E({show:!0,type:"error",message:(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"更新失败"})}},D=async e=>{if(confirm("确定要删除这条留言吗？此操作不可恢复。"))try{(await (0,c.cwm)(e)).success&&(E({show:!0,type:"success",message:"留言删除成功"}),F())}catch(e){var s,t;E({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败"})}},L=async()=>{if(!w.trim()){E({show:!0,type:"error",message:"分类名称不能为空"});return}try{(await (0,c.Cxh)({name:w})).success&&(E({show:!0,type:"success",message:"分类创建成功"}),k(""),R())}catch(t){var e,s;E({show:!0,type:"error",message:(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"创建失败"})}},M=async e=>{try{(await (0,c.qEl)(e.id,{name:e.name,sort_order:e.sort_order})).success&&(E({show:!0,type:"success",message:"分类更新成功"}),_(null),R())}catch(e){var s,t;E({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"更新失败"})}},O=async e=>{if(confirm("确定要删除这个分类吗？此操作不可恢复。"))try{(await (0,c.cnu)(e)).success&&(E({show:!0,type:"success",message:"分类删除成功"}),R())}catch(e){var s,t;E({show:!0,type:"error",message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败"})}},P=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"read":return"bg-blue-100 text-blue-800";case"replied":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return x?null:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[S.show&&(0,a.jsx)(i.Z,{message:S.message,type:S.type,onClose:()=>E({...S,show:!1})}),(0,a.jsx)("nav",{className:"bg-white shadow-sm",children:(0,a.jsx)("div",{className:"max-w-5xl mx-auto px-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>s.push((0,d.V9)("dashboard")),className:"text-gray-600 hover:text-gray-900",children:"← 返回"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"留言管理"})]})})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 mb-6",children:[(0,a.jsxs)("div",{className:"flex space-x-4 border-b border-gray-200",children:[(0,a.jsx)("button",{onClick:()=>h("messages"),className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors ".concat("messages"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"留言列表"}),(0,a.jsx)("button",{onClick:()=>h("message-categories"),className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors ".concat("message-categories"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"留言分类"})]}),"messages"===u&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"留言列表"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["留言提交页面：",(0,a.jsx)("a",{href:"/messages",target:"_blank",className:"text-blue-600 hover:text-blue-800",children:"/messages"})]})]}),v?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"加载中..."})]}):0===g.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无留言"}):(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg border border-gray-200 max-h-96 overflow-y-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>{var s;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.contact}),(0,a.jsx)("div",{className:"text-xs text-gray-400 font-mono",children:e.ip_address})]})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:(null===(s=e.MessageCategory)||void 0===s?void 0:s.name)||"未分类"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsxs)("select",{value:e.status,onChange:s=>V(e.id,s.target.value),className:"text-xs font-medium rounded-full px-2.5 py-0.5 ".concat(P(e.status)," border-0 focus:ring-0"),children:[(0,a.jsx)("option",{value:"pending",children:"待处理"}),(0,a.jsx)("option",{value:"read",children:"已读"}),(0,a.jsx)("option",{value:"replied",children:"已回复"})]})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>f(e),className:"text-blue-600 hover:text-blue-900 text-sm",children:"查看"}),(0,a.jsx)("button",{onClick:()=>D(e.id),className:"text-red-600 hover:text-red-900 text-sm",children:"删除"})]})})]},e.id)})})]})}),N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"留言详情"}),(0,a.jsx)("button",{onClick:()=>f(null),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"用户称呼"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:N.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系方式"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:N.contact})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"留言分类"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:(null===(e=N.MessageCategory)||void 0===e?void 0:e.name)||"未分类"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"留言内容"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded whitespace-pre-wrap",children:N.content})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IP地址"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded font-mono",children:N.ip_address})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"提交时间"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:new Date(N.created_at).toLocaleString()})]})]})]})})]}),"message-categories"===u&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"留言分类管理"}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-md font-medium text-blue-900 mb-2",children:"添加新分类"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"输入分类名称",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{onClick:L,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"添加"})]})]}),0===y.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无分类"}):(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg border border-gray-200",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类名称"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"排序"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(null==C?void 0:C.id)===e.id?(0,a.jsx)("input",{type:"text",value:C.name,onChange:e=>_({...C,name:e.target.value}),className:"px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}):(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.name})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:(null==C?void 0:C.id)===e.id?(0,a.jsx)("input",{type:"number",value:C.sort_order,onChange:e=>_({...C,sort_order:parseInt(e.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"}):(0,a.jsx)("span",{children:e.sort_order})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsx)("div",{className:"flex space-x-2",children:(null==C?void 0:C.id)===e.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>M(C),className:"text-green-600 hover:text-green-900 text-sm",children:"保存"}),(0,a.jsx)("button",{onClick:()=>_(null),className:"text-gray-600 hover:text-gray-900 text-sm",children:"取消"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>_(e),className:"text-blue-600 hover:text-blue-900 text-sm",children:"编辑"}),(0,a.jsx)("button",{onClick:()=>O(e.id),className:"text-red-600 hover:text-red-900 text-sm",children:"删除"})]})})})]},e.id))})]})})]})]})})})]})}}},function(e){e.O(0,[660,278,833,543,811,351,744],function(){return e(e.s=10265)}),_N_E=e.O()}]);