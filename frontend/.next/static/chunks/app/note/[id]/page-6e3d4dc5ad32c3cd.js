(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{68226:function(e,r,s){Promise.resolve().then(s.bind(s,27234))},27234:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return w}});var t=s(57437),a=s(2265),o=s(99376),l=s(77906),n=s(32660),i=s(56475),d=s(62720),c=s(91723),m=s(71837),p=s(59604),x=s(29377),h=s(87310),u=s(33182),g=s(40),b=s(16093),y=s(45024),f=s(53867);let j=(0,u.bR)(),v=e=>{let r=new Date(e),s=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),l=String(r.getMinutes()).padStart(2,"0");return"".concat(s,"-").concat(t,"-").concat(a," ").concat(o,":").concat(l)};function w(){let e=(0,o.useParams)(),r=(0,o.useRouter)(),s=(0,o.useSearchParams)(),[u,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!0),[C,S]=(0,a.useState)(!1),[Z,_]=(0,a.useState)(!1),[q,P]=(0,a.useState)(""),[z,F]=(0,a.useState)(""),[B,E]=(0,a.useState)(!1),[L,M]=(0,a.useState)(!1),[T,R]=(0,a.useState)(!1),[I,U]=(0,a.useState)(!1),[H,W]=(0,a.useState)("");(0,a.useEffect)(()=>{let r=async()=>{try{var r,t,a,o;let l=s.get("password");if(l){let s=await m.ZPm.get("/notes/".concat(e.id,"?password=").concat(encodeURIComponent(l)));if((null===(r=s.data)||void 0===r?void 0:r.success)&&(null===(t=s.data)||void 0===t?void 0:t.data)){let e=s.data.data;w(e),e.requiresPassword?(_(!0),F("URL中的密码不正确，请重新输入")):(_(!1),W(l))}else S(!0)}else{let r=await m.ZPm.get("/notes/".concat(e.id));if((null===(a=r.data)||void 0===a?void 0:a.success)&&(null===(o=r.data)||void 0===o?void 0:o.data)){let e=r.data.data;w(e),e.requiresPassword&&_(!0)}else S(!0)}}catch(e){console.error("Failed to fetch note:",e),S(!0)}finally{k(!1)}};e.id&&r()},[e.id,s]),(0,a.useEffect)(()=>{u&&!u.requiresPassword?document.title="".concat(u.title||"无标题"," - Xs-Blog"):N?document.title="加载中... - Xs-Blog":C&&(document.title="笔记不存在 - Xs-Blog")},[u,N,C,H]),(0,a.useEffect)(()=>{u&&!u.requiresPassword&&A()},[u,H]);let A=async()=>{try{var r,s;let t=H?"?password=".concat(encodeURIComponent(H)):"",a=await m.ZPm.get("/notes/".concat(e.id,"/disks").concat(t));(null===(r=a.data)||void 0===r?void 0:r.success)&&(null===(s=a.data)||void 0===s?void 0:s.data)&&U(a.data.data.length>0)}catch(e){U(!1)}},D=async r=>{var s,t,a;r.preventDefault(),F(""),E(!0);try{let r=await m.ZPm.post("/notes/".concat(e.id,"/verify"),{password:q});(null===(s=r.data)||void 0===s?void 0:s.success)&&(null===(t=r.data)||void 0===t?void 0:t.data)&&(w(r.data.data),_(!1),W(q),P(""))}catch(e){(null===(a=e.response)||void 0===a?void 0:a.status)===401?F("密码错误，请重试"):F("验证失败，请稍后重试")}finally{E(!1)}},X=()=>{r.push("/")},O=e=>{r.push("/notes?tag=".concat(encodeURIComponent(e)))};return N?(0,t.jsx)("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-text-secondary",children:"加载中..."})]})}):C||!u?(0,t.jsx)("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold text-text-primary mb-4",children:"404"}),(0,t.jsx)("p",{className:"text-text-secondary mb-6",children:"笔记不存在或已被删除"}),(0,t.jsx)("button",{onClick:X,className:"px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"返回"})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-bg-primary",children:[(0,t.jsx)("nav",{className:"sticky top-0 z-50 bg-bg-secondary/80 backdrop-blur-md border-b border-border-primary shadow-sm",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,t.jsxs)("button",{onClick:X,className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors group",children:[(0,t.jsx)(n.Z,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform"}),(0,t.jsx)("span",{children:"返回"})]})})})}),(0,t.jsxs)(l.E.article,{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,t.jsxs)("header",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-text-primary leading-tight",children:u.title||"无标题"}),"original"===u.source_type&&(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700/50 rounded-md text-xs flex-shrink-0",children:[(0,t.jsx)("svg",{className:"w-3.5 h-3.5 text-green-600 dark:text-green-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{className:"text-green-700 dark:text-green-300",children:"原创"})]}),"reprint"===u.source_type&&(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-700/50 rounded-md text-xs flex-shrink-0",children:[(0,t.jsx)("svg",{className:"w-3.5 h-3.5 text-orange-600 dark:text-orange-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,t.jsx)("span",{className:"text-orange-700 dark:text-orange-300",children:"转载"})]}),I&&(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700/50 rounded-md text-xs flex-shrink-0",children:[(0,t.jsx)("svg",{className:"w-3.5 h-3.5 text-blue-600 dark:text-blue-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),(0,t.jsx)("span",{className:"text-blue-700 dark:text-blue-300",children:"含网盘资源"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 text-sm text-text-tertiary",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[u.category&&(0,t.jsxs)("div",{onClick:()=>{(null==u?void 0:u.category)&&r.push("/notes?category=".concat(encodeURIComponent(u.category)))},className:"flex items-center gap-1 px-2 py-0.5 bg-primary-100 text-primary-700 rounded text-xs font-medium cursor-pointer hover:bg-primary-200 transition-colors",title:'查看"'.concat(u.category,'"分类下的所有笔记'),children:[(0,t.jsx)(i.Z,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:u.category})]}),u.Tags&&u.Tags.length>0||u.tags?(0,t.jsxs)(t.Fragment,{children:[u.Tags&&u.Tags.length>0&&(0,t.jsx)(t.Fragment,{children:u.Tags.map(e=>(0,t.jsxs)("span",{onClick:()=>O(e.name),className:"flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium transition-colors hover:opacity-80 cursor-pointer",style:e.color?{backgroundColor:"".concat(e.color,"20"),color:e.color}:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},title:'查看"'.concat(e.name,'"标签下的所有笔记'),children:[(0,t.jsx)(d.Z,{className:"w-3 h-3"}),e.name]},e.id))}),(!u.Tags||0===u.Tags.length)&&u.tags&&(0,t.jsx)(t.Fragment,{children:u.tags.split(",").map((e,r)=>(0,t.jsxs)("span",{onClick:()=>O(e.trim()),className:"flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium cursor-pointer hover:opacity-70 transition-opacity",style:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},title:'查看"'.concat(e.trim(),'"标签下的所有笔记'),children:[(0,t.jsx)(d.Z,{className:"w-3 h-3"}),e.trim()]},r))})]}):null]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(c.Z,{className:"w-3.5 h-3.5"}),(0,t.jsx)("time",{dateTime:u.published_at||u.created_at,children:v(u.published_at||u.created_at)})]})]})]}),(0,t.jsx)("hr",{className:"border-border-primary/2 mb-8"}),(0,t.jsx)("div",{className:"bg-bg-secondary rounded-2xl p-4 sm:p-6 lg:p-8 shadow-sm border border-border-primary overflow-hidden",children:(0,t.jsxs)("div",{className:"prose prose-sm sm:prose-base lg:prose-lg max-w-none dark:prose-invert prose-headings:text-text-primary prose-headings:font-bold prose-h1:text-2xl sm:prose-h1:text-3xl prose-h1:mb-4 sm:prose-h1:mb-6 prose-h2:text-xl sm:prose-h2:text-2xl prose-h2:mb-3 sm:prose-h2:mb-4 prose-h2:mt-6 sm:prose-h2:mt-8 prose-h3:text-lg sm:prose-h3:text-xl prose-h3:mb-2 sm:prose-h3:mb-3 prose-h3:mt-4 sm:prose-h3:mt-6 prose-h4:text-base sm:prose-h4:text-lg prose-h4:mb-2 prose-h4:mt-3 sm:prose-h4:mt-4 prose-p:text-text-primary prose-p:leading-relaxed prose-p:mb-3 sm:prose-p:mb-4 prose-a:text-primary-600 dark:prose-a:text-primary-400 prose-a:no-underline hover:prose-a:underline prose-blockquote:border-l-4 prose-blockquote:border-primary-500 prose-blockquote:bg-bg-tertiary/30 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-blockquote:not-italic prose-strong:text-text-primary prose-strong:font-semibold prose-em:text-text-primary prose-em:italic prose-ul:list-disc prose-ul:pl-4 sm:prose-ul:pl-6 prose-ul:mb-4 sm:prose-ul:mb-6 prose-ol:list-decimal prose-ol:pl-4 sm:prose-ol:pl-6 prose-ol:mb-4 sm:prose-ol:mb-6 prose-li:text-text-primary prose-li:mb-1 sm:prose-li:mb-2 prose-table:w-full prose-table:border-collapse prose-table:my-4 sm:prose-table:my-6 prose-th:bg-bg-tertiary prose-th:text-text-primary prose-th:font-semibold prose-th:p-2 sm:prose-th:p-3 prose-th:border prose-th:border-border-primary prose-td:p-2 sm:prose-td:p-3 prose-td:border prose-td:border-border-primary prose-td:text-text-primary prose-img:rounded-lg sm:prose-img:rounded-xl prose-img:shadow-md sm:prose-img:shadow-lg prose-img:mx-auto max-w-full h-auto prose-hr:border-hr-color prose-hr:my-4 sm:prose-hr:my-8 whitespace-normal break-words overflow-hidden max-w-full w-full ",children:[(0,t.jsx)(p.UG,{remarkPlugins:[x.Z],rehypePlugins:[h.Z],components:{img:e=>{let{src:r,alt:s,...a}=e,o=r;return r&&r.startsWith("/uploads/")&&(o="".concat(j).concat(r)),(0,t.jsx)("div",{className:"flex justify-center my-4 sm:my-6 overflow-hidden",children:(0,t.jsx)("img",{src:o,alt:s||"",className:"max-w-full h-auto rounded-lg sm:rounded-xl shadow-md sm:shadow-lg transition-all duration-300 hover:shadow-lg sm:hover:shadow-xl hover:scale-[1.01] sm:hover:scale-[1.02]",style:{maxHeight:"400px",objectFit:"contain"},loading:"lazy",onError:e=>{e.target.style.display="none"},...a})})},iframe:e=>{let{node:r,...s}=e;return(0,t.jsx)("div",{className:"my-4 sm:my-6 rounded-lg sm:rounded-xl overflow-hidden shadow-md sm:shadow-lg",children:(0,t.jsx)("iframe",{className:"w-full aspect-video",...s})})},pre:e=>{let{node:r,children:s,...o}=e,l=a.Children.toArray(s).join("");return(0,t.jsxs)("div",{className:"relative my-6 group",children:[(0,t.jsx)("pre",{className:"bg-code-block-bg text-code-block-text p-4 rounded-xl overflow-x-auto shadow-md font-mono text-sm leading-relaxed",...o,children:s}),(0,t.jsx)(f.Z,{text:l})]})},code:e=>{let{node:r,inline:s,className:a,children:o,...l}=e;return s?(0,t.jsx)("code",{...l,children:o}):(0,t.jsx)("code",{className:"text-sm font-mono ".concat(a||""),...l,children:o})},table:e=>{let{node:r,children:s,...a}=e;return(0,t.jsx)("div",{className:"overflow-x-auto my-6 rounded-lg shadow-sm",children:(0,t.jsx)("table",{className:"w-full min-w-full",...a,children:s})})},blockquote:e=>{let{node:r,children:s,...a}=e;return(0,t.jsx)("blockquote",{className:"border-l-4 border-primary-500 bg-bg-tertiary/30 py-3 px-5 rounded-r-lg my-6 text-text-primary italic",...a,children:s})},a:e=>{let{node:r,href:s,children:a,...o}=e;return(0,t.jsx)("a",{href:s,className:"text-primary-600 dark:text-primary-400 no-underline hover:underline transition-colors duration-200 font-medium",target:"_blank",rel:"noopener noreferrer",...o,children:a})},p:e=>{let{node:r,children:s,...o}=e;return a.Children.toArray(s).some(e=>"string"==typeof e&&e.includes("\n"))?(0,t.jsx)("p",{className:"text-text-primary leading-relaxed mb-4 whitespace-normal break-words",...o,children:a.Children.map(s,(e,r)=>{if("string"==typeof e){let s=e.split("\n");return(0,t.jsx)(a.Fragment,{children:s.map((e,r)=>(0,t.jsxs)(a.Fragment,{children:[e,r<s.length-1&&(0,t.jsx)("br",{})]},r))},r)}return e})}):(0,t.jsx)("p",{className:"text-text-primary leading-relaxed mb-4 whitespace-normal break-words",...o,children:s})}},children:u.content}),"reprint"===u.source_type&&u.source_text&&(0,t.jsx)("div",{className:"mt-8 pt-6 border-t border-dashed border-border-primary/15",children:(0,t.jsxs)("div",{className:"text-sm text-text-tertiary",children:[(0,t.jsx)("span",{className:"font-medium",children:"文章来源："}),(0,t.jsx)("span",{className:"ml-1",children:u.source_text})]})})]})}),(0,t.jsxs)("div",{className:"mt-12 flex flex-wrap justify-center gap-3 sm:gap-4",children:[(0,t.jsxs)("button",{onClick:X,className:"inline-flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-bg-secondary text-text-primary rounded-lg hover:bg-bg-tertiary transition-all border border-border-primary shadow-sm hover:shadow-md",children:[(0,t.jsx)(n.Z,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"whitespace-nowrap",children:"返回列表"})]}),I&&(0,t.jsxs)("button",{onClick:()=>R(!0),className:"inline-flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all shadow-sm hover:shadow-md",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),(0,t.jsx)("span",{className:"whitespace-nowrap",children:"下载资源"})]}),(0,t.jsxs)("button",{onClick:()=>M(!0),className:"inline-flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-sm hover:shadow-md",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),(0,t.jsx)("span",{className:"whitespace-nowrap",children:"分享笔记"})]})]})]}),Z&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:(0,t.jsxs)(l.E.div,{className:"bg-bg-secondary rounded-2xl max-w-md w-full p-6 border border-border-primary shadow-2xl",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,t.jsx)("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"此笔记需要密码"}),(0,t.jsx)("p",{className:"text-sm text-text-secondary",children:"请输入访问密码以查看内容"})]}),(0,t.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"password",value:q,onChange:e=>P(e.target.value),placeholder:"请输入密码",className:"w-full px-4 py-3 border border-border-primary rounded-lg bg-bg-primary text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",autoFocus:!0,autoComplete:"current-password",disabled:B}),z&&(0,t.jsx)("p",{className:"mt-2 text-sm text-red-600",children:z})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:X,className:"flex-1 px-4 py-3 bg-bg-tertiary text-text-secondary rounded-lg hover:bg-bg-tertiary/80 transition-colors",disabled:B,children:"返回"}),(0,t.jsx)("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:B||!q,children:B?"验证中...":"确认"})]})]})]})}),L&&u&&(0,t.jsx)(g.Z,{noteId:u.id,title:u.title,password:u.password,onClose:()=>M(!1)}),u&&(0,t.jsx)(b.Z,{isOpen:T,onClose:()=>R(!1),noteId:u.id,isAdmin:!1,password:H}),(0,t.jsxs)("footer",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm text-text-tertiary border-t border-border-primary/30",children:[(0,t.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Xs-blog. All rights reserved."]}),(0,t.jsx)(y.Z,{})]})]})}}},function(e){e.O(0,[660,278,833,543,811,14,715,701,284,268,513,822,557,787,548,174,362,153,565,351,744],function(){return e(e.s=68226)}),_N_E=e.O()}]);