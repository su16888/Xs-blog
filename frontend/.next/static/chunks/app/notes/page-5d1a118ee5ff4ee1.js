(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{96205:function(e,t,r){Promise.resolve().then(r.bind(r,6711))},6711:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(57437),s=r(77906),l=r(73247),o=r(32489),n=r(56475),i=r(62720),c=r(46506),d=r(91723),m=r(2265),x=r(99376),p=r(71837),g=r(33182),u=r(58326),h=r(45024);let y=(0,g.bR)(),b=e=>{let t=new Date(e),r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(a,"-").concat(s," ").concat(l,":").concat(o)},v=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",f=e=>{if(!e)return"";let t=e;return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,"")).replace(/!\[([^\]]*)\]\[([^\]]+)\]/g,"")).replace(/!\[([^\]]+)\]/g,"")).replace(/!\s*\[/g,"")).replace(/```[\s\S]*?```/g,"")).replace(/`([^`]+)`/g,"$1")).replace(/`/g,"")).replace(/^#{1,6}\s+/gm,"")).replace(/\*\*([^\*]+)\*\*/g,"$1")).replace(/__([^_]+)__/g,"$1")).replace(/\*([^\*]+)\*/g,"$1")).replace(/_([^_]+)_/g,"$1")).replace(/~~([^~]+)~~/g,"$1")).replace(/^[\s]*[-*+]\s+/gm,"")).replace(/^[\s]*\d+\.\s+/gm,"")).replace(/^>\s+/gm,"")).replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1")).replace(/\|.*\|/g,"")).replace(/^\s*[-*_]{3,}\s*$/gm,"")).replace(/\s+/g," ").replace(/\n{3,}/g,"\n\n").replace(/\n\s*\n/g,"\n\n").trim()};function j(){let e=(0,x.useRouter)(),t=(0,x.useSearchParams)(),[r,g]=(0,m.useState)([]),[j,N]=(0,m.useState)([]),[w,C]=(0,m.useState)([]),[k,S]=(0,m.useState)("all"),[_,T]=(0,m.useState)("all"),[L,Z]=(0,m.useState)(!1),[E,F]=(0,m.useState)(""),[M,P]=(0,m.useState)(1),[A,D]=(0,m.useState)(1),$={themeType:"default",footerCopyright:"\xa9 ".concat(new Date().getFullYear()," 个人主页. All rights reserved."),noteLayoutColumns:"1",showNoteCover:"true",defaultNoteCover:"",avatarShape:"circle",noteDisplayMode:"modal",showTopNavbar:"true",showWapSidebar:"true"},[W,B]=(0,m.useState)($);(0,m.useEffect)(()=>{let e=t.get("category"),r=t.get("tag");e&&S(e),r&&T(r)},[t]),(0,m.useEffect)(()=>{Y(),z(),H(),X()},[M,k,_]),(0,m.useEffect)(()=>{let e="全部笔记 - Xs-Blog";"all"!==k?e="".concat(k," - 全部笔记 - Xs-Blog"):"all"!==_&&(e="".concat(_," - 全部笔记 - Xs-Blog")),document.title=e},[k,_]);let X=async()=>{try{let e=await (0,p.Gw4)();if(e.success&&e.data){let t={};e.data.forEach(e=>{t[e.key]=e.value}),B({themeType:t.themeType||"default",footerCopyright:t.footerCopyright||"\xa9 ".concat(new Date().getFullYear()," 个人主页. All rights reserved."),noteLayoutColumns:t.noteLayoutColumns||"1",showNoteCover:t.showNoteCover||"true",defaultNoteCover:t.defaultNoteCover||"",avatarShape:t.avatarShape||"circle",noteDisplayMode:t.noteDisplayMode||"modal",showTopNavbar:t.showTopNavbar||"true",showWapSidebar:t.showWapSidebar||"true"})}}catch(e){console.error("Failed to load settings:",e)}},Y=async()=>{try{var e,t;let r={is_published:!0,page:M,limit:12};"all"!==k&&(r.category=k),"all"!==_&&(r.tag=_);let a=await p.ZPm.get("/notes",{params:r}),s=null===(e=a.data)||void 0===e?void 0:e.data,l=Array.isArray(null==s?void 0:s.notes)?s.notes:[];g(l),D((null==s?void 0:null===(t=s.pagination)||void 0===t?void 0:t.totalPages)||1)}catch(e){console.error("Failed to fetch notes:",e),g([])}finally{Z(!1)}},z=async()=>{try{var e;let t=await p.ZPm.get("/notes/categories/list"),r=null===(e=t.data)||void 0===e?void 0:e.data;N(Array.isArray(r)?r:[])}catch(e){console.error("Failed to fetch categories:",e),N([])}},H=async()=>{try{var e;let t=await p.ZPm.get("/notes/tags/stats"),r=null===(e=t.data)||void 0===e?void 0:e.data;C(Array.isArray(r)?r.map(e=>e.name):[])}catch(e){console.error("Failed to fetch tags:",e),C([])}},O=t=>{e.push("/note/".concat(t))},R=r.filter(e=>{var t,r,a,s;if(!E.trim())return!0;let l=E.toLowerCase(),o=null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(l),n=f(e.content).toLowerCase().includes(l),i=null===(r=e.category)||void 0===r?void 0:r.toLowerCase().includes(l),c=(null===(a=e.Tags)||void 0===a?void 0:a.some(e=>e.name.toLowerCase().includes(l)))||(null===(s=e.tags)||void 0===s?void 0:s.toLowerCase().includes(l));return o||n||i||c}),G=new Map(j.map(e=>[e.name,e])),I=(null==W?void 0:W.themeType)==="blog",q=(null==W?void 0:W.showTopNavbar)!=="false",J=(null==W?void 0:W.showWapSidebar)!=="false",K=E.trim()&&R.length>0,Q=E.trim()&&0===R.length;return(0,a.jsxs)("main",{className:"min-h-screen bg-bg-primary relative flex flex-col",children:[I?(0,a.jsx)(u.Z,{showWapSidebar:J}):q?(0,a.jsx)(u.Z,{showWapSidebar:J}):null,(0,a.jsxs)("div",{className:"relative z-0 flex-1 flex flex-col",children:[(I||q)&&(0,a.jsx)("div",{className:"h-16"}),(0,a.jsxs)("div",{className:"container mx-auto px-4 max-w-6xl py-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"全部笔记"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"探索所有已发布的笔记内容"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,a.jsxs)("div",{className:"relative max-w-2xl mx-auto",children:[(0,a.jsx)(l.Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-tertiary"}),(0,a.jsx)("input",{type:"text",placeholder:"搜索笔记...",value:E,onChange:e=>F(e.target.value),className:"w-full pl-12 pr-12 py-3 bg-bg-secondary border border-border-primary rounded-xl text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",autoComplete:"off"}),E&&(0,a.jsx)("button",{type:"button",onClick:()=>{F("")},className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-primary transition-colors","aria-label":"清空搜索",children:(0,a.jsx)(o.Z,{className:"w-5 h-5"})})]})})}),K&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 max-w-2xl mx-auto",children:(0,a.jsx)("div",{className:"flex items-center justify-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:["搜索结果: 找到 ",R.length," 条相关笔记",(0,a.jsxs)("span",{className:"font-medium ml-1",children:['"',E,'"']})]})})}),Q&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-bg-tertiary rounded-xl border border-border-primary text-center max-w-2xl mx-auto",children:(0,a.jsxs)("span",{className:"text-sm text-text-tertiary",children:['没有找到包含 "',E,'" 的笔记']})}),(0,a.jsxs)("div",{className:"mb-8 space-y-4",children:[j.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"按分类筛选"]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)("button",{onClick:()=>{S("all"),P(1)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("all"===k?"bg-primary-500 text-white shadow-md":"bg-bg-secondary text-text-secondary hover:bg-bg-tertiary border border-border-primary"),children:"全部"}),j.map(e=>(0,a.jsxs)("button",{onClick:()=>{S(e.name),P(1)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(k===e.name?"bg-primary-500 text-white shadow-md":"bg-bg-secondary text-text-secondary hover:bg-bg-tertiary border border-border-primary"),children:[e.icon&&(0,a.jsx)("span",{className:"mr-1.5",children:e.icon}),e.name]},e.id||e.name))]})]}),w.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),"按标签筛选"]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)("button",{onClick:()=>{T("all"),P(1)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("all"===_?"bg-primary-500 text-white shadow-md":"bg-bg-secondary text-text-secondary hover:bg-bg-tertiary border border-border-primary"),children:"全部"}),w.slice(0,10).map(e=>(0,a.jsx)("button",{onClick:()=>{T(e),P(1)},className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(_===e?"bg-primary-500 text-white shadow-md":"bg-bg-secondary text-text-secondary hover:bg-bg-tertiary border border-border-primary"),children:e},e))]})]})]}),R.length>0?(0,a.jsx)("div",{className:"grid gap-4 max-w-7xl mx-auto ".concat((null==W?void 0:W.noteLayoutColumns)==="1"?"grid-cols-1":(null==W?void 0:W.noteLayoutColumns)==="2"?"grid-cols-1 md:grid-cols-2":(null==W?void 0:W.noteLayoutColumns)==="3"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":(null==W?void 0:W.noteLayoutColumns)==="4"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-4":"grid-cols-1"),children:R.map((e,t)=>{var r,l,o,n;let i=e.cover_image||(null==W?void 0:W.defaultNoteCover),m=(null==W?void 0:W.showNoteCover)==="true"&&i,x=(null==W?void 0:W.noteLayoutColumns)==="1",p=(e.cover_image||(null==W?void 0:W.defaultNoteCover)||"").startsWith("http")?e.cover_image||(null==W?void 0:W.defaultNoteCover):"".concat(y).concat(e.cover_image||(null==W?void 0:W.defaultNoteCover));return(0,a.jsx)(s.E.div,{onClick:()=>O(e.id),className:"group bg-bg-secondary rounded-xl shadow-sm hover:shadow-xl hover:-translate-y-1 border border-border-primary transition-all duration-300 cursor-pointer ".concat("1"===W.noteLayoutColumns?"p-4":"p-6"," flex flex-col min-h-[150px]"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},children:x&&m?(0,a.jsxs)("div",{className:"flex gap-3 items-center h-full",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-28 h-28 rounded-lg overflow-hidden bg-bg-tertiary",children:(0,a.jsx)("img",{src:p,alt:e.title||"封面图",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col justify-center min-h-[112px] py-1",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary group-hover:text-primary-500 transition-colors flex-1 line-clamp-1",children:e.title||"无标题"}),e.is_pinned&&(0,a.jsx)("div",{className:"flex items-center px-1.5 py-0.5 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded text-xs font-semibold flex-shrink-0",children:(0,a.jsx)(c.Z,{className:"w-3 h-3 fill-current"})})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary leading-relaxed line-clamp-2 mb-2",children:e.summary||v(f(e.content),80)}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-text-tertiary",children:[(0,a.jsx)(d.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:b(e.published_at||e.created_at)})]}),e.category&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded font-medium cursor-pointer hover:bg-primary-200 dark:hover:bg-primary-800/40 transition-colors",onClick:t=>{t.stopPropagation(),S(e.category),P(1)},children:[(null===(r=G.get(e.category))||void 0===r?void 0:r.icon)&&(0,a.jsx)("span",{className:"mr-1",children:null===(l=G.get(e.category))||void 0===l?void 0:l.icon}),e.category]}),e.Tags&&e.Tags.length>0&&(0,a.jsxs)(a.Fragment,{children:[e.Tags.slice(0,3).map(e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded font-medium cursor-pointer hover:opacity-80 transition-opacity",style:e.color?{backgroundColor:"".concat(e.color,"20"),color:e.color}:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},onClick:t=>{t.stopPropagation(),T(e.name),P(1)},children:e.name},e.id)),e.Tags.length>3&&(0,a.jsxs)("span",{className:"px-2 py-1 rounded",style:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},children:["+",e.Tags.length-3]})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[!x&&m&&(0,a.jsx)("div",{className:"mb-4 -mx-6 -mt-6",children:(0,a.jsx)("div",{className:"relative w-full pt-[100%] overflow-hidden rounded-t-xl",children:(0,a.jsx)("img",{src:p,alt:e.title||"封面图",className:"absolute inset-0 w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})})}),(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary group-hover:text-primary-500 transition-colors flex-1 line-clamp-2",children:e.title||"无标题"}),e.is_pinned&&(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded text-xs font-semibold flex-shrink-0",children:[(0,a.jsx)(c.Z,{className:"w-3 h-3 fill-current"}),(0,a.jsx)("span",{children:"置顶"})]})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary leading-relaxed line-clamp-3 mb-4 flex-1",children:e.summary||v(f(e.content),150)}),(0,a.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-text-tertiary",children:[(0,a.jsx)(d.Z,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:b(e.published_at||e.created_at)})]}),e.category&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded text-xs font-medium cursor-pointer hover:bg-primary-200 dark:hover:bg-primary-800/40 transition-colors",onClick:t=>{t.stopPropagation(),S(e.category),P(1)},children:[(null===(o=G.get(e.category))||void 0===o?void 0:o.icon)&&(0,a.jsx)("span",{className:"mr-1",children:null===(n=G.get(e.category))||void 0===n?void 0:n.icon}),e.category]}),e.Tags&&e.Tags.length>0&&(0,a.jsxs)(a.Fragment,{children:[e.Tags.slice(0,3).map(e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity",style:e.color?{backgroundColor:"".concat(e.color,"20"),color:e.color}:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},onClick:t=>{t.stopPropagation(),T(e.name),P(1)},children:e.name},e.id)),e.Tags.length>3&&(0,a.jsxs)("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"rgb(242 242 242)",color:"rgb(112 112 112)"},children:["+",e.Tags.length-3]})]})]}),(0,a.jsx)("span",{className:"text-sm text-primary-500 font-medium group-hover:text-primary-600 transition-colors",children:"详情 →"})]})]})},e.id)})}):(0,a.jsx)("div",{className:"text-center py-16 text-text-tertiary",children:(0,a.jsx)("p",{className:"text-lg",children:"暂无笔记"})}),A>1&&(0,a.jsxs)("div",{className:"flex justify-center gap-2 pt-8 mt-8",children:[(0,a.jsx)("button",{onClick:()=>P(e=>Math.max(1,e-1)),disabled:1===M,className:"px-4 py-2 rounded-lg bg-bg-secondary text-text-secondary hover:bg-bg-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-all text-sm border border-border-primary",children:"上一页"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(A,5)},(e,t)=>{let r;let s=(r=A<=5?t+1:M<=3?t+1:M>=A-2?A-4+t:M-2+t)===M;return(0,a.jsx)("button",{onClick:()=>P(r),className:"w-10 h-10 rounded-lg transition-all text-sm border "+(s?"bg-primary-500 text-white border-primary-500":"bg-bg-secondary text-text-secondary hover:bg-bg-tertiary border-border-primary"),children:r},r)})}),(0,a.jsx)("button",{onClick:()=>P(e=>Math.min(A,e+1)),disabled:M===A,className:"px-4 py-2 rounded-lg bg-bg-secondary text-text-secondary hover:bg-bg-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-all text-sm border border-border-primary",children:"下一页"})]})]}),(0,a.jsxs)("footer",{className:"text-center text-sm relative z-10 mt-12 py-6 border-t border-border-primary/30",children:[(0,a.jsx)("div",{className:"text-text-tertiary",dangerouslySetInnerHTML:{__html:W.footerCopyright}}),(0,a.jsx)(h.Z,{})]})]})]})}}},function(e){e.O(0,[660,278,833,543,811,351,744],function(){return e(e.s=96205)}),_N_E=e.O()}]);