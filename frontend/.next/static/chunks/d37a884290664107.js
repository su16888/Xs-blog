(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64740,e=>{"use strict";var t=e.i(71645),s=e.i(90499);let l=null;function a(e,r=!1){let[o,i]=(0,t.useState)(l||""),c=(0,s.useOptionalPageTitleContext)();(0,t.useEffect)(()=>{r&&c&&c.setTitle(e)},[e,r,c]),(0,t.useEffect)(()=>{l?i(l):(async()=>{try{let e=await fetch("/api/settings");if(e.ok){let t=await e.json();if(t.success&&t.data){let e={};t.data.forEach(t=>{e[t.key]=t.value});let s=e.siteTitle||"";l=s,i(s)}}}catch(e){console.error("Failed to fetch site title:",e)}})()},[]),(0,t.useEffect)(()=>{let t=document.title;return r?"仪表盘"===e?document.title=`${o} - 后台管理系统`:document.title=`${e} - ${o}后台管理系统`:document.title=`${e} - ${o}`,()=>{document.title=t}},[e,o,r])}e.s(["usePageTitle",()=>a])},40803,e=>{"use strict";var t=e.i(18050),s=e.i(71645),l=e.i(75254);let a=(0,l.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),r=(0,l.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var o=e.i(37727);function i({show:e,message:l,type:i,duration:c=3e3,onClose:n}){let[d,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(e){g(!0);let e=setTimeout(()=>{g(!1)},c);return()=>clearTimeout(e)}g(!1)},[e,c]),(0,s.useEffect)(()=>{if(!d&&e){let e=setTimeout(n,300);return()=>clearTimeout(e)}},[d,e,n]);let u=(()=>{switch(i){case"success":return{bg:"bg-green-50 border-green-200",text:"text-green-800",icon:(0,t.jsx)(a,{className:"w-5 h-5 text-green-500"})};case"error":return{bg:"bg-red-50 border-red-200",text:"text-red-800",icon:(0,t.jsx)(r,{className:"w-5 h-5 text-red-500"})};default:return{bg:"bg-blue-50 border-blue-200",text:"text-blue-800",icon:(0,t.jsx)(a,{className:"w-5 h-5 text-blue-500"})}}})();return(0,t.jsx)(t.Fragment,{children:d&&(0,t.jsx)("div",{className:"fixed top-4 right-4 z-[999999] min-w-[300px] max-w-md animate-slide-down",children:(0,t.jsxs)("div",{className:`${u.bg} border rounded-lg shadow-lg p-4 flex items-start gap-3`,children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:u.icon}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("p",{className:`${u.text} text-sm font-medium`,children:l})}),(0,t.jsx)("button",{onClick:()=>{g(!1)},className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(o.X,{className:"w-4 h-4"})})]})})})}e.s(["default",()=>i],40803)},42919,e=>{"use strict";var t=e.i(18050),s=e.i(71645),l=e.i(18566),a=e.i(98348),r=e.i(9165),o=e.i(86034),i=e.i(64740),c=e.i(40803);function n(){(0,i.usePageTitle)("博客主题设置",!0);let e=(0,l.useRouter)(),{user:n}=(0,a.useAuth)(),[d,g]=(0,s.useState)(!0),[u,x]=(0,s.useState)(!1),[m,b]=(0,s.useState)({blogLogo:"",blogLogoText:"",blogNavLinks:"[]",blogCarouselImages:"[]"}),[h,p]=(0,s.useState)([]),[y,f]=(0,s.useState)([]),[j,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),[L,k]=(0,s.useState)(!1),[C,T]=(0,s.useState)(null),[S,I]=(0,s.useState)({show:!1,type:"success",message:""});(0,s.useEffect)(()=>{E()},[]),(0,s.useEffect)(()=>{try{let e=JSON.parse(m.blogNavLinks||"[]");p(e)}catch{p([])}try{let e=JSON.parse(m.blogCarouselImages||"[]");f(e)}catch{f([])}},[m.blogNavLinks,m.blogCarouselImages]);let E=async()=>{try{let e=await (0,r.getAdminSettings)();if(e.success&&e.data){let t={};e.data.forEach(e=>{t[e.key]=e.value}),b({blogLogo:t.blogLogo||"",blogLogoText:t.blogLogoText||"",blogNavLinks:t.blogNavLinks||"[]",blogCarouselImages:t.blogCarouselImages||"[]",blogProfileEnabled:t.blogProfileEnabled||"true",blogCarouselEnabled:t.blogCarouselEnabled||"true"})}}catch(e){console.error("加载博客主题设置失败:",e)}finally{g(!1)}},O=async e=>{let t=e.target.files?.[0];if(t){v(!0);try{let s=await (0,r.uploadBlogThemeLogo)(t);s.success&&(I({show:!0,type:"success",message:"Logo上传成功"}),b({...m,blogLogo:s.data.url}),e.target.value="")}catch(e){I({show:!0,type:"error",message:e.response?.data?.message||"Logo上传失败"})}finally{v(!1)}}},$=async()=>{w(!0);try{(await (0,r.deleteBlogThemeImage)(m.blogLogo)).success&&(I({show:!0,type:"success",message:"Logo删除成功"}),b({...m,blogLogo:""}))}catch(e){I({show:!0,type:"error",message:e.response?.data?.message||"Logo删除失败"})}finally{w(!1)}},B=async e=>{let t=e.target.files?.[0];if(t){k(!0);try{let s=await (0,r.uploadBlogThemeCarousel)(t);if(s.success){let t=[...y,{url:s.data.url,alt:"轮播图"}];f(t),b({...m,blogCarouselImages:JSON.stringify(t)}),I({show:!0,type:"success",message:"轮播图上传成功"}),e.target.value=""}}catch(e){I({show:!0,type:"error",message:e.response?.data?.message||"轮播图上传失败"})}finally{k(!1)}}},J=async e=>{let t=y[e],s=y.filter((t,s)=>s!==e);if(t.url&&t.url.startsWith("/uploads/"))try{await (0,r.deleteBlogThemeImage)(t.url)}catch(e){console.error("删除轮播图文件失败:",e)}f(s),b({...m,blogCarouselImages:JSON.stringify(s)})},P=async e=>{e.preventDefault(),x(!0);try{let e=Object.entries(m).map(([e,t])=>({key:e,value:t,type:"string"}));(await (0,r.updateAdminSettings)(e)).success&&I({show:!0,type:"success",message:"博客主题设置保存成功"})}catch(e){I({show:!0,type:"error",message:e.response?.data?.message||"保存失败"})}finally{x(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.default,{show:S.show,message:S.message,type:S.type,onClose:()=>I({...S,show:!1})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-base font-semibold text-gray-900 mb-5",children:"Logo设置"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo图片"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[m.blogLogo&&(0,t.jsx)("div",{className:"w-16 h-16 flex items-center justify-center bg-gray-50 rounded border border-gray-200 flex-shrink-0",children:(0,t.jsx)("img",{src:(0,r.getImageUrl)(m.blogLogo),alt:"Logo",className:"max-w-full max-h-full object-contain p-1"})}),(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[!m.blogLogo&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{type:"file",id:"logoInput",accept:".jpg,.jpeg,.png,.gif,.webp,.svg",onChange:O,disabled:j,className:"hidden"}),(0,t.jsx)("label",{htmlFor:"logoInput",className:`px-3 py-2 bg-blue-600 text-white rounded text-sm cursor-pointer hover:bg-blue-700 ${j?"opacity-50 cursor-not-allowed":""}`,children:j?"上传中...":"上传图片"})]}),(0,t.jsx)("input",{type:"text",value:m.blogLogo,onChange:e=>b({...m,blogLogo:e.target.value}),placeholder:"或输入图片URL",className:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),m.blogLogo&&(0,t.jsx)("button",{type:"button",onClick:$,disabled:N,className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm disabled:opacity-50",children:N?"删除中...":"删除"})]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1.5",children:"支持 jpg、png、gif、webp、svg 格式"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo文字"}),(0,t.jsx)("input",{type:"text",name:"blogLogoText",value:m.blogLogoText,onChange:e=>{b({...m,[e.target.name]:e.target.value})},placeholder:"例如：我的博客",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1.5",children:"可以单独使用文字，或与Logo图片组合显示"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-base font-semibold text-gray-900 mb-5",children:"轮播图"}),(0,t.jsxs)("div",{className:"space-y-4",children:[y.map((e,s)=>(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 justify-center",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{if(0===s)return;let e=[...y],t=e[s];e[s]=e[s-1],e[s-1]=t,f(e),b({...m,blogCarouselImages:JSON.stringify(e)})},disabled:0===s,className:"p-1 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"上移",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),(0,t.jsx)("button",{type:"button",onClick:()=>{if(s===y.length-1)return;let e=[...y],t=e[s];e[s]=e[s+1],e[s+1]=t,f(e),b({...m,blogCarouselImages:JSON.stringify(e)})},disabled:s===y.length-1,className:"p-1 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"下移",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,t.jsx)("div",{className:"w-24 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0",children:(0,t.jsx)("img",{src:(0,r.getImageUrl)(e.url),alt:e.alt,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1.5",children:"跳转链接（可选）"}),(0,t.jsx)("input",{type:"text",value:e.link||"",onChange:e=>{let t=[...y];t[s]={...t[s],link:e.target.value},f(t),b({...m,blogCarouselImages:JSON.stringify(t)})},placeholder:"https://example.com",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>J(s),className:"text-sm text-red-600 hover:text-red-700",children:"删除"})]})]})},s)),0===y.length&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-400 text-sm",children:"暂无轮播图"}),y.length<3&&(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"file",id:"carouselInput",accept:".jpg,.jpeg,.png,.gif,.webp",onChange:B,disabled:L,className:"hidden"}),(0,t.jsx)("label",{htmlFor:"carouselInput",className:`px-3 py-2 bg-blue-600 text-white rounded text-sm cursor-pointer hover:bg-blue-700 ${L?"opacity-50 cursor-not-allowed":""}`,children:L?"上传中...":"上传图片"}),(0,t.jsx)("input",{type:"text",placeholder:"或输入图片URL后按回车",onKeyPress:e=>{if("Enter"===e.key&&e.currentTarget.value.trim()){if(y.length>=3)return void I({show:!0,type:"error",message:"最多只能添加3张轮播图"});let t=[...y,{url:e.currentTarget.value,alt:"轮播图"}];f(t),b({...m,blogCarouselImages:JSON.stringify(t)}),I({show:!0,type:"success",message:"轮播图URL添加成功"}),e.currentTarget.value=""}},className:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"支持 jpg、jpeg、png、gif、webp 格式，最多3张"})]}),y.length>=3&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"已达到轮播图数量上限（3张）"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:P,disabled:u,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:u?"保存中...":"保存设置"}),(0,t.jsx)("button",{type:"button",onClick:()=>e.push((0,o.getAdminRoute)("dashboard")),className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"返回"})]})]})})})]})}e.s(["default",()=>n])}]);