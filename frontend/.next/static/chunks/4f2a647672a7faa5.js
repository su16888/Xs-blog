(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84912,e=>{"use strict";var t=e.i(18050),s=e.i(71645),l=e.i(9165),r=e.i(49484);let i=e=>{let t=e.toLowerCase();return[".mp4",".webm",".ogg",".mov",".avi"].some(e=>t.endsWith(e)||t.endsWith("#"+e.slice(1)))},n=({src:e,alt:l,onClick:r,className:i=""})=>{let n=(0,s.useRef)(null),[a,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=n.current;if(!e)return;let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(d(!0),t.disconnect())})},{rootMargin:"100px",threshold:.1});return t.observe(e),()=>t.disconnect()},[]),(0,t.jsx)("img",{ref:n,src:c?e:void 0,"data-src":e,alt:l,onClick:r,className:`${i} ${a?"sf-img-loaded":"sf-img-loading"}`,onLoad:()=>o(!0),onError:()=>{f(!0),o(!0)},style:{backgroundColor:a?"transparent":void 0,display:u&&!a?"none":void 0}})},a=e=>e.startsWith("http://")||e.startsWith("https://"),o=({video:e,images:r})=>{let n=e||r.find(e=>i(e)),o=(0,s.useRef)(null),c=(0,s.useRef)(null),[d,u]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=c.current;if(!e)return;let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(u(!0),t.disconnect())})},{rootMargin:"50px",threshold:.1});return t.observe(e),()=>t.disconnect()},[]),(0,s.useEffect)(()=>{let e=c.current,t=o.current;if(!e||!t)return;let s=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting||t.paused||t.pause()})},{threshold:0});return s.observe(e),()=>s.disconnect()},[d]),!n)return null;let x=n.replace(/#\.(mp4|webm|ogg|mov|avi)$/i,""),v=a(x)?(0,l.getApiUrl)(`/proxy/video?url=${encodeURIComponent(x)}`):(0,l.getImageUrl)(x);return(0,t.jsx)("div",{className:"sf-video",ref:c,children:d&&(0,t.jsxs)("div",{className:"sf-video-wrapper",children:[(0,t.jsx)("video",{ref:o,src:v,controls:!0,preload:f?"auto":"metadata",onPlay:()=>{g(!1)},onPause:()=>{g(!0)},playsInline:!0}),m&&(0,t.jsx)("div",{className:"sf-video-play-btn",onClick:()=>{h(!0),g(!1),setTimeout(()=>{o.current?.play()},100)},children:(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})})})]})})},c=({images:e,thumbnails:s,isFourImages:r=!1,onImageClick:o})=>{let c=e.filter(e=>!i(e));if(0===c.length)return null;let d=e=>{let t=c[e];return a(t)?t:s&&s[e]?(0,l.getImageUrl)(s[e]):(0,l.getImageUrl)(t)};return 1===c.length?(0,t.jsx)("div",{className:"sf-pic-grid sf-pic-1",children:(0,t.jsx)(n,{src:d(0),onClick:()=>o(c,0),alt:"åŠ¨æ€å›¾ç‰‡"})}):(0,t.jsx)("div",{className:`sf-pic-grid ${r?"sf-pic-4":""}`,children:c.map((e,s)=>(0,t.jsx)(n,{src:d(s),onClick:()=>o(c,s),alt:`åŠ¨æ€å›¾ç‰‡${s+1}`},s))})},d=s.default.memo(({content:e,maxLines:l=4})=>{let[r,i]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),o=(0,s.useRef)(null),c=(0,s.useRef)(null),d=(0,s.useRef)(0),u=e&&e.includes("<iframe"),{textPart:f,iframePart:h}=(e=>{if(!e)return{textPart:"",iframePart:""};let t=/<iframe[^>]*(?:\/>|>[\s\S]*?<\/iframe>)/gi,s=e.match(t)||[];return{textPart:e.replace(t,"").trim(),iframePart:s.join("")}})(e),m=e=>{if(!e)return"";let t=e.replace(/\n/g,"<br>");return t.replace(/<iframe([^>]*)src=["']([^"']*)["']([^>]*)(\/?>(?:[\s\S]*?<\/iframe>)?)/gi,(e,t,s,l,r)=>{let i=s;i=s.includes("autoplay=")?s.replace(/autoplay=1/gi,"autoplay=0"):s+(s.includes("?")?"&":"?")+"autoplay=0";let n=t.includes("loading=")||l.includes("loading="),a=t.includes("referrerPolicy=")||l.includes("referrerPolicy=")||t.includes("referrerpolicy=")||l.includes("referrerpolicy="),o=r.includes("</iframe>")?r.replace(/^\/?>/,"").replace(/<\/iframe>$/i,""):"",c=`<iframe${t}src="${i}"${l}${n?"":' loading="lazy"'}${a?"":' referrerPolicy="no-referrer"'}>${o}</iframe>`;return s.includes("music.163.com")?`<div class="sf-music163-wrapper">${c}</div>`:c})},g=m(f),x=m(h);(0,s.useEffect)(()=>{d.current+=1},[e]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{let e=o.current,t=c.current;if(!e||!t)return;let s=(parseFloat(getComputedStyle(e).lineHeight)||21)*l;t.scrollHeight>s+5?a(!0):a(!1)},100);return()=>{clearTimeout(e)}},[f,l]);let v=`content-${d.current}`;if(u)return(0,t.jsxs)("div",{className:"sf-text-wrapper",children:[f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{ref:c,className:"sf-text sf-text-measure",dangerouslySetInnerHTML:{__html:g},style:{position:"absolute",visibility:"hidden",width:"100%",pointerEvents:"none"}}),(0,t.jsx)("div",{ref:o,className:`sf-text ${!r&&n?"sf-text-collapsed":""}`,style:!r&&n?{WebkitLineClamp:l,display:"-webkit-box",WebkitBoxOrient:"vertical",overflow:"hidden"}:void 0,dangerouslySetInnerHTML:{__html:g}}),n&&(0,t.jsx)("span",{className:"sf-text-toggle",onClick:()=>i(!r),children:r?"æ”¶èµ·":"å±•å¼€"})]}),(0,t.jsx)("div",{className:"sf-text sf-iframe-container",dangerouslySetInnerHTML:{__html:x}})]});let p=m(e);return(0,t.jsxs)("div",{className:"sf-text-wrapper",children:[(0,t.jsx)("div",{ref:c,className:"sf-text sf-text-measure",dangerouslySetInnerHTML:{__html:p},style:{position:"absolute",visibility:"hidden",width:"100%",pointerEvents:"none"}}),(0,t.jsx)("div",{ref:o,className:`sf-text ${!r&&n?"sf-text-collapsed":""}`,style:!r&&n?{WebkitLineClamp:l,display:"-webkit-box",WebkitBoxOrient:"vertical",overflow:"hidden"}:void 0,dangerouslySetInnerHTML:{__html:p}},v),n&&(0,t.jsx)("span",{className:"sf-text-toggle",onClick:()=>i(!r),children:r?"æ”¶èµ·":"å±•å¼€"})]})});function u(){let[e,n]=(0,s.useState)({cover_image:"",avatar:"",nickname:"æœ‹å‹åœˆ",signature:"",custom_copyright:""}),[u,f]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),[g,x]=(0,s.useState)(null),[v,p]=(0,s.useState)(1),[j,y]=(0,s.useState)(!0),[b,k]=(0,s.useState)(!1),w=(0,s.useRef)(null),[N,S]=(0,s.useState)([]),[M,$]=(0,s.useState)(0),[C,L]=(0,s.useState)(!1),[E,T]=(0,s.useState)(null),[I,_]=(0,s.useState)(null),[U,W]=(0,s.useState)(1),[B,P]=(0,s.useState)({x:0,y:0}),[A,R]=(0,s.useState)(!1),[D,H]=(0,s.useState)({x:0,y:0}),[z,O]=(0,s.useState)(null),X=(0,s.useRef)(null),[Y,F]=(0,s.useState)(!1),[q,K]=(0,s.useState)({}),[G,J]=(0,s.useState)(!1),[Q,V]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)({browserTitle:"",browserSubtitle:""});(0,s.useEffect)(()=>{if(!Z.browserTitle)return;let e=Z.browserTitle;Z.browserSubtitle&&(e=`${e} - ${Z.browserSubtitle}`),document.title=e},[Z.browserTitle,Z.browserSubtitle]),(0,s.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([fetch((0,l.getApiUrl)("/settings")),fetch((0,l.getApiUrl)("/page-texts/socialFeed"))]);if(e.ok){let t=await e.json();if(t.success&&t.data){let e={};t.data.forEach(t=>{e[t.key]=t.value}),V("true"===e.socialFeedThemeEnabled)}}if(t.ok){let e=await t.json();e.success&&e.data&&ee({browserTitle:e.data.browserTitle||"æœ‹å‹åœˆ",browserSubtitle:e.data.browserSubtitle||""})}}catch(e){console.error("èŽ·å–è®¾ç½®å¤±è´¥:",e)}})()},[]);let et=e=>Math.hypot(e[0].clientX-e[1].clientX,e[0].clientY-e[1].clientY),es=()=>{R(!1)};(0,s.useEffect)(()=>{W(1),P({x:0,y:0})},[M]);let el=(0,s.useCallback)(async()=>{if(!b&&j){k(!0);try{let e=await fetch((0,l.getApiUrl)(`/social-feed/posts?page=${v+1}&limit=10`));if(e.ok){let t=await e.json();if(t.success&&t.data?.posts){let e=t.data.posts;e.length<10&&y(!1),e.length>0?(f(t=>[...t,...e]),p(e=>e+1)):y(!1)}}}catch(e){console.error("åŠ è½½æ›´å¤šå¤±è´¥:",e)}finally{k(!1)}}},[v,b,j]);(0,s.useEffect)(()=>{let e=w.current;if(!e)return;let t=new IntersectionObserver(e=>{e[0].isIntersecting&&j&&!b&&!h&&el()},{rootMargin:"100px",threshold:.1});return t.observe(e),()=>t.disconnect()},[j,b,h,el]),(0,s.useEffect)(()=>{(async()=>{try{m(!0),x(null);let[e,t]=await Promise.all([fetch((0,l.getApiUrl)("/social-feed/profile")),fetch((0,l.getApiUrl)("/social-feed/posts?page=1&limit=10"))]);if(e.ok){let t=await e.json();t.success&&t.data&&n(t.data)}if(t.ok){let e=await t.json();if(e.success&&e.data?.posts){let t=e.data.posts;f(t),t.length<10&&y(!1)}}}catch(e){console.error("åŠ è½½æ•°æ®å¤±è´¥:",e),x("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{m(!1)}})()},[]),(0,s.useEffect)(()=>{let e=()=>{F(window.scrollY>300)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,s.useEffect)(()=>{if(!C)return;let e=e=>{"ArrowLeft"===e.key&&M>0?$(e=>e-1):"ArrowRight"===e.key&&M<N.length-1?$(e=>e+1):"Escape"===e.key&&ei()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[C,M,N.length]);let er=(0,s.useCallback)((e,t)=>{S(e.map(e=>a(e)?e:(0,l.getImageUrl)(e))),$(t),K({}),L(!0),document.body.style.overflow="hidden"},[]),ei=()=>{L(!1),document.body.style.overflow="",$(0),S([])},en=e=>{let t=M+e;t>=0&&t<N.length&&$(t)};return h?(0,t.jsx)("div",{className:`sf-page ${G?"sf-dark":"sf-light"}`,children:(0,t.jsx)("div",{className:"sf-loading",children:"åŠ è½½ä¸­..."})}):g?(0,t.jsx)("div",{className:`sf-page ${G?"sf-dark":"sf-light"}`,children:(0,t.jsxs)("div",{className:"sf-error",children:[(0,t.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"ðŸ˜”"}),(0,t.jsx)("div",{children:g})]})}):(0,t.jsxs)("div",{className:`sf-page ${G?"sf-dark":"sf-light"}`,children:[(0,t.jsxs)("div",{className:"sf-container",children:[(0,t.jsxs)("div",{className:"sf-header",children:[!Q&&(0,t.jsx)("a",{href:"/",className:"sf-back-home",title:"è¿”å›žé¦–é¡µ",children:(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),(0,t.jsx)("img",{className:"sf-cover",src:e.cover_image?(0,l.getImageUrl)(e.cover_image):"/pyqbj.png",alt:"å°é¢"}),(0,t.jsx)("div",{className:"sf-nickname",children:e.nickname||"Arran"}),(0,t.jsx)("div",{className:"sf-signature",children:e.signature||"åˆ†äº«ç”Ÿæ´»ï¼Œè®°å½•ç¾Žå¥½æ—¶åˆ»"}),(0,t.jsx)("div",{className:"sf-avatar",children:(0,t.jsx)("img",{src:e.avatar?(0,l.getImageUrl)(e.avatar):"/pyqtx.png",alt:"å¤´åƒ"})})]}),(0,t.jsxs)("div",{className:"sf-feed-list",children:[0===u.length?(0,t.jsx)("div",{className:"sf-empty",children:"æš‚æ— åŠ¨æ€"}):u.map(s=>{let r,n,a,u,f;return(0,t.jsxs)("div",{className:"sf-feed-item",children:[(0,t.jsx)("div",{className:"sf-avatar-col",children:(0,t.jsx)("img",{src:e.avatar?(0,l.getImageUrl)(e.avatar):"/pyqtx.png",loading:"lazy",alt:e.nickname})}),(0,t.jsxs)("div",{className:"sf-content-col",children:[(0,t.jsx)("div",{className:"sf-user-name",children:e.nickname||"æœ‹å‹åœˆ"}),(0,t.jsx)(d,{content:s.content,maxLines:4}),(0,t.jsx)(o,{video:s.video,images:s.images||[]}),s.images&&s.images.length>0&&(0,t.jsx)(c,{images:s.images,thumbnails:s.thumbnails,isFourImages:4===s.images.filter(e=>!i(e)).length,onImageClick:er}),(0,t.jsxs)("div",{className:"sf-footer",children:[(0,t.jsx)("span",{className:"sf-time",children:(r=new Date(s.created_at),a=Math.floor((n=new Date().getTime()-r.getTime())/6e4),u=Math.floor(n/36e5),f=Math.floor(n/864e5),a<1?"åˆšåˆš":a<60?`${a}åˆ†é’Ÿå‰`:u<24?`${u}å°æ—¶å‰`:f<7?`${f}å¤©å‰`:r.toLocaleDateString("zh-CN",{month:"long",day:"numeric"}))}),s.is_pinned&&(0,t.jsx)("span",{className:"sf-pin",children:"ç½®é¡¶"})]})]})]},s.id)}),(0,t.jsxs)("div",{ref:w,className:"sf-load-more",children:[b&&(0,t.jsx)("div",{className:"sf-loading-more",children:"åŠ è½½ä¸­..."}),!j&&u.length>0&&(0,t.jsx)("div",{className:"sf-no-more",children:"å·²åŠ è½½å…¨éƒ¨åŠ¨æ€"})]})]}),(0,t.jsxs)("div",{className:"sf-copyright",children:[e.custom_copyright&&(0,t.jsx)("div",{className:"sf-custom-copyright",children:e.custom_copyright}),(0,t.jsx)(r.default,{})]}),C&&(0,t.jsxs)("div",{className:"sf-lightbox",onTouchStart:e=>{2===e.touches.length?(e.preventDefault(),O(et(e.touches))):1===e.touches.length&&(U>1?(R(!0),H({x:e.touches[0].clientX-B.x,y:e.touches[0].clientY-B.y})):(_(null),T(e.touches[0].clientX)))},onTouchMove:e=>{if(2===e.touches.length&&null!==z){e.preventDefault();let t=et(e.touches),s=t/z;O(t),W(e=>Math.min(Math.max(e*s,1),5))}else 1===e.touches.length&&(A&&U>1?(e.preventDefault(),P({x:e.touches[0].clientX-D.x,y:e.touches[0].clientY-D.y})):1===U&&_(e.touches[0].clientX))},onTouchEnd:()=>{if(O(null),R(!1),1===U&&null!==E&&null!==I){let e=E-I;e>50&&M<N.length-1&&$(e=>e+1),e<-50&&M>0&&$(e=>e-1)}T(null),_(null)},onMouseMove:e=>{A&&U>1&&P({x:e.clientX-D.x,y:e.clientY-D.y})},onMouseUp:es,onMouseLeave:es,children:[(0,t.jsx)("div",{className:"sf-lb-close",onClick:ei,children:(0,t.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),N.length>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:`sf-lb-prev ${0===M?"sf-lb-disabled":""}`,onClick:()=>en(-1),children:(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,t.jsx)("div",{className:`sf-lb-next ${M===N.length-1?"sf-lb-disabled":""}`,onClick:()=>en(1),children:(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("polyline",{points:"9 18 15 12 9 6"})})})]}),(0,t.jsxs)("div",{ref:X,className:"sf-lb-img-container",onWheel:e=>{e.preventDefault();let t=e.deltaY>0?.9:1.1;W(e=>{let s=Math.min(Math.max(e*t,1),5);return 1===s&&P({x:0,y:0}),s})},onMouseDown:e=>{U>1&&(e.preventDefault(),R(!0),H({x:e.clientX-B.x,y:e.clientY-B.y}))},onDoubleClick:()=>{U>1?(W(1),P({x:0,y:0})):W(2)},style:{cursor:U>1?A?"grabbing":"grab":"default"},children:[!q[M]&&(0,t.jsx)("div",{className:"sf-lb-loading",children:(0,t.jsx)("div",{className:"sf-lb-spinner"})}),(0,t.jsx)("img",{src:N[M],alt:"é¢„è§ˆå›¾ç‰‡",className:`sf-lb-img ${q[M]?"sf-lb-img-loaded":"sf-lb-img-loading"}`,style:{transform:`scale(${U}) translate(${B.x/U}px, ${B.y/U}px)`,transition:A?"none":"transform 0.1s ease-out"},onLoad:()=>K(e=>({...e,[M]:!0})),onError:()=>K(e=>({...e,[M]:!0})),draggable:!1})]}),(0,t.jsxs)("div",{className:"sf-lb-counter",children:[M+1," / ",N.length,U>1&&(0,t.jsxs)("span",{className:"sf-lb-zoom-indicator",children:[" Â· ",Math.round(100*U),"%"]})]})]})]}),(0,t.jsx)("div",{className:"sf-theme-btn",onClick:()=>{J(e=>!e)},title:G?"åˆ‡æ¢æµ…è‰²":"åˆ‡æ¢æ·±è‰²",children:G?(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),(0,t.jsx)("div",{className:`sf-back-top ${Y?"sf-visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},title:"å›žåˆ°é¡¶éƒ¨",children:(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})}e.s(["default",()=>u])},38270,e=>{e.n(e.i(84912))}]);