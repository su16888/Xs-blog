module.exports=[38078,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(35112);var d=a.i(46271),e=a.i(62036),f=a.i(33508),g=a.i(13749),h=a.i(50522),i=a.i(61690),j=a.i(69602),k=a.i(84505),l=a.i(43108),m=a.i(77156),n=a.i(41379),o=a.i(19032),p=a.i(68114);function q({galleryId:a,isOpen:q,onClose:r}){let[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)({x:0,y:0}),[Q,R]=(0,c.useState)(!1),S=(0,c.useRef)({x:0,y:0});(0,c.useRef)({x:0,y:0});let[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)(1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(null),[_,aa]=(0,c.useState)(!1),ab=(0,c.useRef)(null),ac=(0,c.useRef)([]);(0,c.useEffect)(()=>{let a=()=>{N(window.innerWidth<768||"ontouchstart"in window)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,c.useEffect)(()=>{q&&a&&ad()},[q,a]),(0,c.useEffect)(()=>(q?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[q]),(0,c.useEffect)(()=>{if(ab.current&&ac.current[u]){let a=ab.current,b=ac.current[u];if(b){let c=a.getBoundingClientRect(),d=b.getBoundingClientRect(),e=d.left-c.left+a.scrollLeft,f=e+d.width,g=c.width;if(e<a.scrollLeft||f>a.scrollLeft+g){let b=e-g/2+d.width/2;a.scrollTo({left:Math.max(0,b),behavior:"smooth"})}}}},[u]),(0,c.useEffect)(()=>{if(!q)return;let a=a=>{"Escape"===a.key?r():"ArrowLeft"===a.key?af():"ArrowRight"===a.key?ae():"+"===a.key||"="===a.key?ah():"-"===a.key&&ai()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[q,u,A,s]),(0,c.useCallback)(a=>{if(M)return;a.preventDefault();let b=a.deltaY>0?-.1:.1;B(a=>{let c=Math.min(Math.max(a+b,.5),3);return c<=1&&P({x:0,y:0}),c})},[M]),(0,c.useCallback)(a=>{M||A<=1||(a.preventDefault(),R(!0),S.current={x:a.clientX-O.x,y:a.clientY-O.y})},[M,A,O]),(0,c.useCallback)(a=>{!Q||M||P({x:a.clientX-S.current.x,y:a.clientY-S.current.y})},[Q,M]),(0,c.useCallback)(()=>{R(!1)},[]);let ad=async b=>{x(!0),z(null);try{let c=await (0,o.getGallery)(a,b);c.success?(t(c.data),D(!1),H("")):c.requirePassword?D(!0):z(c.message||"加载图册失败")}catch(a){a.response?.status===401?a.response?.data?.requirePassword?D(!0):(D(!0),H("密码错误")):z("加载图册失败")}finally{x(!1)}},ae=()=>{s&&0!==s.images.length&&(v(a=>(a+1)%s.images.length),ag())},af=()=>{s&&0!==s.images.length&&(v(a=>(a-1+s.images.length)%s.images.length),ag())},ag=()=>{B(1),P({x:0,y:0})},ah=()=>{B(a=>Math.min(a+.25,3))},ai=()=>{B(a=>{let b=Math.max(a-.25,.5);return b<=1&&P({x:0,y:0}),b})};return q&&(e.AnimatePresence,d.motion.div,!w&&!C&&s&&s.images.length>1&&s.images.length,!w&&!C&&s&&s.images.length>0&&k.Download,C||f.X,C&&(d.motion.div,f.X,l.Lock,I?n.EyeOff:m.Eye),w||y||C||!s||!(s.images.length>0)||(b.Fragment,d.motion.img,(0,p.getFileUrl)(s.images[u].path),s.images[u].filename,O.x,O.y,s.images.length>1&&!M&&(b.Fragment,g.ChevronLeft,h.ChevronRight)),w||y||C||!s||s.images.length,!w&&!y&&!C&&s&&s.images.length>0&&(M||(j.ZoomOut,i.ZoomIn),s.images.length>1&&s.images.map((a,c)=>(0,b.jsx)("button",{ref:a=>{ac.current[c]=a},onClick:()=>{v(c),ag()},className:`flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all ${c===u?"border-primary-500 opacity-100":"border-white/20 opacity-50 hover:opacity-75"}`,children:(0,b.jsx)("img",{src:(0,p.getFileUrl)(a.path),alt:a.filename,className:"w-full h-full object-cover",draggable:!1})},a.id)))),null}a.s(["default",()=>q])}];

//# sourceMappingURL=src_components_GalleryViewer_tsx_48b62155._.js.map