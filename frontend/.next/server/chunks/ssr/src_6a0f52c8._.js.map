{"version":3,"sources":["../../../../src/components/Copyright.tsx","../../../../src/app/admins/login/page.tsx"],"sourcesContent":["/**\n * @file Copyright.tsx\n * @description 加密的版权标识组件\n * @author Arran\n */\n\n'use client'\n\nimport { useEffect, useState } from 'react'\n\n// Base64 编码的版权文本和链接（可以多次编码增加混淆）\nconst _0x1a2b = 'QXJjaGl0ZWN0dXJhbCBkcml2ZXIgaXMgYmFzZWQgb24g' // \"Architectural driver is based on \"\nconst _0x2b3c = 'WHMtYmxvZy4=' // \"Xs-blog.\"\nconst _0x3c4d = 'aHR0cHM6Ly9naXRodWIuY29tL3N1MTY4ODgvWHMtYmxvZw==' // GitHub URL\n\n// 解码函数（混淆）\nconst _0xDecode = (s: string): string => {\n  try {\n    return atob(s)\n  } catch {\n    return ''\n  }\n}\n\n// 验证函数（防止篡改）\nconst _0x5e6f = (): boolean => {\n  const _t1 = _0xDecode(_0x1a2b)\n  const _t2 = _0xDecode(_0x2b3c)\n  return _t1.length > 0 && _t2.includes('Xs-blog')\n}\n\nexport default function Copyright() {\n  const [_text1, _setText1] = useState<string>('')\n  const [_text2, _setText2] = useState<string>('')\n  const [_link, _setLink] = useState<string>('')\n  const [_valid, _setValid] = useState<boolean>(false)\n\n  useEffect(() => {\n    // 延迟加载，防止直接查看\n    const timer = setTimeout(() => {\n      if (_0x5e6f()) {\n        _setText1(_0xDecode(_0x1a2b))\n        _setText2(_0xDecode(_0x2b3c))\n        _setLink(_0xDecode(_0x3c4d))\n        _setValid(true)\n      }\n    }, 100)\n\n    return () => clearTimeout(timer)\n  }, [])\n\n  // 防止删除检测\n  useEffect(() => {\n    const checkIntegrity = () => {\n      const element = document.querySelector('[data-copyright]')\n      if (!element && _valid) {\n        console.warn('Copyright notice must not be removed.')\n      }\n    }\n\n    const interval = setInterval(checkIntegrity, 5000)\n    return () => clearInterval(interval)\n  }, [_valid])\n\n  if (!_valid || !_text1) return null\n\n  return (\n    <div\n      data-copyright=\"true\"\n      className=\"text-[10px] md:text-xs text-gray-500 text-center select-none\"\n      style={{\n        userSelect: 'none',\n        WebkitUserSelect: 'none',\n        MozUserSelect: 'none'\n      }}\n      onContextMenu={(e) => e.preventDefault()}\n    >\n      {_text1}\n      <a\n        href={_link}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"text-primary-500 hover:text-primary-600 transition-colors\"\n        style={{\n          userSelect: 'none',\n          WebkitUserSelect: 'none',\n          MozUserSelect: 'none'\n        }}\n      >\n        {_text2}\n      </a>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { login, getSettings } from '@/lib/api'\nimport { getAdminRoute } from '@/lib/adminConfig'\nimport { useAuth } from '@/contexts/AuthContext'\nimport Copyright from '@/components/Copyright'\n\nexport default function LoginPage() {\n  const router = useRouter()\n  const { setUser, isAuthenticated, isLoading: authLoading } = useAuth()\n  const [formData, setFormData] = useState({\n    username: '',\n    password: '',\n  })\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  // 设置页面标题\n  useEffect(() => {\n    const loadTitle = async () => {\n      try {\n        const response = await getSettings()\n        if (response.success && response.data) {\n          const title = response.data.find((s: any) => s.key === 'siteTitle')?.value || ''\n          document.title = title ? `管理后台登录 - ${title}` : '管理后台登录'\n        }\n      } catch (error) {\n        document.title = '管理后台登录'\n      }\n    }\n    loadTitle()\n  }, [])\n\n  // 已登录用户自动跳转到后台\n  useEffect(() => {\n    if (!authLoading && isAuthenticated) {\n      router.push(getAdminRoute('dashboard'))\n    }\n  }, [authLoading, isAuthenticated, router])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setLoading(true)\n\n    try {\n      const response = await login(formData.username, formData.password)\n\n      // 保存 token\n      try {\n        localStorage.setItem('token', response.token)\n        localStorage.setItem('user', JSON.stringify(response.user))\n      } catch (storageError) {\n        // localStorage 不可用，但登录仍然成功\n        console.warn('无法保存登录信息到 localStorage:', storageError)\n      }\n\n      // 更新 AuthContext 的用户状态（解决竞态条件问题）\n      setUser(response.user)\n\n      // 跳转到管理后台\n      const dashboardRoute = getAdminRoute('dashboard')\n      router.push(dashboardRoute)\n    } catch (err: any) {\n      // 后端返回的错误信息在 err.response?.data?.message\n      const errorMessage = err.response?.data?.message || err.message || '登录失败，请重试'\n      setError(errorMessage)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    })\n  }\n\n  // 认证检查中或已登录，显示加载状态\n  if (authLoading || isAuthenticated) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-500\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n      <div className=\"max-w-md w-full mx-4 flex flex-col\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 animate-fade-in\">\n          {/* Logo/标题 */}\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n              管理员登录\n            </h1>\n          </div>\n\n          {/* 错误提示 */}\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm\">\n              {error}\n            </div>\n          )}\n\n          {/* 登录表单 */}\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div>\n              <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                用户名\n              </label>\n              <input\n                id=\"username\"\n                name=\"username\"\n                type=\"text\"\n                required\n                value={formData.username}\n                onChange={handleChange}\n                className=\"input\"\n                placeholder=\"请输入用户名\"\n                disabled={loading}\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                密码\n              </label>\n              <input\n                id=\"password\"\n                name=\"password\"\n                type=\"password\"\n                required\n                value={formData.password}\n                onChange={handleChange}\n                className=\"input\"\n                placeholder=\"请输入密码\"\n                disabled={loading}\n                autoComplete=\"current-password\"\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? '登录中...' : '登录'}\n            </button>\n          </form>\n\n          {/* 返回首页 */}\n          <div className=\"mt-6 text-center\">\n            <a\n              href=\"/\"\n              className=\"text-sm text-primary-600 hover:text-primary-700 transition-colors\"\n            >\n              ← 返回首页\n            </a>\n          </div>\n        </div>\n\n        {/* 版权标识 - 增加上边距 */}\n        <div className=\"mt-12\">\n          <Copyright />\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}