module.exports=[6581,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(46271),f=a.i(41710),g=a.i(210),h=a.i(33350),i=a.i(96101);let j=(0,a.i(70106).default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var k=a.i(84505),l=a.i(52495),m=a.i(19032),n=a.i(62180),o=a.i(58348),p=a.i(5276),q=a.i(68114),r=a.i(52825),s=a.i(7222),t=a.i(70042),u=a.i(99209),v=a.i(46712),w=a.i(78891);let x=(0,q.getApiBaseUrl)();function y(){let a,q,y,z,A,B,C=(0,d.useParams)(),D=(0,d.useRouter)(),E=(0,d.useSearchParams)(),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(0),[V,W]=(0,c.useState)(3),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)({browserTitle:"笔记详情",browserSubtitle:""}),[af,ag]=(0,c.useState)("");(0,c.useEffect)(()=>{let a=async()=>{try{let a=E.get("password");if(a){let b=await m.default.get(`/notes/${C.id}?password=${encodeURIComponent(a)}`);if(b.data?.success&&b.data?.data){let c=b.data.data;G(c),c.requiresPassword?(M(!0),Q("URL中的密码不正确，请重新输入")):(M(!1),ac(a))}else K(!0)}else{let a=await m.default.get(`/notes/${C.id}`);if(a.data?.success&&a.data?.data){let b=a.data.data;G(b),b.requiresPassword&&M(!0)}else K(!0)}}catch(a){console.error("Failed to fetch note:",a),K(!0)}finally{I(!1)}};C.id&&a()},[C.id,E]),(0,c.useEffect)(()=>{(async()=>{try{let[a,b]=await Promise.all([(0,m.getSettings)(),(0,m.getPageText)("note")]);if(a.success&&a.data){let b={};a.data.forEach(a=>{b[a.key]=a.value}),ag(b.siteTitle||"")}b.success&&b.data&&ae({browserTitle:b.data.browserTitle||"笔记详情",browserSubtitle:b.data.browserSubtitle||""})}catch(a){console.error("加载页面配置失败:",a)}})()},[]),(0,c.useEffect)(()=>{if(F&&!F.requiresPassword){let a=[F.title||"无标题"];ad.browserTitle&&a.push(ad.browserTitle),af&&a.push(af),document.title=a.join(" - ")}else H?document.title="加载中...":J&&(document.title="笔记不存在")},[F,H,J,ab,ad,af]),(0,c.useEffect)(()=>{F&&!F.requiresPassword&&ah()},[F,ab]),(0,c.useEffect)(()=>{let a=async()=>{try{let a=await m.default.get("/notes/password-status");a.data?.success&&(U(a.data.errorCount||0),W(a.data.remaining??3))}catch(a){console.error("Failed to fetch password status")}};L&&a()},[L]);let ah=async()=>{try{let a=ab?`?password=${encodeURIComponent(ab)}`:"",b=await m.default.get(`/notes/${C.id}/disks${a}`);b.data?.success&&b.data?.data&&aa(b.data.data.length>0)}catch(a){aa(!1)}},ai=async a=>{a.preventDefault(),Q(""),S(!0);try{let a=await m.default.post(`/notes/${C.id}/verify`,{password:N});a.data?.success&&a.data?.data&&(G(a.data.data),M(!1),ac(N),O(""),U(0),W(3))}catch(b){let a=b.response?.data;a?.errorCount!==void 0&&(U(a.errorCount),W(a.remaining)),b.response?.status===429?Q("密码错误次数过多，请1小时后重试！"):b.response?.status===401?Q(a?.remaining>0?"密码错误":"密码错误次数过多，请1小时后重试！"):Q("验证失败，请稍后重试")}finally{S(!1)}},aj=()=>{D.push("/")},ak=a=>{D.push(`/notes?tag=${encodeURIComponent(a)}`)};return H?(0,b.jsx)("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-10 h-10 border-3 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-text-tertiary text-sm",children:"加载中..."})]})}):J||!F?(0,b.jsx)("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-3",children:"404"}),(0,b.jsx)("p",{className:"text-text-tertiary text-sm mb-4",children:"笔记不存在或已被删除"}),(0,b.jsx)("button",{onClick:aj,className:"px-4 py-2 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition-colors",children:"返回首页"})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-bg-primary hide-scrollbar relative",children:[(0,b.jsx)(v.default,{}),(0,b.jsx)(w.default,{}),(0,b.jsx)("nav",{className:"sticky top-0 z-50 bg-bg-primary/95 backdrop-blur-md border-b border-border-primary shadow-sm",children:(0,b.jsx)("div",{className:"max-w-6xl mx-auto px-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,b.jsxs)("button",{onClick:aj,className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors text-sm font-medium",children:[(0,b.jsx)(g.ArrowLeft,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"返回"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[_&&(0,b.jsxs)("button",{onClick:()=>$(!0),className:"flex items-center gap-1.5 px-3 py-2 text-sm text-primary-600 hover:bg-primary-50 rounded-lg transition-colors font-medium",children:[(0,b.jsx)(k.Download,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"下载资源"})]}),(0,b.jsxs)("button",{onClick:()=>Y(!0),className:"flex items-center gap-1.5 px-3 py-2 text-sm text-primary-600 hover:bg-primary-50 rounded-lg transition-colors font-medium",children:[(0,b.jsx)(j,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"分享笔记"})]})]})]})})}),(0,b.jsx)("main",{className:"py-6",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,b.jsxs)(e.motion.article,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"rounded-xl border border-border-primary shadow-sm overflow-hidden bg-bg-secondary",children:[(0,b.jsxs)("header",{className:"bg-bg-tertiary px-4 sm:px-6 py-4 border-b border-border-primary",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start gap-2 mb-3",children:[(0,b.jsx)("h1",{className:"text-lg sm:text-xl font-bold text-text-primary leading-snug flex-1",children:F.title||"无标题"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:["original"===F.source_type&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 bg-primary-100 text-primary-700 text-[10px] font-medium rounded",children:"原创"}),"reprint"===F.source_type&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 bg-primary-100 text-primary-600 text-[10px] font-medium rounded",children:"转载"}),_&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 bg-primary-100 text-primary-600 text-[10px] font-medium rounded",children:"含资源"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1.5 text-xs text-text-tertiary",children:[F.category&&(0,b.jsxs)("button",{onClick:()=>{F?.category&&D.push(`/notes?category=${encodeURIComponent(F.category)}`)},className:"flex items-center gap-1 hover:text-primary-600 transition-colors",children:[(0,b.jsx)(i.FolderOpen,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:F.category})]}),F.Tags&&F.Tags.length>0&&F.Tags.map(a=>(0,b.jsxs)("button",{onClick:()=>ak(a.name),className:"flex items-center gap-1 hover:opacity-70 transition-opacity",style:{color:a.color||"var(--text-tertiary)"},children:[(0,b.jsx)(h.Tag,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:a.name})]},a.id)),(!F.Tags||0===F.Tags.length)&&F.tags&&F.tags.split(",").map((a,c)=>(0,b.jsxs)("button",{onClick:()=>ak(a.trim()),className:"flex items-center gap-1 hover:text-primary-600 transition-colors",children:[(0,b.jsx)(h.Tag,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:a.trim()})]},c)),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Clock,{className:"w-3 h-3"}),(0,b.jsx)("time",{dateTime:F.published_at||F.created_at,children:(q=(a=new Date(F.published_at||F.created_at)).getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),z=String(a.getDate()).padStart(2,"0"),A=String(a.getHours()).padStart(2,"0"),B=String(a.getMinutes()).padStart(2,"0"),`${q}-${y}-${z} ${A}:${B}`)})]})]})]}),(0,b.jsx)("div",{className:"px-4 sm:px-6 py-5",children:(0,b.jsx)("div",{className:"prose prose-sm max-w-none note-content",children:(0,b.jsx)(n.default,{remarkPlugins:[o.default],rehypePlugins:[p.default],components:{img:({src:a,alt:c,...d})=>{let e=a;return"string"==typeof a&&a.startsWith("/uploads/")&&(e=`${x}${a}`),(0,b.jsx)("div",{className:"flex justify-center my-4",children:(0,b.jsx)("img",{src:e,alt:c||"",className:"max-w-full h-auto rounded-lg shadow-sm",style:{maxHeight:"360px",objectFit:"contain"},loading:"lazy",onError:a=>{a.target.style.display="none"},...d})})},iframe:({node:a,...c})=>(0,b.jsx)("div",{className:"iframe-container my-4",children:(0,b.jsx)("iframe",{...c})}),pre:({node:a,children:d,...e})=>{let f=a=>"string"==typeof a?a:Array.isArray(a)?a.map(f).join(""):c.default.isValidElement(a)?f(a.props.children||""):"",g=f(d),h=(a=>{if(c.default.isValidElement(a)){let b=a.props,c=b?.className||"",d=/language-(\w+)/.exec(c);return d?d[1]:""}return""})(d);return(0,b.jsxs)("div",{className:"relative my-4 group code-block-wrapper",children:[(0,b.jsxs)("pre",{className:"code-block",...e,children:[h&&(0,b.jsx)("span",{className:"code-language-label",children:h}),d]}),(0,b.jsx)(u.default,{text:g})]})},code:({node:a,inline:c,className:d,children:e,...f})=>c?(0,b.jsx)("code",{className:"inline-code",...f,children:e}):(0,b.jsx)("code",{className:`block-code ${d||""}`,...f,children:e}),table:({node:a,children:c,...d})=>(0,b.jsx)("div",{className:"overflow-x-auto my-4 rounded-lg border border-border-primary",children:(0,b.jsx)("table",{className:"w-full text-sm",...d,children:c})}),th:({node:a,children:c,...d})=>(0,b.jsx)("th",{className:"bg-bg-tertiary text-text-primary font-medium p-2 text-left text-xs border-b border-border-primary",...d,children:c}),td:({node:a,children:c,...d})=>(0,b.jsx)("td",{className:"p-2 text-text-secondary text-xs border-b border-border-primary",...d,children:c}),blockquote:({node:a,children:c,...d})=>(0,b.jsx)("blockquote",{className:"note-blockquote",...d,children:c}),a:({node:a,href:c,children:d,...e})=>(0,b.jsx)("a",{href:c,className:"text-primary-600 hover:text-primary-700 hover:underline",target:"_blank",rel:"noopener noreferrer",...e,children:d}),p:({node:a,children:d,...e})=>c.default.Children.toArray(d).some(a=>"string"==typeof a&&a.includes("\n"))?(0,b.jsx)("p",{className:"text-text-secondary leading-relaxed mb-3 text-sm",...e,children:c.default.Children.map(d,(a,d)=>{if("string"==typeof a){let e=a.split("\n");return(0,b.jsx)(c.default.Fragment,{children:e.map((a,d)=>(0,b.jsxs)(c.default.Fragment,{children:[a,d<e.length-1&&(0,b.jsx)("br",{})]},d))},d)}return a})}):(0,b.jsx)("p",{className:"text-text-secondary leading-relaxed mb-3 text-sm",...e,children:d}),h1:({node:a,children:c,...d})=>(0,b.jsx)("h1",{className:"text-lg font-bold text-text-primary mb-3 mt-5 pb-2 border-b border-border-primary",...d,children:c}),h2:({node:a,children:c,...d})=>(0,b.jsx)("h2",{className:"text-base font-semibold text-text-primary mb-2 mt-4",...d,children:c}),h3:({node:a,children:c,...d})=>(0,b.jsx)("h3",{className:"text-sm font-semibold text-text-primary mb-2 mt-3",...d,children:c}),ul:({node:a,children:c,...d})=>(0,b.jsx)("ul",{className:"list-disc pl-5 mb-3 space-y-1",...d,children:c}),ol:({node:a,children:c,...d})=>(0,b.jsx)("ol",{className:"list-decimal pl-5 mb-3 space-y-1",...d,children:c}),li:({node:a,children:c,...d})=>(0,b.jsx)("li",{className:"text-text-secondary text-sm",...d,children:c}),hr:({node:a,...c})=>(0,b.jsx)("hr",{className:"my-6 border-t border-border-primary",...c}),strong:({node:a,children:c,...d})=>(0,b.jsx)("strong",{className:"font-semibold text-text-primary",...d,children:c})},children:F.content})})}),(0,b.jsxs)("footer",{className:"bg-bg-tertiary px-4 sm:px-6 py-4 border-t border-border-primary",children:["reprint"===F.source_type&&F.source_text&&(0,b.jsxs)("div",{className:"flex items-start gap-2 text-xs text-text-tertiary mb-3 pb-3 border-b border-border-primary",children:[(0,b.jsx)(l.ExternalLink,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-text-tertiary",children:"来源："}),(0,b.jsx)("span",{children:F.source_text})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("button",{onClick:aj,className:"flex items-center gap-1.5 text-xs text-text-tertiary hover:text-text-secondary transition-colors",children:[(0,b.jsx)(g.ArrowLeft,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:"返回列表"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[_&&(0,b.jsxs)("button",{onClick:()=>$(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs bg-primary-100 text-primary-600 rounded-md hover:bg-primary-200 transition-colors",children:[(0,b.jsx)(k.Download,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:"下载资源"})]}),(0,b.jsxs)("button",{onClick:()=>Y(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs bg-primary-100 text-primary-600 rounded-md hover:bg-primary-200 transition-colors",children:[(0,b.jsx)(j,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:"分享笔记"})]})]})]})]})]}),(0,b.jsxs)("footer",{className:"mt-6 border-t border-border-primary py-6 text-center text-sm text-text-tertiary",children:[(0,b.jsxs)("p",{children:["© ",new Date().getFullYear()," Xs-blog. All rights reserved."]}),(0,b.jsx)(t.default,{})]})]})}),L&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:(0,b.jsxs)(e.motion.div,{className:"bg-bg-secondary rounded-xl max-w-sm w-full p-5 shadow-xl border border-border-primary",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},children:[(0,b.jsxs)("div",{className:"text-center mb-5",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,b.jsx)("h3",{className:"text-base font-bold text-text-primary mb-1",children:"需要密码访问"}),(0,b.jsx)("p",{className:"text-xs text-text-tertiary",children:"请输入密码查看笔记内容"})]}),(0,b.jsxs)("form",{onSubmit:ai,className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"password",name:"note-access-password",value:N,onChange:a=>O(a.target.value),placeholder:"请输入密码",className:"w-full px-3 py-2.5 text-sm border border-border-primary rounded-lg bg-bg-tertiary text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",autoFocus:!0,autoComplete:"off",disabled:R}),P&&(0,b.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"var(--error-text)"},children:P}),T>0&&V>0&&(0,b.jsxs)("p",{className:"mt-1.5 text-xs text-text-tertiary",children:["当前已输入错误",T,"次，还可以重试",V,"次"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:aj,className:"flex-1 px-3 py-2 text-sm bg-bg-tertiary text-text-secondary rounded-lg hover:bg-border-primary transition-colors",disabled:R,children:"返回"}),(0,b.jsx)("button",{type:"submit",className:`flex-1 px-3 py-2 text-sm rounded-lg transition-colors ${0===V?"bg-gray-400 cursor-not-allowed":"bg-primary-500 hover:bg-primary-600 disabled:opacity-50"} text-white`,disabled:R||!N||0===V,children:R?"验证中...":0===V?"暂不可用":"确认"})]})]})]})}),X&&F&&(0,b.jsx)(r.default,{noteId:F.id,title:F.title,password:F.password,onClose:()=>Y(!1)}),F&&(0,b.jsx)(s.default,{isOpen:Z,onClose:()=>$(!1),noteId:F.id,isAdmin:!1,password:ab})]})}a.s(["default",()=>y],6581)}];

//# sourceMappingURL=src_app_note_%5Bid%5D_page_tsx_544f5927._.js.map