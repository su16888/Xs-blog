module.exports=[60931,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(119032),e=a.i(352204);let f=a=>{let b=a.toLowerCase();return[".mp4",".webm",".ogg",".mov",".avi"].some(a=>b.endsWith(a)||b.endsWith("#"+a.slice(1)))},g=({src:a,alt:d,onClick:e,className:f=""})=>{let g=(0,c.useRef)(null),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{let a=g.current;if(!a)return;let b=new IntersectionObserver(a=>{a.forEach(a=>{a.isIntersecting&&(k(!0),b.disconnect())})},{rootMargin:"100px",threshold:.1});return b.observe(a),()=>b.disconnect()},[]),(0,b.jsx)("img",{ref:g,src:j?a:void 0,"data-src":a,alt:d,onClick:e,className:`${f} ${h?"sf-img-loaded":"sf-img-loading"}`,onLoad:()=>i(!0),onError:()=>{m(!0),i(!0)},style:{backgroundColor:h?"transparent":void 0,display:l&&!h?"none":void 0}})},h=a=>a.startsWith("http://")||a.startsWith("https://"),i=({video:a,images:e})=>{let g=a||e.find(a=>f(a)),i=(0,c.useRef)(null),j=(0,c.useRef)(null),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{let a=j.current;if(!a)return;let b=new IntersectionObserver(a=>{a.forEach(a=>{a.isIntersecting&&(l(!0),b.disconnect())})},{rootMargin:"50px",threshold:.1});return b.observe(a),()=>b.disconnect()},[]),(0,c.useEffect)(()=>{let a=j.current,b=i.current;if(!a||!b)return;let c=new IntersectionObserver(a=>{a.forEach(a=>{a.isIntersecting||b.paused||b.pause()})},{threshold:0});return c.observe(a),()=>c.disconnect()},[k]),!g)return null;let q=g.replace(/#\.(mp4|webm|ogg|mov|avi)$/i,""),r=h(q)?(0,d.getApiUrl)(`/proxy/video?url=${encodeURIComponent(q)}`):(0,d.getImageUrl)(q);return(0,b.jsx)("div",{className:"sf-video",ref:j,children:k&&(0,b.jsxs)("div",{className:"sf-video-wrapper",children:[(0,b.jsx)("video",{ref:i,src:r,controls:!0,preload:m?"auto":"metadata",onPlay:()=>{p(!1)},onPause:()=>{p(!0)},playsInline:!0}),o&&(0,b.jsx)("div",{className:"sf-video-play-btn",onClick:()=>{n(!0),p(!1),setTimeout(()=>{i.current?.play()},100)},children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})})})]})})},j=({images:a,thumbnails:c,isFourImages:e=!1,onImageClick:i})=>{let j=a.filter(a=>!f(a));if(0===j.length)return null;let k=a=>{let b=j[a];return h(b)?b:c&&c[a]?(0,d.getImageUrl)(c[a]):(0,d.getImageUrl)(b)};return 1===j.length?(0,b.jsx)("div",{className:"sf-pic-grid sf-pic-1",children:(0,b.jsx)(g,{src:k(0),onClick:()=>i(j,0),alt:"åŠ¨æ€å›¾ç‰‡"})}):(0,b.jsx)("div",{className:`sf-pic-grid ${e?"sf-pic-4":""}`,children:j.map((a,c)=>(0,b.jsx)(g,{src:k(c),onClick:()=>i(j,c),alt:`åŠ¨æ€å›¾ç‰‡${c+1}`},c))})},k=c.default.memo(({content:a,maxLines:d=4})=>{let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!1),i=(0,c.useRef)(null),j=(0,c.useRef)(null),k=(0,c.useRef)(0),l=a&&a.includes("<iframe"),{textPart:m,iframePart:n}=(a=>{if(!a)return{textPart:"",iframePart:""};let b=/<iframe[^>]*(?:\/>|>[\s\S]*?<\/iframe>)/gi,c=a.match(b)||[];return{textPart:a.replace(b,"").trim(),iframePart:c.join("")}})(a),o=a=>{if(!a)return"";let b=a.replace(/\n/g,"<br>");return b.replace(/<iframe([^>]*)src=["']([^"']*)["']([^>]*)(\/?>(?:[\s\S]*?<\/iframe>)?)/gi,(a,b,c,d,e)=>{let f=c;f=c.includes("autoplay=")?c.replace(/autoplay=1/gi,"autoplay=0"):c+(c.includes("?")?"&":"?")+"autoplay=0";let g=b.includes("loading=")||d.includes("loading="),h=b.includes("referrerPolicy=")||d.includes("referrerPolicy=")||b.includes("referrerpolicy=")||d.includes("referrerpolicy="),i=e.includes("</iframe>")?e.replace(/^\/?>/,"").replace(/<\/iframe>$/i,""):"",j=`<iframe${b}src="${f}"${d}${g?"":' loading="lazy"'}${h?"":' referrerPolicy="no-referrer"'}>${i}</iframe>`;return c.includes("music.163.com")?`<div class="sf-music163-wrapper">${j}</div>`:j})},p=o(m),q=o(n);(0,c.useEffect)(()=>{k.current+=1},[a]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{let a=i.current,b=j.current;if(!a||!b)return;let c=(parseFloat(getComputedStyle(a).lineHeight)||21)*d;b.scrollHeight>c+5?h(!0):h(!1)},100);return()=>{clearTimeout(a)}},[m,d]);let r=`content-${k.current}`;if(l)return(0,b.jsxs)("div",{className:"sf-text-wrapper",children:[m&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{ref:j,className:"sf-text sf-text-measure",dangerouslySetInnerHTML:{__html:p},style:{position:"absolute",visibility:"hidden",width:"100%",pointerEvents:"none"}}),(0,b.jsx)("div",{ref:i,className:`sf-text ${!e&&g?"sf-text-collapsed":""}`,style:!e&&g?{WebkitLineClamp:d,display:"-webkit-box",WebkitBoxOrient:"vertical",overflow:"hidden"}:void 0,dangerouslySetInnerHTML:{__html:p}}),g&&(0,b.jsx)("span",{className:"sf-text-toggle",onClick:()=>f(!e),children:e?"æ”¶èµ·":"å±•å¼€"})]}),(0,b.jsx)("div",{className:"sf-text sf-iframe-container",dangerouslySetInnerHTML:{__html:q}})]});let s=o(a);return(0,b.jsxs)("div",{className:"sf-text-wrapper",children:[(0,b.jsx)("div",{ref:j,className:"sf-text sf-text-measure",dangerouslySetInnerHTML:{__html:s},style:{position:"absolute",visibility:"hidden",width:"100%",pointerEvents:"none"}}),(0,b.jsx)("div",{ref:i,className:`sf-text ${!e&&g?"sf-text-collapsed":""}`,style:!e&&g?{WebkitLineClamp:d,display:"-webkit-box",WebkitBoxOrient:"vertical",overflow:"hidden"}:void 0,dangerouslySetInnerHTML:{__html:s}},r),g&&(0,b.jsx)("span",{className:"sf-text-toggle",onClick:()=>f(!e),children:e?"æ”¶èµ·":"å±•å¼€"})]})});function l(){let[a,g]=(0,c.useState)({cover_image:"",avatar:"",nickname:"æœ‹å‹åœˆ",signature:"",custom_copyright:""}),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(1),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(!1),x=(0,c.useRef)(null),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(1),[K,L]=(0,c.useState)({x:0,y:0}),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)({x:0,y:0}),[Q,R]=(0,c.useState)(null),S=(0,c.useRef)(null),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)({}),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)({browserTitle:"",browserSubtitle:""});(0,c.useEffect)(()=>{if(!_.browserTitle)return;let a=_.browserTitle;_.browserSubtitle&&(a=`${a} - ${_.browserSubtitle}`),document.title=a},[_.browserTitle,_.browserSubtitle]),(0,c.useEffect)(()=>{(async()=>{try{let[a,b]=await Promise.all([fetch((0,d.getApiUrl)("/settings")),fetch((0,d.getApiUrl)("/page-texts/socialFeed"))]);if(a.ok){let b=await a.json();if(b.success&&b.data){let a={};b.data.forEach(b=>{a[b.key]=b.value}),$("true"===a.socialFeedThemeEnabled)}}if(b.ok){let a=await b.json();a.success&&a.data&&aa({browserTitle:a.data.browserTitle||"æœ‹å‹åœˆ",browserSubtitle:a.data.browserSubtitle||""})}}catch(a){console.error("èŽ·å–è®¾ç½®å¤±è´¥:",a)}})()},[]);let ab=a=>Math.hypot(a[0].clientX-a[1].clientX,a[0].clientY-a[1].clientY),ac=()=>{N(!1)};(0,c.useEffect)(()=>{J(1),L({x:0,y:0})},[A]);let ad=(0,c.useCallback)(async()=>{if(!v&&t){w(!0);try{let a=await fetch((0,d.getApiUrl)(`/social-feed/posts?page=${r+1}&limit=10`));if(a.ok){let b=await a.json();if(b.success&&b.data?.posts){let a=b.data.posts;a.length<10&&u(!1),a.length>0?(m(b=>[...b,...a]),s(a=>a+1)):u(!1)}}}catch(a){console.error("åŠ è½½æ›´å¤šå¤±è´¥:",a)}finally{w(!1)}}},[r,v,t]);(0,c.useEffect)(()=>{let a=x.current;if(!a)return;let b=new IntersectionObserver(a=>{a[0].isIntersecting&&t&&!v&&!n&&ad()},{rootMargin:"100px",threshold:.1});return b.observe(a),()=>b.disconnect()},[t,v,n,ad]),(0,c.useEffect)(()=>{(async()=>{try{o(!0),q(null);let[a,b]=await Promise.all([fetch((0,d.getApiUrl)("/social-feed/profile")),fetch((0,d.getApiUrl)("/social-feed/posts?page=1&limit=10"))]);if(a.ok){let b=await a.json();b.success&&b.data&&g(b.data)}if(b.ok){let a=await b.json();if(a.success&&a.data?.posts){let b=a.data.posts;m(b),b.length<10&&u(!1)}}}catch(a){console.error("åŠ è½½æ•°æ®å¤±è´¥:",a),q("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{o(!1)}})()},[]),(0,c.useEffect)(()=>{let a=()=>{U(window.scrollY>300)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]),(0,c.useEffect)(()=>{if(!C)return;let a=a=>{"ArrowLeft"===a.key&&A>0?B(a=>a-1):"ArrowRight"===a.key&&A<y.length-1?B(a=>a+1):"Escape"===a.key&&af()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[C,A,y.length]);let ae=(0,c.useCallback)((a,b)=>{z(a.map(a=>h(a)?a:(0,d.getImageUrl)(a))),B(b),W({}),D(!0),document.body.style.overflow="hidden"},[]),af=()=>{D(!1),document.body.style.overflow="",B(0),z([])},ag=a=>{let b=A+a;b>=0&&b<y.length&&B(b)};return n?(0,b.jsx)("div",{className:`sf-page ${X?"sf-dark":"sf-light"}`,children:(0,b.jsx)("div",{className:"sf-loading",children:"åŠ è½½ä¸­..."})}):p?(0,b.jsx)("div",{className:`sf-page ${X?"sf-dark":"sf-light"}`,children:(0,b.jsxs)("div",{className:"sf-error",children:[(0,b.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"ðŸ˜”"}),(0,b.jsx)("div",{children:p})]})}):(0,b.jsxs)("div",{className:`sf-page ${X?"sf-dark":"sf-light"}`,children:[(0,b.jsxs)("div",{className:"sf-container",children:[(0,b.jsxs)("div",{className:"sf-header",children:[!Z&&(0,b.jsx)("a",{href:"/",className:"sf-back-home",title:"è¿”å›žé¦–é¡µ",children:(0,b.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,b.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),(0,b.jsx)("img",{className:"sf-cover",src:a.cover_image?(0,d.getImageUrl)(a.cover_image):"/pyqbj.png",alt:"å°é¢"}),(0,b.jsx)("div",{className:"sf-nickname",children:a.nickname||"Arran"}),(0,b.jsx)("div",{className:"sf-signature",children:a.signature||"åˆ†äº«ç”Ÿæ´»ï¼Œè®°å½•ç¾Žå¥½æ—¶åˆ»"}),(0,b.jsx)("div",{className:"sf-avatar",children:(0,b.jsx)("img",{src:a.avatar?(0,d.getImageUrl)(a.avatar):"/pyqtx.png",alt:"å¤´åƒ"})})]}),(0,b.jsxs)("div",{className:"sf-feed-list",children:[0===l.length?(0,b.jsx)("div",{className:"sf-empty",children:"æš‚æ— åŠ¨æ€"}):l.map(c=>{let e,g,h,l,m;return(0,b.jsxs)("div",{className:"sf-feed-item",children:[(0,b.jsx)("div",{className:"sf-avatar-col",children:(0,b.jsx)("img",{src:a.avatar?(0,d.getImageUrl)(a.avatar):"/pyqtx.png",loading:"lazy",alt:a.nickname})}),(0,b.jsxs)("div",{className:"sf-content-col",children:[(0,b.jsx)("div",{className:"sf-user-name",children:a.nickname||"æœ‹å‹åœˆ"}),(0,b.jsx)(k,{content:c.content,maxLines:4}),(0,b.jsx)(i,{video:c.video,images:c.images||[]}),c.images&&c.images.length>0&&(0,b.jsx)(j,{images:c.images,thumbnails:c.thumbnails,isFourImages:4===c.images.filter(a=>!f(a)).length,onImageClick:ae}),(0,b.jsxs)("div",{className:"sf-footer",children:[(0,b.jsx)("span",{className:"sf-time",children:(e=new Date(c.created_at),h=Math.floor((g=new Date().getTime()-e.getTime())/6e4),l=Math.floor(g/36e5),m=Math.floor(g/864e5),h<1?"åˆšåˆš":h<60?`${h}åˆ†é’Ÿå‰`:l<24?`${l}å°æ—¶å‰`:m<7?`${m}å¤©å‰`:e.toLocaleDateString("zh-CN",{month:"long",day:"numeric"}))}),c.is_pinned&&(0,b.jsx)("span",{className:"sf-pin",children:"ç½®é¡¶"})]})]})]},c.id)}),(0,b.jsxs)("div",{ref:x,className:"sf-load-more",children:[v&&(0,b.jsx)("div",{className:"sf-loading-more",children:"åŠ è½½ä¸­..."}),!t&&l.length>0&&(0,b.jsx)("div",{className:"sf-no-more",children:"å·²åŠ è½½å…¨éƒ¨åŠ¨æ€"})]})]}),(0,b.jsxs)("div",{className:"sf-copyright",children:[a.custom_copyright&&(0,b.jsx)("div",{className:"sf-custom-copyright",children:a.custom_copyright}),(0,b.jsx)(e.default,{})]}),C&&(0,b.jsxs)("div",{className:"sf-lightbox",onTouchStart:a=>{2===a.touches.length?(a.preventDefault(),R(ab(a.touches))):1===a.touches.length&&(I>1?(N(!0),P({x:a.touches[0].clientX-K.x,y:a.touches[0].clientY-K.y})):(H(null),F(a.touches[0].clientX)))},onTouchMove:a=>{if(2===a.touches.length&&null!==Q){a.preventDefault();let b=ab(a.touches),c=b/Q;R(b),J(a=>Math.min(Math.max(a*c,1),5))}else 1===a.touches.length&&(M&&I>1?(a.preventDefault(),L({x:a.touches[0].clientX-O.x,y:a.touches[0].clientY-O.y})):1===I&&H(a.touches[0].clientX))},onTouchEnd:()=>{if(R(null),N(!1),1===I&&null!==E&&null!==G){let a=E-G;a>50&&A<y.length-1&&B(a=>a+1),a<-50&&A>0&&B(a=>a-1)}F(null),H(null)},onMouseMove:a=>{M&&I>1&&L({x:a.clientX-O.x,y:a.clientY-O.y})},onMouseUp:ac,onMouseLeave:ac,children:[(0,b.jsx)("div",{className:"sf-lb-close",onClick:af,children:(0,b.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,b.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,b.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),y.length>1&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:`sf-lb-prev ${0===A?"sf-lb-disabled":""}`,onClick:()=>ag(-1),children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,b.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,b.jsx)("div",{className:`sf-lb-next ${A===y.length-1?"sf-lb-disabled":""}`,onClick:()=>ag(1),children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,b.jsx)("polyline",{points:"9 18 15 12 9 6"})})})]}),(0,b.jsxs)("div",{ref:S,className:"sf-lb-img-container",onWheel:a=>{a.preventDefault();let b=a.deltaY>0?.9:1.1;J(a=>{let c=Math.min(Math.max(a*b,1),5);return 1===c&&L({x:0,y:0}),c})},onMouseDown:a=>{I>1&&(a.preventDefault(),N(!0),P({x:a.clientX-K.x,y:a.clientY-K.y}))},onDoubleClick:()=>{I>1?(J(1),L({x:0,y:0})):J(2)},style:{cursor:I>1?M?"grabbing":"grab":"default"},children:[!V[A]&&(0,b.jsx)("div",{className:"sf-lb-loading",children:(0,b.jsx)("div",{className:"sf-lb-spinner"})}),(0,b.jsx)("img",{src:y[A],alt:"é¢„è§ˆå›¾ç‰‡",className:`sf-lb-img ${V[A]?"sf-lb-img-loaded":"sf-lb-img-loading"}`,style:{transform:`scale(${I}) translate(${K.x/I}px, ${K.y/I}px)`,transition:M?"none":"transform 0.1s ease-out"},onLoad:()=>W(a=>({...a,[A]:!0})),onError:()=>W(a=>({...a,[A]:!0})),draggable:!1})]}),(0,b.jsxs)("div",{className:"sf-lb-counter",children:[A+1," / ",y.length,I>1&&(0,b.jsxs)("span",{className:"sf-lb-zoom-indicator",children:[" Â· ",Math.round(100*I),"%"]})]})]})]}),(0,b.jsx)("div",{className:"sf-theme-btn",onClick:()=>{Y(a=>!a)},title:X?"åˆ‡æ¢æµ…è‰²":"åˆ‡æ¢æ·±è‰²",children:X?(0,b.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,b.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),(0,b.jsx)("div",{className:`sf-back-top ${T?"sf-visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},title:"å›žåˆ°é¡¶éƒ¨",children:(0,b.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=src_app_social-feed_page_tsx_af1afc7a._.js.map