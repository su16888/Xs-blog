# 🚀 Xs-Blog 快速部署指南

**版本**: v1.0.3
**更新日期**: 2025-11-21
**代码状态**: ✅ 已优化构建，生产就绪

---

## ⚡ 3 分钟快速部署

### 📋 前置要求

- ✅ Node.js >= 18.0.0
- ✅ MySQL >= 5.7
- ✅ 已创建数据库 `xsblog888`

---

## 🎯 部署步骤（只需 3 步）

### 第 1 步：初始化数据库

```bash
# 导入数据库
mysql -u root -p xsblog888 < database/schema.sql
```

✅ **完成**：数据库已创建，默认管理员账号 `admin/admin123`

---

### 第 2 步：修改配置文件

#### **后端配置** `backend/.env`

**必须修改的配置**（只需改这 2 项）：

```bash
# 1. 数据库密码（必须修改）
DB_PASSWORD=你的MySQL密码

# 2. JWT 密钥（必须修改，生成随机32位）
JWT_SECRET=请运行命令生成
```

**生成随机密钥**：
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

#### **前端配置** `frontend/.env.production`

**方式一：自动检测模式（推荐，前后端同服务器）**
```bash
PORT=3000
NEXT_PUBLIC_BACKEND_PORT=3001
```
系统会自动使用当前访问的域名 + 后端端口

**方式二：完整 URL（前后端分离部署）**
```bash
PORT=3000
NEXT_PUBLIC_API_URL=http://后端服务器IP:3001/api
```

**💡 提示**：可随时修改 .env 文件，无需重新构建！

---

### 第 3 步：启动服务

#### **方式一：测试环境**

```bash
# 启动后端
cd backend
npm install --production
node src/app.js

# 启动前端（新开终端）
cd frontend
npm install --production
npm start
```

#### **方式二：生产环境（推荐）**

```bash
# 安装 PM2
npm install -g pm2

# 启动后端
cd backend
npm install --production
pm2 start src/app.js --name xs-blog-backend

# 启动前端
cd ../frontend
npm install --production
mkdir -p logs
pm2 start ecosystem.config.js

# 保存配置（开机自启）
pm2 save
pm2 startup
```

💡 **提示**：前端使用 `ecosystem.config.js` 启动，已配置 2GB 内存限制和自动重启机制。

---

## 🎉 完成！

访问系统：
- 🏠 **前台首页**: http://你的服务器IP:3000
- 🔐 **管理后台**: http://你的服务器IP:3000/admins（固定路径）

**默认账号**: `admin / admin123`
⚠️ **首次登录后请立即修改密码！**

---

## 📝 配置说明（基于混淆后文件）

### 🔧 后端配置 `backend/.env`

| 配置项 | 说明 | 是否必改 |
|--------|------|----------|
| `DB_PASSWORD` | 数据库密码 | ✅ 必须 |
| `JWT_SECRET` | JWT 密钥，至少 32 位 | ✅ 必须 |
| `PORT` | 后端端口 | ⚙️ 可选（默认 3001） |
| `CORS_ORIGIN` | 前端地址（留空=自动检测） | ⚙️ 可选（推荐留空） |

### 🎨 前端配置 `frontend/.env.production`

| 配置项 | 说明 | 是否必改 |
|--------|------|----------|
| `PORT` | 前端端口 | ⚙️ 可选（默认 3000） |
| `NEXT_PUBLIC_API_URL` | API 完整地址（优先级最高） | ⚙️ 可选 |
| `NEXT_PUBLIC_BACKEND_PORT` | 后端端口（自动检测模式） | ⚙️ 可选（推荐） |

**配置优先级**：完整 URL > 自动检测 > 默认值

---

## 🔒 安全建议

1. ✅ **立即修改默认密码**
2. ✅ **使用强密码的 JWT_SECRET**（至少 32 位）
3. ✅ **生产环境启用 HTTPS**
4. ✅ **定期备份数据库**

---

## 🆘 常见问题

### 1. 端口被占用

**错误**: `EADDRINUSE: address already in use`

**解决**:
```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <进程ID> /F

# Linux/Mac
lsof -i :3001
kill -9 <进程ID>
```

### 2. 数据库连接失败

**错误**: `connect ECONNREFUSED`

**检查**:
- ✅ MySQL 服务是否运行
- ✅ 数据库密码是否正确
- ✅ 数据库 `xsblog888` 是否已创建

### 3. CORS 跨域错误

**错误**: `Access-Control-Allow-Origin`

**原因**: 前后端分离部署时，后端未配置前端地址

**解决**:
- 前后端同服务器：保持 `CORS_ORIGIN=` 为空即可
- 前后端不同服务器：修改 `backend/.env` 中的 `CORS_ORIGIN` 为前端完整地址
  ```bash
  CORS_ORIGIN=https://your-frontend-domain.com
  ```

### 4. 前端无法访问后端

**检查**:
- ✅ 后端服务是否已启动
- ✅ 防火墙是否开放 3001 端口
- ✅ 服务器安全组是否开放端口

---

**祝您使用愉快！** 🎉
