(function(_0x40cac0,_0x14c0e2){const _0x5b4a3f=_0x40cac0();function _0x50d96f(_0x4fab82,_0xd21635,_0x19efa2,_0x174534){return _0x_0x3ccf(_0xd21635-0x33d,_0x174534);}function _0x47f378(_0x55a3b8,_0x111207,_0x4a5943,_0x59e04a){return _0x_0x3ccf(_0x59e04a-0x11f,_0x4a5943);}while(!![]){try{const _0x662697=-parseInt(_0x47f378(0x28a,0x22c,0x25f,0x26b))/(0xb6c+-0x1a0d+0xea2)*(parseInt(_0x47f378(0x288,0x27b,0x238,0x272))/(-0x8e7*0x3+0x2065*0x1+-0x1*0x5ae))+-parseInt(_0x47f378(0x2ed,0x29e,0x2ff,0x2d0))/(0x97+-0xe56*0x1+0xdc2)+-parseInt(_0x47f378(0x29b,0x2c2,0x2c4,0x2af))/(-0x1158+-0x1e85+0x1*0x2fe1)*(-parseInt(_0x47f378(0x28f,0x261,0x280,0x25b))/(-0xad*-0x5+-0x164f+-0x63*-0x31))+-parseInt(_0x50d96f(0x44a,0x487,0x445,0x496))/(0x1*0x26b+-0x155b+0x12f6)+-parseInt(_0x50d96f(0x53b,0x4fc,0x4e4,0x541))/(-0xf4*-0x7+-0x1d09*0x1+0x1664)*(-parseInt(_0x50d96f(0x4e6,0x49e,0x45e,0x4bf))/(0x2462*-0x1+-0x2397+0x1*0x4801))+-parseInt(_0x50d96f(0x4be,0x49c,0x46c,0x49e))/(0x2*-0x77c+-0x1*-0x21ee+-0x12ed)+-parseInt(_0x47f378(0x2cd,0x2ab,0x301,0x2c1))/(-0x1*-0x14ec+-0x337*-0xa+-0x1a84*0x2)*(-parseInt(_0x47f378(0x2df,0x2c6,0x2c7,0x2cc))/(0x8aa+-0xa6*0x30+0x1681));if(_0x662697===_0x14c0e2)break;else _0x5b4a3f['push'](_0x5b4a3f['shift']());}catch(_0x1f6b9d){_0x5b4a3f['push'](_0x5b4a3f['shift']());}}}(_0x_0x213b,0x55c33+-0x65e74+0x4a5f4*0x1));function _0x_0x213b(){const _0x972611=['DxrMltG','6k+75y+wie1HCMTKB3DUioAwH+s7TUwKSEI0PtO','6i635y+w5yIg57g75zcn56EW5AsX6lsLoG','z2v0','CMvJB3jKvMLZAxq','y291BNrYEv9Uyw1L','vuvcu2m','z2v0uhvIBgLJtM90zurPC2TZ','z2v0ugfZC3DVCMrbDhrLBxb0u3rHDhvZ','zxjYB3i','CMXZu2S','z2v0uhvIBgLJtM90zvrHz1n0yxrZ','zgf0yq','l3nVy2LHBc1SAw5RCW','ChjVEhLwAwrLBW','yM9KEq','te9cs28','zg9JC09YzgvY','z2v0uhvIBgLJu29JAwfStgLUA3m','yxbWBhK','C3rHDhvZ','l2DHBgXLCMLLCW','ota3mdG0svrXrfDb','6i635y+w5PAh5QgJ5O6s5BQp6ywn572U5AsX6lsLoG','DNnQtwW','l21LDgfKyxrH','ANnVBG','z2v0uhvIBgLJq2f0zwDVCMLLCW','5AEt5zcn44cb6igu57o75PA55BYp5zkm5yAf5A655lIn6io95lI656M6','C3vJy2vZCW','CgfYC2u','6AQm6k+b56cb6zsz6k+V5OIw5BEY6l+h5PYF','CM9SBgjHy2S','DxnL','z2v0uhvIBgLJu2v0DgLUzW','CgfYyw1Z','Cg9ZDa','ExrVvvi','l3bYB2zPBgu','5lI76kAbsvdMN6xOR6lMNi3LIQhLPlhOTkxVViZLSj3OR5xLPiFNLkJMNi3LIQe6','ntm4oti1mgvUqMToyW','AM9PBG','Dgv4Da','DMfSDwu','y2L0Eq','C2vHCMnO','Bg9N','ywnJzxnZ','vxnLCI1bz2vUDa','6AQm6k+b56cb5lIn6io95lI656M6','C3rHDa','mtfms0zjB1u','l21HCMTKB3DUlZPMAwXLBMfTzq','l3zPC2L0','y291BNrYEq','mJCZodCZEfbKy25g','Dg9tDhjPBMC','6i635y+w5A6I5OI356UVsvdLPlhOTku6','l3nLCNzPy2uTy2f0zwDVCMLLCW','CMvHzgrPCG','l25VDgvZl2nHDgvNB3jPzxmVBgLZDa','CMvNAw9UtMfTzq','l2DHBgXLCNKTy2f0zwDVCMLLCW','Ahr0CdOVl2LWlwfWAs5JB20VANnVBI8','5O+q5lQK55wz6kIa5AsX6lsLoG','6i635y+w55wz6kIa5yIg57g75AsX6lsL','5PYQ5yIg57g7','l3bYB21V','Ae9gDgK','mJCZu0jnBKrc','5PAh5lU25lIn5A2y5zYO','p2XHBMC9EMGTq04','5PQc5PEG5Rov6i635y+w','l2DHBgXLCMLLCY86Awq','zw5KC1DPDgG','quLdufu','zMLUze9Uzq','z2v0uhvIBgLJuhjVzMLSzq','55sF5OIq6AQm6k+b56cb5AsX6lsL','l25VDgvZlZPPza','6i635y+w5A6I5OI356UVsvdLPlhOTku','l3bYB3H5l3zPzgvV','nuLRrxjTEG','vhf4C2K','z2v0uhvIBgLJu2v0DgLUz3m','kcGOlISPkYKRksSK','vNP6veO','Dg9ku09o','z2v0uhvIBgLJu2L0zxm','uw9ntNi','zMLSDgvY','z2v0ugfNzvrLEhq','C2L6zq','z2v0uhvIBgLJu2vYDMLJzxm','l21LC3nHz2vZ','AMnlChy','mJG0nZq3nePmDvvqsW','CMvNAw9U','mwnMvu1UyW','l2nHChrJAge','ENbHvfO','zxHWB3j0CW','CNbJEfC','l3nLCNzPy2vZlZPPza','l25VDgvZlZPPzc9KAxnRCW','ody2mtHYyKzPDw0','l25VDgvZlZPPzc92zxjPzNK','5y+r6ycb6ykU5lU26ycA55+L5AsX6lsLoG','l3nLDhrPBMDZ','Aw5JBhvKzxm','lM1K','BwvZC2fNzq','zw52','qvnd','5PEG5Pwi55Qe5PAh5lU25zcn','BwTKAxi','l2DHBgXLCMLLCY86AwqVDMvYAwz5','mtiZnty5mu1bCxbQva','z2v0tM90zunHDgvNB3jPzxm','ndq5odrjwwLlDM8','l3nVy2LHBc1MzwvK','lI4VlI4VlI4VzNjVBNrLBMqVChvIBgLJl21HCMTKB3DU','sLnbtgO','6k+75y+w55UU5B2v5AsX6lsL','l3bHz2uTDgv4Dhm','tufss0rpv05FreLs','z2v0qwXSugfNzvrLEhrZ','DMvYAwz5r2fSBgvYEvbHC3n3B3jK','6k+75y+wie1HCMTKB3DUioEBRUw9LEwKSEI0PtO','z2v0u2L0zxnhCM91CgvKqNLdyxrLz29YEq','5Ash55sOsvdMN6xOR6lMNi3LIQhKUz/LPlhOTku6','6i635y+w55wz6kIa5yIg57g75AsX6lsLoG','vejdvvG','ywXxq0i','6k+75y+w5PAh5lU25AsX6lsL','55sF5OIq6AQm6k+b56cb5AsX6lsLoG','BMfTzq','C3rYAw5NAwz5','rxLoA2y','l3nLDhrPBMDZlZPRzxK','z2v0uhvIBgLJtM90zxm','55wz6kIa5O+q5lQK5OIq5yQF77Ym5OIr5lUS5lYA5Bc95B+R5Ase55cg','z2v0uhvIBgLJtM90zuj5swq','te1NtNu'];_0x_0x213b=function(){return _0x972611;};return _0x_0x213b();}const _0x_0x41b068=(function(){let _0x115156=!![];return function(_0x1b9506,_0xa0c272){const _0xb0dcfa=_0x115156?function(){if(_0xa0c272){const _0x1ef2bd=_0xa0c272['apply'](_0x1b9506,arguments);return _0xa0c272=null,_0x1ef2bd;}}:function(){};return _0x115156=![],_0xb0dcfa;};}()),_0x_0x17166a=_0x_0x41b068(this,function(){function _0x501c29(_0x39a34b,_0x21ab37,_0x425b5d,_0x1e4dd2){return _0x_0x3ccf(_0x425b5d- -0x26d,_0x21ab37);}function _0x293b07(_0x2dadf4,_0x7c0c43,_0x193d4f,_0x240efc){return _0x_0x3ccf(_0x7c0c43-0x2b8,_0x240efc);}return _0x_0x17166a[_0x501c29(-0xed,-0xca,-0xbb,-0x96)]()[_0x501c29(-0x10d,-0xaa,-0xc6,-0xb0)]('(((.+)+)+)+$')['toString']()['constructor'](_0x_0x17166a)['search'](_0x501c29(-0xf3,-0x10b,-0x12e,-0xec));});function _0x_0x3ccf(_0x201659,_0x414f73){_0x201659=_0x201659-(0x220a+-0xd57+-0x8*0x26f);const _0x486829=_0x_0x213b();let _0x5d58d0=_0x486829[_0x201659];if(_0x_0x3ccf['qDKdSF']===undefined){var _0x593d24=function(_0x14f11b){const _0x4cbede='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xc8458f='',_0xe05f4b='',_0x1540bb=_0xc8458f+_0x593d24;for(let _0x546384=0x2*0x560+-0x24b+0x5*-0x1b1,_0x479206,_0x300d8c,_0x4298e8=-0x25cb+0x1aeb+-0x2*-0x570;_0x300d8c=_0x14f11b['charAt'](_0x4298e8++);~_0x300d8c&&(_0x479206=_0x546384%(-0x2*0xb32+-0x1*-0x67e+0xfea)?_0x479206*(0x74e+-0x347+-0x3c7)+_0x300d8c:_0x300d8c,_0x546384++%(0x1fbe+0x2660+0x3e5*-0x12))?_0xc8458f+=_0x1540bb['charCodeAt'](_0x4298e8+(-0xcbc+0x988+0x33e))-(-0x7c5+-0x3f5+-0x4*-0x2f1)!==0xf7d+-0x1*-0x349+-0x12c6?String['fromCharCode'](0x9d1*0x1+-0xb4d*-0x3+-0x2ab9&_0x479206>>(-(-0x1*-0xff7+-0x1*0x4a9+-0xb4c)*_0x546384&-0x1e98+0x17*0x13f+-0x1f5*-0x1)):_0x546384:-0x4*-0xc5+0x12be*0x1+-0x72*0x31){_0x300d8c=_0x4cbede['indexOf'](_0x300d8c);}for(let _0x358ad8=-0x5*0x38d+-0x2392+-0x1*-0x3553,_0x1f41ed=_0xc8458f['length'];_0x358ad8<_0x1f41ed;_0x358ad8++){_0xe05f4b+='%'+('00'+_0xc8458f['charCodeAt'](_0x358ad8)['toString'](-0x1e*0x2d+-0xea4*-0x1+-0x94e))['slice'](-(0xcaa*0x2+0x151a+0x2e6c*-0x1));}return decodeURIComponent(_0xe05f4b);};_0x_0x3ccf['YKlYmj']=_0x593d24,_0x_0x3ccf['UdKrXe']={},_0x_0x3ccf['qDKdSF']=!![];}const _0x34945d=_0x486829[-0x263d*-0x1+-0x65*0x1+-0x25d8],_0x1dc9c7=_0x201659+_0x34945d,_0x1bf8df=_0x_0x3ccf['UdKrXe'][_0x1dc9c7];if(!_0x1bf8df){const _0xf8b090=function(_0x4effde){this['VMNhVn']=_0x4effde,this['RaDpBi']=[-0x1*-0x16ab+-0x12a4+-0x406,0x47*0x26+0x3b*-0x67+-0x1f*-0x6d,-0x10af+0x47*-0x61+0x2b96],this['LsUMBJ']=function(){return'newState';},this['yudUSA']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['IBhpiX']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xf8b090['prototype']['eTWTIp']=function(){const _0x39f680=new RegExp(this['yudUSA']+this['IBhpiX']),_0x7e27b8=_0x39f680['test'](this['LsUMBJ']['toString']())?--this['RaDpBi'][-0x1*-0xb73+0x47*0x37+-0x1ab3*0x1]:--this['RaDpBi'][-0x1349+-0x41*0x3b+0x2244];return this['UAcjra'](_0x7e27b8);},_0xf8b090['prototype']['UAcjra']=function(_0x5650b6){if(!Boolean(~_0x5650b6))return _0x5650b6;return this['aOsxpX'](this['VMNhVn']);},_0xf8b090['prototype']['aOsxpX']=function(_0x41df96){for(let _0x323ea9=0x2659+0x45*-0x37+-0x1786,_0x315a5c=this['RaDpBi']['length'];_0x323ea9<_0x315a5c;_0x323ea9++){this['RaDpBi']['push'](Math['round'](Math['random']())),_0x315a5c=this['RaDpBi']['length'];}return _0x41df96(this['RaDpBi'][0x270+0x657+-0x8c7]);},new _0xf8b090(_0x_0x3ccf)['eTWTIp'](),_0x5d58d0=_0x_0x3ccf['YKlYmj'](_0x5d58d0),_0x_0x3ccf['UdKrXe'][_0x1dc9c7]=_0x5d58d0;}else _0x5d58d0=_0x1bf8df;return _0x5d58d0;}_0x_0x17166a();const express=require('express'),router=express['Router'](),settingController=require('../controllers/settingController'),profileController=require('../controllers/profileController'),socialLinkController=require('../controllers/socialLinkController'),siteController=require('../controllers/siteController'),noteController=require('../controllers/noteController'),galleryController=require('../controllers/galleryController'),galleryCategoryController=require('../controllers/galleryCategoryController'),serviceController=require('../controllers/serviceController'),serviceCategoryController=require('../controllers/serviceCategoryController'),pageTextController=require('../controllers/pageTextController'),metadataRoutes=require('./metadata'),promoRoutes=require('./promo'),{generateCaptcha,validateCaptcha}=require('../utils/captcha'),Message=require('../models/Message'),MessageCategory=require('../models/MessageCategory'),{sequelize}=require('../config/database'),{checkIPLimit,recordIPSubmission}=require('../utils/ipLimit'),{sendMessageNotification}=require('../utils/email'),{getClientIP,isValidIP,isPrivateIP}=require('../utils/ipHelper');router['get'](_0x_0x3d9525(0x103,0x107,0x12b,0x123),settingController[_0x_0x3d9525(0xe0,0x108,0x138,0x10b)]),router[_0x_0x3b6eda(0x450,0x489,0x491,0x45a)](_0x_0x3d9525(0x134,0x112,0x13b,0x142),settingController[_0x_0x3b6eda(0x4ae,0x4d3,0x4b0,0x4ad)]);function _0x_0x3b6eda(_0x40bd12,_0x5b1ac3,_0x5d0543,_0x35fe53){return _0x_0x3ccf(_0x5d0543-0x314,_0x35fe53);}router[_0x_0x3b6eda(0x45a,0x4b6,0x491,0x4b7)](_0x_0x3b6eda(0x4a0,0x434,0x47a,0x4bf),pageTextController[_0x_0x3d9525(0x141,0x107,0xfb,0x135)]),router['get']('/page-texts/:pageKey',pageTextController[_0x_0x3d9525(0xe8,0x112,0xcb,0x112)]),router['get'](_0x_0x3b6eda(0x4d8,0x48d,0x4b4,0x4d3),profileController[_0x_0x3b6eda(0x502,0x4e4,0x4db,0x4de)]),router[_0x_0x3b6eda(0x4ba,0x4c7,0x491,0x460)](_0x_0x3b6eda(0x4b9,0x4b9,0x49b,0x4c7),socialLinkController[_0x_0x3b6eda(0x462,0x4d5,0x4a0,0x4e7)]),router[_0x_0x3b6eda(0x4bf,0x495,0x491,0x4ad)]('/sites',siteController[_0x_0x3d9525(0xd8,0xd0,0x154,0x10f)]),router['get']('/sites/grouped/by-category',siteController[_0x_0x3d9525(0x164,0x142,0x11a,0x138)]),router[_0x_0x3b6eda(0x450,0x467,0x491,0x462)]('/notes',noteController[_0x_0x3d9525(0x157,0x16f,0x15d,0x143)]),router[_0x_0x3b6eda(0x4b9,0x460,0x491,0x4a9)](_0x_0x3d9525(0x1c6,0x17d,0x15b,0x183),noteController[_0x_0x3d9525(0x147,0x172,0x11a,0x12d)]),router[_0x_0x3b6eda(0x471,0x482,0x491,0x4af)]('/notes/tags/stats',noteController[_0x_0x3b6eda(0x46d,0x4bc,0x499,0x47d)]),router['get']('/notes/password-status',noteController[_0x_0x3b6eda(0x472,0x491,0x496,0x4d4)]),router['get'](_0x_0x3b6eda(0x4e1,0x4df,0x4dd,0x4bf),noteController[_0x_0x3b6eda(0x44f,0x492,0x48c,0x4b8)]),router['post'](_0x_0x3d9525(0x150,0x138,0x100,0x121),noteController['verifyNotePassword']),router[_0x_0x3d9525(0x117,0x102,0x18c,0x14a)](_0x_0x3b6eda(0x49f,0x44b,0x466,0x44e),noteController[_0x_0x3d9525(0x158,0x183,0x11c,0x14e)]),router[_0x_0x3d9525(0x178,0x141,0x11e,0x14a)](_0x_0x3d9525(0x139,0x182,0x15a,0x15c),galleryController['getPublicGalleries']),router[_0x_0x3d9525(0x130,0x17b,0x117,0x14a)](_0x_0x3b6eda(0x4f1,0x4da,0x4d7,0x4be),galleryController['getPublicGallery']);function _0x_0x3d9525(_0x52c6b6,_0x1efa52,_0x4fe681,_0x5d9d9f){return _0x_0x3ccf(_0x5d9d9f- -0x33,_0x1efa52);}router['post'](_0x_0x3b6eda(0x4a7,0x438,0x472,0x48b),galleryController[_0x_0x3d9525(0x127,0x104,0x14a,0x136)]),router['get'](_0x_0x3d9525(0x195,0x19d,0x142,0x185),galleryCategoryController[_0x_0x3d9525(0x132,0x135,0x142,0x162)]),router[_0x_0x3d9525(0x139,0x168,0x145,0x14a)]('/services',serviceController[_0x_0x3d9525(0x10a,0x119,0xf8,0x114)]),router['get']('/services/grouped/by-category',serviceController['getServicesGroupedByCategory']),router[_0x_0x3d9525(0x11a,0x13f,0x157,0x14a)](_0x_0x3d9525(0x128,0xdb,0x101,0x11e),serviceController['getPublicService']),router[_0x_0x3b6eda(0x47b,0x491,0x491,0x496)](_0x_0x3d9525(0x14a,0x177,0x14d,0x181),serviceCategoryController[_0x_0x3b6eda(0x4c3,0x4b4,0x4a9,0x462)]),router['get']('/message-categories',async(_0x5ad152,_0x4c8679)=>{function _0x5576b9(_0x1a39af,_0x467002,_0x2c555e,_0x58ec43){return _0x_0x3b6eda(_0x1a39af-0x1d1,_0x467002-0x14b,_0x1a39af- -0x1f3,_0x2c555e);}function _0x56f5af(_0x3abfb5,_0x4f4c46,_0x265b45,_0x369fff){return _0x_0x3d9525(_0x3abfb5-0x55,_0x3abfb5,_0x265b45-0x1e2,_0x4f4c46-0x3ca);}try{if('nLLoZ'===_0x5576b9(0x261,0x244,0x28d,0x298))_0x52ab36=_0x6abf18['id'],_0x45d4e2=_0x3d7af7['text'];else{const _0x53723d=await MessageCategory['findAll']({'order':[['sort_order',_0x56f5af(0x4e6,0x4f2,0x4b9,0x4c6)],['name',_0x56f5af(0x518,0x4f2,0x4ac,0x53a)]]});_0x4c8679[_0x5576b9(0x2b5,0x2dc,0x2c2,0x2a9)]({'success':!![],'data':_0x53723d});}}catch(_0x50eddb){console[_0x56f5af(0x54d,0x51a,0x53d,0x560)](_0x5576b9(0x28e,0x2a2,0x2c3,0x24c),_0x50eddb),_0x4c8679[_0x56f5af(0x4ea,0x525,0x506,0x507)](0x330+-0x309+0x1cd)['json']({'success':![],'message':_0x56f5af(0x536,0x552,0x54e,0x595)});}});async function getCategoryName(_0x4c7a21){function _0x56d416(_0x3f8a99,_0xee6885,_0x244572,_0x2d84a5){return _0x_0x3d9525(_0x3f8a99-0x82,_0x244572,_0x244572-0x66,_0xee6885-0x31c);}function _0x1f510a(_0x323562,_0x544834,_0x5acf22,_0x36b967){return _0x_0x3b6eda(_0x323562-0xb7,_0x544834-0x13d,_0x36b967- -0x5dc,_0x5acf22);}try{const _0x3550b0=await MessageCategory['findByPk'](_0x4c7a21);return _0x3550b0?_0x3550b0[_0x1f510a(-0x190,-0x190,-0x156,-0x156)]:_0x56d416(0x4a2,0x4a5,0x4ca,0x4d6);}catch(_0x20f84f){return console[_0x1f510a(-0x12c,-0x147,-0x188,-0x145)](_0x1f510a(-0x136,-0x15b,-0x12e,-0x14c),_0x20f84f),_0x1f510a(-0x152,-0xd4,-0xe0,-0x10c);}}router['post'](_0x_0x3b6eda(0x43b,0x458,0x45c,0x44a),async(_0x1b349c,_0x3e9264)=>{const _0x2d7c26=await sequelize['transaction']();function _0x597e4e(_0x48996f,_0xc407c6,_0x2a1acf,_0x5d6c02){return _0x_0x3b6eda(_0x48996f-0x134,_0xc407c6-0x8e,_0xc407c6- -0x258,_0x2a1acf);}function _0x4a9fd4(_0x1e7bde,_0x2e7f45,_0x2984b8,_0x1ac573){return _0x_0x3d9525(_0x1e7bde-0xd2,_0x2e7f45,_0x2984b8-0x4d,_0x2984b8-0x225);}try{const {name:_0x49313e,contact:_0x2bd380,category_id:_0x266082,content:_0x402d5c,attachments:_0x4f97f4,captcha:_0x2c0d4b,captcha_id:_0x201d50,captcha_text:_0x3f8673}=_0x1b349c[_0x597e4e(0x240,0x245,0x26f,0x248)],_0x430e4f=getClientIP(_0x1b349c),_0x3ffe22=_0x1b349c['get'](_0x4a9fd4(0x373,0x367,0x39c,0x38e));if(!_0x49313e||!_0x2bd380||!_0x402d5c){if(_0x597e4e(0x22f,0x240,0x223,0x208)===_0x597e4e(0x258,0x24e,0x276,0x249))console[_0x4a9fd4(0x3ac,0x35f,0x375,0x379)]('发送邮件通知失败:',_0x2940e0);else return _0x3e9264[_0x597e4e(0x20c,0x24a,0x242,0x216)](-0x1f19+0x1da+0x3*0xa45)[_0x4a9fd4(0x388,0x3c9,0x386,0x376)]({'success':![],'message':_0x4a9fd4(0x375,0x350,0x388,0x37f)});}let _0x59d733,_0x5d38bf;if(_0x2c0d4b&&_0x2c0d4b['id']&&_0x2c0d4b['text'])_0x59d733=_0x2c0d4b['id'],_0x5d38bf=_0x2c0d4b[_0x597e4e(0x258,0x260,0x21d,0x27f)];else{if(_0x201d50&&_0x3f8673)_0x59d733=_0x201d50,_0x5d38bf=_0x3f8673;else return _0x597e4e(0x1ef,0x235,0x22c,0x1f7)!==_0x4a9fd4(0x36b,0x3ad,0x366,0x32e)?_0x3e9264[_0x4a9fd4(0x3ad,0x34f,0x380,0x366)](-0x4d9+0x25e1+-0x1f78)['json']({'success':![],'message':_0x4a9fd4(0x36e,0x377,0x39d,0x3c9)}):process[_0x4a9fd4(0x323,0x32c,0x34c,0x33a)][_0x4a9fd4(0x333,0x31e,0x359,0x31b)];}if(!validateCaptcha(_0x59d733,_0x5d38bf))return _0x3e9264[_0x597e4e(0x263,0x24a,0x249,0x287)](0x3*0xf1+0x755+0x64*-0x16)['json']({'success':![],'message':_0x597e4e(0x239,0x255,0x29b,0x237)});const _0xf1c2cd=await checkIPLimit(_0x430e4f);if(!_0xf1c2cd['allowed'])return _0x4a9fd4(0x380,0x33f,0x372,0x34f)==='UEBSc'?_0x3e9264[_0x597e4e(0x24d,0x24a,0x260,0x25b)](0xf94*0x1+0xead+0x2*-0xe4a)[_0x4a9fd4(0x35a,0x3ab,0x386,0x342)]({'success':![],'message':_0xf1c2cd[_0x597e4e(0x222,0x215,0x214,0x23e)]}):_0x5650b6[_0x4a9fd4(0x38a,0x3a2,0x380,0x3a6)](0xbfc+-0x216e+-0x136*-0x13)[_0x4a9fd4(0x3ba,0x3a1,0x386,0x349)]({'success':![],'message':_0x4a9fd4(0x31e,0x36f,0x34e,0x312)});const _0x4adf6e=await Message['create']({'name':_0x49313e,'contact':_0x2bd380,'category_id':_0x266082||null,'content':_0x402d5c,'attachments':_0x4f97f4?JSON[_0x597e4e(0x258,0x22f,0x246,0x22b)](_0x4f97f4):null,'ip_address':_0x430e4f,'user_agent':_0x3ffe22,'status':'pending'},{'transaction':_0x2d7c26});await recordIPSubmission(_0x430e4f);if(sendMessageNotification){const _0xd2d461=_0x266082?await getCategoryName(_0x266082):_0x4a9fd4(0x3c7,0x3ab,0x3ae,0x3f2);sendMessageNotification({..._0x4adf6e[_0x597e4e(0x206,0x1fd,0x1be,0x23d)](),'created_at':_0x4adf6e['created_at']},_0xd2d461)['catch'](_0x503252=>{function _0x4157f3(_0x4819eb,_0x36968d,_0x2c50f0,_0x346285){return _0x597e4e(_0x4819eb-0x85,_0x2c50f0- -0x2c,_0x4819eb,_0x346285-0x19d);}console['error'](_0x4157f3(0x1a3,0x1b2,0x1e5,0x1d8),_0x503252);});}await _0x2d7c26['commit'](),_0x3e9264[_0x4a9fd4(0x3ab,0x3c7,0x380,0x341)](-0x6b8+-0xb5d*0x2+0x47*0x6d)[_0x4a9fd4(0x3a6,0x3c6,0x386,0x354)]({'success':!![],'message':_0x4a9fd4(0x3a3,0x382,0x369,0x35f),'data':{'id':_0x4adf6e['id']}});}catch(_0x3fccf0){await _0x2d7c26[_0x597e4e(0x28e,0x256,0x23f,0x276)](),console[_0x597e4e(0x24b,0x23f,0x238,0x24d)](_0x4a9fd4(0x389,0x37b,0x3ac,0x39d),_0x3fccf0),_0x3e9264[_0x597e4e(0x292,0x24a,0x202,0x284)](0x17*-0x26+-0x1*-0xb41+-0x5e3*0x1)[_0x597e4e(0x215,0x250,0x21d,0x20d)]({'success':![],'message':'提交留言失败'});}}),router[_0x_0x3b6eda(0x455,0x455,0x491,0x4a7)](_0x_0x3b6eda(0x4a1,0x45e,0x461,0x41a),(_0xfa423b,_0x391693)=>{function _0x290987(_0x307f5e,_0x4d09d6,_0xf26b88,_0x40ed58){return _0x_0x3b6eda(_0x307f5e-0xd8,_0x4d09d6-0x1b7,_0x40ed58- -0x134,_0x307f5e);}function _0x3e0074(_0x1abcc6,_0x15485f,_0x93c7,_0x1aa711){return _0x_0x3d9525(_0x1abcc6-0x82,_0x1aa711,_0x93c7-0x102,_0x1abcc6-0x21a);}try{const _0x37c7bb=generateCaptcha();_0x391693[_0x290987(0x36b,0x380,0x39c,0x374)]({'success':!![],'data':{'id':_0x37c7bb['id'],'image':_0x37c7bb[_0x290987(0x367,0x37b,0x349,0x366)]}});}catch(_0x5e66ef){_0x290987(0x3db,0x3a6,0x382,0x39e)!==_0x3e0074(0x3a5,0x363,0x3c5,0x3da)?console[_0x290987(0x324,0x366,0x378,0x363)](_0x3e0074(0x378,0x374,0x391,0x3a1),_0x38a2a6):(console[_0x3e0074(0x36a,0x389,0x363,0x37e)](_0x3e0074(0x358,0x31f,0x392,0x33f),_0x5e66ef),_0x391693[_0x290987(0x357,0x32f,0x354,0x36e)](0xcb*-0x29+0x2014+-0x1*-0x263)[_0x3e0074(0x37b,0x365,0x36f,0x39a)]({'success':![],'message':_0x290987(0x383,0x3a7,0x3cc,0x3a8)}));}}),router[_0x_0x3b6eda(0x4bb,0x4ca,0x491,0x4c9)]('/client-ip',async(_0x188be6,_0xd681c5)=>{function _0x2dc5fb(_0x58d0e3,_0xee045d,_0x328e21,_0x5359eb){return _0x_0x3b6eda(_0x58d0e3-0x11b,_0xee045d-0x7b,_0xee045d- -0x541,_0x5359eb);}function _0x2bf278(_0x14ca0b,_0x407ef7,_0x5aad82,_0x55c769){return _0x_0x3d9525(_0x14ca0b-0x1a3,_0x407ef7,_0x5aad82-0x14b,_0x5aad82-0x138);}try{if('ytoUR'!==_0x2bf278(0x268,0x26e,0x2a4,0x2bb))return _0x15c780[_0x2bf278(0x292,0x258,0x293,0x2cd)](-0x1d6e+-0x2*-0x813+-0x32*-0x4c)[_0x2dc5fb(-0xd5,-0x99,-0x5d,-0x98)]({'success':![],'message':_0x2bf278(0x2a3,0x28d,0x2b0,0x2c0)});else{const _0x1910cc=getClientIP(_0x188be6),_0x2df4f1=isPrivateIP(_0x1910cc),_0x197d5f=isValidIP(_0x1910cc);let _0x53b522=_0x2dc5fb(-0xa6,-0x6b,-0x3f,-0x40),_0x4e8c01=_0x2dc5fb(-0x9d,-0x6b,-0x7d,-0x38);if(_0x197d5f&&!_0x2df4f1&&_0x1910cc!=='unknown')try{const _0xc767cb=await fetch(_0x2dc5fb(-0x73,-0x74,-0x96,-0xa3)+_0x1910cc+_0x2dc5fb(-0x2d,-0x6c,-0x25,-0x4f),{'timeout':0xbb8});if(_0xc767cb['ok']){if(_0x2dc5fb(-0x71,-0xa3,-0xb8,-0xde)!=='ccSjD'){const _0x6576bc=await _0xc767cb[_0x2dc5fb(-0x61,-0x99,-0x8e,-0xb6)]();if(_0x6576bc['status']===_0x2dc5fb(-0xbd,-0x96,-0xbe,-0xca)){if(_0x2bf278(0x207,0x236,0x248,0x247)===_0x2bf278(0x27d,0x221,0x248,0x226)){_0x53b522=_0x6576bc['country']||'暂无法获取',_0x4e8c01=_0x6576bc[_0x2dc5fb(-0x9c,-0x87,-0x5a,-0x64)]||'暂无法获取';if(_0x6576bc[_0x2dc5fb(-0x8a,-0x76,-0x61,-0x9a)]&&_0x6576bc[_0x2dc5fb(-0xaf,-0x76,-0x9f,-0x42)]!==_0x6576bc[_0x2bf278(0x2b0,0x28a,0x2ab,0x2bc)]){if('Tqxsi'===_0x2bf278(0x279,0x234,0x242,0x27f))_0x53b522=_0x6576bc['country']+'\x20'+_0x6576bc[_0x2bf278(0x2e7,0x2f3,0x2bc,0x2ae)];else try{const _0x2cc9c2=_0x4e9a43();_0x497114[_0x2bf278(0x289,0x2d5,0x299,0x2c9)]({'success':!![],'data':{'id':_0x2cc9c2['id'],'image':_0x2cc9c2[_0x2bf278(0x2a2,0x25b,0x28b,0x29b)]}});}catch(_0x38d198){console[_0x2bf278(0x2a5,0x241,0x288,0x2ad)](_0x2bf278(0x231,0x235,0x276,0x2ac),_0x38d198),_0x535586[_0x2dc5fb(-0xb8,-0x9f,-0xb0,-0x5d)](-0x1*-0x1b62+0x602*0x6+0x102*-0x3d)[_0x2bf278(0x298,0x251,0x299,0x266)]({'success':![],'message':_0x2dc5fb(-0x5b,-0x65,-0x5b,-0x4a)});}}}else _0x3ac76a=_0x1b22bf,_0x55bb9e=_0x5b7ef5;}}else _0x83050a=_0x1826c5[_0x2dc5fb(-0x42,-0x7d,-0xa1,-0x47)]+'\x20'+_0x1d6782[_0x2bf278(0x2ce,0x2db,0x2bc,0x2c6)];}}catch(_0x3f858a){console[_0x2bf278(0x2de,0x2b5,0x2ad,0x2b1)](_0x2bf278(0x2e9,0x26b,0x2a6,0x267),_0x3f858a[_0x2dc5fb(-0x8f,-0xd4,-0xfa,-0xf5)]);try{if(_0x2dc5fb(-0xed,-0xbe,-0xae,-0xdc)!==_0x2bf278(0x29d,0x290,0x273,0x247)){const backupResponse=await fetch('https://ipapi.co/'+_0x1910cc+'/json/',{'timeout':0xbb8});if(backupResponse['ok']){const _0x367e8f=await backupResponse[_0x2dc5fb(-0xb9,-0x99,-0x68,-0x86)]();_0x367e8f[_0x2dc5fb(-0x41,-0x87,-0xa9,-0x4d)]&&(_0x53b522=_0x367e8f['country_name']||_0x2bf278(0x2a2,0x297,0x2c7,0x2cb),_0x4e8c01=_0x367e8f[_0x2bf278(0x2c5,0x29b,0x2ab,0x2ec)]||'暂无法获取',_0x367e8f[_0x2dc5fb(-0xd9,-0xe2,-0xc1,-0xb1)]&&_0x367e8f[_0x2dc5fb(-0x128,-0xe2,-0x128,-0x102)]!==_0x367e8f[_0x2dc5fb(-0x64,-0x87,-0x45,-0xc2)]&&(_0x53b522=_0x367e8f[_0x2dc5fb(-0xeb,-0xae,-0x7e,-0xac)]+'\x20'+_0x367e8f[_0x2bf278(0x259,0x272,0x250,0x289)]));}}else console[_0x2dc5fb(-0xe3,-0xaa,-0x9d,-0xb9)]('读取\x20Markdown\x20目录失败:',_0x164c5d),_0x44a115[_0x2dc5fb(-0xdf,-0x9f,-0x74,-0xd3)](0xe*-0x139+0x7b7+0xb5b)[_0x2bf278(0x2c1,0x264,0x299,0x26d)]({'success':![],'message':_0x2dc5fb(-0xc7,-0xc8,-0x8a,-0xa5)});}catch(_0x5ceaae){if(_0x2bf278(0x255,0x20c,0x253,0x20c)!=='FLubT')console[_0x2dc5fb(-0x97,-0x85,-0x3d,-0xbf)](_0x2bf278(0x26a,0x24a,0x271,0x251),_0x5ceaae[_0x2dc5fb(-0x112,-0xd4,-0x94,-0xa0)]);else{const _0x50bfde=_0x2f347d();_0x43783f[_0x2dc5fb(-0x66,-0x99,-0x5b,-0x8e)]({'success':!![],'data':{'id':_0x50bfde['id'],'image':_0x50bfde[_0x2dc5fb(-0xdd,-0xa7,-0xab,-0x61)]}});}}}_0xd681c5[_0x2dc5fb(-0xd5,-0x99,-0x92,-0x84)]({'success':!![],'data':{'ip':_0x1910cc,'isPrivate':_0x2df4f1,'isValid':_0x197d5f,'location':_0x53b522,'city':_0x4e8c01}});}}catch(_0x24a32c){if(_0x2dc5fb(-0xad,-0xe4,-0x11e,-0x10b)!==_0x2dc5fb(-0xa1,-0xe4,-0xab,-0xb2))return _0x323ea9[_0x2bf278(0x257,0x2b1,0x293,0x259)](-0xb42*0x1+-0x2*-0x167+-0x6b*-0x18)[_0x2bf278(0x28a,0x2a8,0x299,0x2dd)]({'success':![],'message':_0x2dc5fb(-0x29,-0x6d,-0x2a,-0x89)});else console[_0x2dc5fb(-0x71,-0xaa,-0x81,-0xe0)](_0x2bf278(0x2a0,0x2b9,0x2b8,0x27d),_0x24a32c),_0xd681c5['status'](-0x2014+-0x8a*-0x1d+0x1266)[_0x2dc5fb(-0xcf,-0x99,-0x7d,-0xc2)]({'success':![],'message':_0x2bf278(0x2d4,0x2e6,0x2cf,0x2d3)});}}),router['use'](_0x_0x3d9525(0x1a7,0x18f,0x1a6,0x160),metadataRoutes),router['use'](_0x_0x3b6eda(0x4a9,0x4a1,0x4d1,0x4e6),promoRoutes);const socialFeedRoutes=require('./socialFeed');router[_0x_0x3d9525(0x162,0x199,0x17b,0x168)](_0x_0x3b6eda(0x477,0x481,0x476,0x486),socialFeedRoutes);const statisticsController=require('../controllers/statisticsController');router[_0x_0x3b6eda(0x48d,0x494,0x4b2,0x49e)](_0x_0x3b6eda(0x48f,0x4aa,0x4c3,0x502),statisticsController[_0x_0x3d9525(0x15e,0x120,0x140,0x14b)]);const proxyController=require('../controllers/proxyController');router[_0x_0x3d9525(0x120,0x131,0x119,0x14a)](_0x_0x3d9525(0x100,0x118,0xc6,0x108),proxyController[_0x_0x3b6eda(0x4d7,0x4c2,0x49c,0x479)]);const path=require('path'),fs=require('fs').promises,getMarkdownDir=()=>{function _0x3f07f4(_0x1de437,_0x11a9a9,_0x480277,_0x578c45){return _0x_0x3b6eda(_0x1de437-0x57,_0x11a9a9-0x29,_0x11a9a9- -0x4dd,_0x1de437);}if(process[_0x3f07f4(-0x7e,-0x6f,-0x2a,-0x8d)][_0x460bf9(0xfb,0x12d,0x122,0xf0)])return process[_0x3f07f4(-0x7f,-0x6f,-0x96,-0x8a)][_0x3f07f4(-0x39,-0x62,-0xa1,-0x38)];function _0x460bf9(_0x4505e6,_0x45f376,_0x291499,_0x117cf0){return _0x_0x3d9525(_0x4505e6-0x32,_0x45f376,_0x291499-0xc8,_0x4505e6- -0x39);}return path[_0x3f07f4(-0x48,-0x26,0x21,-0x57)](__dirname,_0x3f07f4(-0x85,-0x66,-0x63,-0x2c));};router['get'](_0x_0x3d9525(0x1bd,0x142,0x16a,0x17b),async(_0x1bb9da,_0x375036)=>{function _0x30dd36(_0x17ab42,_0x4111b1,_0x4d51ab,_0xe1684c){return _0x_0x3d9525(_0x17ab42-0x4b,_0x4d51ab,_0x4d51ab-0xf9,_0x4111b1-0x1c4);}function _0x160c14(_0x5e282f,_0x5328a5,_0x46af6f,_0x8589c9){return _0x_0x3b6eda(_0x5e282f-0x174,_0x5328a5-0xcc,_0x5328a5- -0x19,_0x8589c9);}try{const {filename:_0x24637d}=_0x1bb9da[_0x160c14(0x458,0x498,0x460,0x47f)];if(!_0x24637d['endsWith'](_0x160c14(0x41a,0x453,0x48d,0x43f))||_0x24637d[_0x30dd36(0x2ca,0x2e8,0x2bf,0x2ec)]('..')||_0x24637d[_0x30dd36(0x2fb,0x2e8,0x2f3,0x2a7)]('/')||_0x24637d[_0x160c14(0x46e,0x452,0x431,0x43e)]('\x5c'))return _0x375036['status'](-0x14fc+0x2096+-0xa0a)[_0x160c14(0x4ac,0x48f,0x493,0x4bd)]({'success':![],'message':'无效的文件名'});const _0x26785e=getMarkdownDir(),_0x53ed27=path['join'](_0x26785e,_0x24637d);try{await fs[_0x30dd36(0x363,0x33a,0x2f3,0x345)](_0x53ed27);}catch(_0xa1c208){return _0x30dd36(0x345,0x356,0x391,0x32d)===_0x30dd36(0x2df,0x2f5,0x32e,0x2c6)?_0x2b7c66[_0x30dd36(0x344,0x31f,0x365,0x32c)](-0x89*0x14+-0x19+-0x1*-0xc5d)[_0x160c14(0x4d6,0x48f,0x451,0x4a9)]({'success':![],'message':_0x30dd36(0x316,0x327,0x313,0x301)}):_0x375036[_0x160c14(0x46b,0x489,0x465,0x48e)](-0x54b+0xdbe+-0x6df)[_0x30dd36(0x2f6,0x325,0x320,0x2f3)]({'success':![],'message':_0x30dd36(0x377,0x351,0x35f,0x359)});}const _0x5e97a9=await fs['readFile'](_0x53ed27,_0x30dd36(0x323,0x30b,0x34a,0x2db)),_0x5d7865=await fs[_0x160c14(0x4a3,0x4a7,0x4a3,0x463)](_0x53ed27),_0x35629f=_0x5d7865[_0x30dd36(0x293,0x2d7,0x2cb,0x2de)];_0x375036[_0x30dd36(0x2f5,0x325,0x2f7,0x31d)]({'success':!![],'data':{'filename':_0x24637d,'content':_0x5e97a9,'fileSize':_0x35629f}});}catch(_0x2d63a5){console[_0x160c14(0x491,0x47e,0x4bf,0x464)](_0x30dd36(0x312,0x30c,0x2e7,0x30a),_0x2d63a5),_0x375036[_0x160c14(0x44a,0x489,0x445,0x478)](0x305+-0x8d*0xb+0x8e*0x9)[_0x160c14(0x4bd,0x48f,0x48b,0x4c2)]({'success':![],'message':_0x160c14(0x46e,0x46b,0x4ac,0x47b)});}}),router['get']('/markdown',async(_0x12f34a,_0x4e9a53)=>{function _0xbe496a(_0x58f0c4,_0x32a49c,_0x14824c,_0x400e48){return _0x_0x3d9525(_0x58f0c4-0x166,_0x58f0c4,_0x14824c-0x1cc,_0x14824c-0x1f);}function _0x38eb7b(_0x3fe4ff,_0x6ab47e,_0xf23c31,_0x8d9260){return _0x_0x3d9525(_0x3fe4ff-0x1f2,_0x3fe4ff,_0xf23c31-0xb8,_0x6ab47e- -0x17a);}try{const _0x42a69a=getMarkdownDir(),_0x4bd0ad=require('../models/Setting');try{if(_0x38eb7b(-0x6a,-0x5d,-0x97,-0x7c)==='rpcxW')await fs[_0xbe496a(0x1c8,0x194,0x195,0x194)](_0x42a69a);else{if(_0x3b51e4){const _0x15b757=_0x26352a[_0x38eb7b(0x1b,-0x20,-0xb,-0x46)](_0x2adbe6,arguments);return _0x143565=null,_0x15b757;}}}catch(_0x20b410){return await fs[_0xbe496a(0x148,0x16f,0x149,0x159)](_0x42a69a,{'recursive':!![]}),_0x4e9a53[_0x38eb7b(-0x16,-0x19,-0x2d,-0x61)]({'success':!![],'data':[]});}const _0x451296=await fs[_0xbe496a(0x189,0x1b6,0x1a1,0x1c9)](_0x42a69a),mdFiles=_0x451296[_0xbe496a(0x122,0x111,0x130,0x13b)](_0x30e75a=>_0x30e75a[_0xbe496a(0x16c,0x1cd,0x1b0,0x1cd)](_0xbe496a(0x100,0x171,0x144,0x129)));let sortedFiles=mdFiles;try{const _0x27b799=await _0x4bd0ad[_0x38eb7b(0x28,0x19,0xa,0x20)]({'where':{'key':_0xbe496a(0x14f,0x17e,0x177,0x135)}});if(_0x27b799&&_0x27b799[_0x38eb7b(-0x40,-0x8,-0x23,-0xd)]){const _0x438af6=JSON[_0xbe496a(0x1ba,0x1ab,0x184,0x192)](_0x27b799['value']);sortedFiles=[..._0x438af6[_0xbe496a(0x11e,0x16f,0x130,0x161)](_0x2a08fb=>mdFiles[_0x38eb7b(-0x27,-0x56,-0x6f,-0x5d)](_0x2a08fb)),...mdFiles['filter'](_0x141206=>!_0x438af6[_0xbe496a(0x156,0x138,0x143,0x18b)](_0x141206))];}}catch(_0x11520a){console[_0x38eb7b(-0x40,-0x2a,-0x67,-0x5d)](_0x38eb7b(0x6,-0x1c,-0x5c,-0x39),_0x11520a);}_0x4e9a53[_0x38eb7b(0x17,-0x19,-0x33,-0x4c)]({'success':!![],'data':sortedFiles});}catch(_0x32fa03){console[_0x38eb7b(-0x42,-0x2a,-0x32,-0x4b)](_0x38eb7b(-0x84,-0x43,-0x48,-0x28),_0x32fa03),_0x4e9a53[_0x38eb7b(-0x4f,-0x1f,-0x3d,-0x54)](-0x22*-0x94+-0x2679+0xd*0x199)[_0x38eb7b(-0x5e,-0x19,0xd,-0x1)]({'success':![],'message':_0x38eb7b(-0x47,-0x48,-0x24,-0x3)});}}),module[_0x_0x3b6eda(0x493,0x4a1,0x463,0x482)]=router;