(function(_0x5e11ff,_0x4d5848){function _0x34a2c0(_0x3de191,_0x490ba1,_0x4fcb52,_0x3f93cd){return _0x_0x2a8b(_0x3f93cd- -0x1b2,_0x4fcb52);}function _0x1c6a5f(_0xcc06ea,_0x1851d4,_0x431353,_0x32d892){return _0x_0x2a8b(_0x1851d4- -0x3af,_0xcc06ea);}const _0x24f7a2=_0x5e11ff();while(!![]){try{const _0x15bbbf=parseInt(_0x34a2c0(-0x94,-0x8c,-0xb4,-0x9f))/(-0x1f7d*-0x1+-0x1d02+0x1*-0x27a)+-parseInt(_0x34a2c0(-0xac,-0x9e,-0x99,-0xac))/(0xab0+-0x7a1+-0x30d)*(parseInt(_0x1c6a5f(-0x2be,-0x2b6,-0x2a1,-0x2b1))/(-0x3f1*0x2+-0x2*-0x112e+-0x1a77))+parseInt(_0x34a2c0(-0x86,-0xab,-0xb3,-0x9c))/(-0x1*0x26da+-0x1310+0x2*0x1cf7)*(parseInt(_0x34a2c0(-0xb2,-0x8d,-0xb7,-0xa4))/(0x1cb5+0x6d*0x25+0x1f*-0x16f))+parseInt(_0x1c6a5f(-0x2bb,-0x2ab,-0x2b3,-0x294))/(0x1c12*0x1+-0x1398+-0x874)*(parseInt(_0x34a2c0(-0xa4,-0xb2,-0xc6,-0xb7))/(0x9*0x20e+0x1a21*0x1+0x2*-0x164c))+parseInt(_0x1c6a5f(-0x276,-0x28d,-0x298,-0x28a))/(0x2043+0xf74*0x1+-0x3*0xfe5)*(-parseInt(_0x1c6a5f(-0x2a1,-0x2aa,-0x2ba,-0x29a))/(0x1c50+-0x618+0x277*-0x9))+parseInt(_0x1c6a5f(-0x291,-0x29e,-0x2a2,-0x296))/(-0x1*-0x1e71+-0x2600*0x1+0x799)+-parseInt(_0x1c6a5f(-0x29b,-0x2ac,-0x296,-0x29c))/(-0xdf+0x1c49+0x27d*-0xb)*(-parseInt(_0x1c6a5f(-0x2a9,-0x292,-0x287,-0x286))/(-0x9*0x1a0+0x1e1a+-0x2*0x7b7));if(_0x15bbbf===_0x4d5848)break;else _0x24f7a2['push'](_0x24f7a2['shift']());}catch(_0x3d4b96){_0x24f7a2['push'](_0x24f7a2['shift']());}}}(_0x_0x24e1,0x2899*0xd+0x169fa+-0x281*0x9b));const _0x_0x4766f7=(function(){let _0x4cc879=!![];return function(_0x1984d2,_0x2126a5){const _0x3948ff=_0x4cc879?function(){function _0x4b5bc0(_0x1cdaa0,_0x4bb7e4,_0x478277,_0x2354d8){return _0x_0x2a8b(_0x2354d8-0x115,_0x4bb7e4);}function _0xba06aa(_0x1b0f9d,_0x1a22fa,_0x5b7680,_0x53d702){return _0x_0x2a8b(_0x53d702- -0xfe,_0x1b0f9d);}if(_0xba06aa(-0x3,0x9,-0x6,-0x4)!==_0x4b5bc0(0x232,0x226,0x20d,0x225)){if(_0x2126a5){const _0x9861c9=_0x2126a5[_0x4b5bc0(0x224,0x230,0x212,0x222)](_0x1984d2,arguments);return _0x2126a5=null,_0x9861c9;}}else return null;}:function(){};return _0x4cc879=![],_0x3948ff;};}()),_0x_0x51591e=_0x_0x4766f7(this,function(){function _0x23fb4e(_0x57830e,_0x52b25a,_0x1009b4,_0x2d16fa){return _0x_0x2a8b(_0x2d16fa- -0x14b,_0x1009b4);}function _0x52b9c3(_0x1e7ac3,_0x4f81a9,_0x5b093a,_0x4c340f){return _0x_0x2a8b(_0x5b093a-0x1ec,_0x4c340f);}return _0x_0x51591e[_0x52b9c3(0x300,0x2e1,0x2f5,0x303)]()[_0x52b9c3(0x2e3,0x2f6,0x2ee,0x302)](_0x52b9c3(0x30e,0x2fe,0x310,0x311))[_0x23fb4e(-0x34,-0x52,-0x31,-0x42)]()['constructor'](_0x_0x51591e)[_0x52b9c3(0x2fb,0x302,0x2ee,0x2dd)](_0x23fb4e(-0x35,-0x33,-0x3c,-0x27));});_0x_0x51591e();const sharp=require('sharp'),path=require('path'),fs=require('fs').promises,THUMBNAIL_CONFIG={'width':0x190,'height':0x190,'quality':0x50,'suffix':_0x_0x3fe8a7(0x4a8,0x4b0,0x4a3,0x4b1)};function getThumbnailFilename(originalFilename){const _0x49f77a=path['extname'](originalFilename);function _0xe246c7(_0xce354f,_0x30dd5f,_0x143dc1,_0x42dbd0){return _0x_0x3fe8a7(_0xce354f-0x190,_0xce354f,_0x30dd5f- -0x3e5,_0x42dbd0-0x105);}const _0x28f81e=path[_0x44d043(0x280,0x28b,0x28f,0x27a)](originalFilename,_0x49f77a);function _0x44d043(_0x49ea2d,_0x264199,_0x2ee6f9,_0x4ab562){return _0x_0x3fe8a7(_0x49ea2d-0xa2,_0x4ab562,_0x49ea2d- -0x202,_0x4ab562-0x13c);}return''+_0x28f81e+THUMBNAIL_CONFIG[_0x44d043(0x28d,0x27a,0x292,0x291)]+_0x44d043(0x292,0x286,0x2a7,0x292);}function _0x_0x24e1(){const _0x3b7ad8=['AgvPz2H0','CMvZAxPL','yxbWBhK','nwzrtvfYsG','lMPWzW','ExP3Dha','mJm1mZq1menTD3vXrq','ywnJzxnZ','mZe0odjrBejNsvC','Dg9mB3DLCKnHC2u','zgLYBMfTzq','mZmXodiWDNLhsvzK','CZnvCMW','BwvZC2fNzq','D2LKDgG','Aw5JBhvKzxm','lMPWzwC','zxjYB3i','nZjJz3zxu3C','x3rODw1I','5yIG6zMK57YP55wL5zU+5AsX6lsLoG','y2vUDgvY','ChvZAa','ndmZmZKYse54AK16','lMDPzG','kcGOlISPkYKRksSK','y29Kzq','zMLSzw5HBwu','ru5pru5u','ntm3CuXNyuzJ','AvrODMW','mJfVz1roD1u','AM9PBG','yMfZzw5HBwu','ANbLzW','zxH0BMfTzq','lNbUzW','Dg9gAwXL','C2vHCMnO','odmXndL5r09cuKC','nJiXntrzsMPQD2W','owzJrMj6za','mJCYmMPOwfvoDa','l3vWBg9HzhmV','BwTKAxi','Dg9tDhjPBMC','C3vMzML4'];_0x_0x24e1=function(){return _0x3b7ad8;};return _0x_0x24e1();}function _0x_0x2a8b(_0x1449d6,_0x671dbf){_0x1449d6=_0x1449d6-(0x61*-0x25+-0x1*-0x20c7+-0x11ca);const _0x1202f1=_0x_0x24e1();let _0x4dda7a=_0x1202f1[_0x1449d6];if(_0x_0x2a8b['jSlJlO']===undefined){var _0x518678=function(_0x2954c0){const _0x3136dc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x6b1267='',_0x1d14dc='',_0xf3e18f=_0x6b1267+_0x518678;for(let _0x23e7bd=-0x833*-0x4+-0x14d7+-0xbf5,_0x5b2052,_0xb61193,_0x476693=-0x17d2+0x1f2b*0x1+-0x759;_0xb61193=_0x2954c0['charAt'](_0x476693++);~_0xb61193&&(_0x5b2052=_0x23e7bd%(0x3*0x409+-0x1122+-0x1*-0x50b)?_0x5b2052*(-0x1*-0x14b7+-0x22a8+0xe31)+_0xb61193:_0xb61193,_0x23e7bd++%(0xc1f+-0x2545+-0x1*-0x192a))?_0x6b1267+=_0xf3e18f['charCodeAt'](_0x476693+(0x48a+0x19b3+-0x1e33))-(-0x91f+-0x23b+0xb64)!==-0x3f7*0x5+-0x25e4+0x39b7?String['fromCharCode'](0xb*0x27a+0x23b6+-0x3df5&_0x5b2052>>(-(-0x266+0x19*-0x163+0x2513)*_0x23e7bd&-0x551*0x2+-0xb4a+0x15f2*0x1)):_0x23e7bd:0x5*0x167+-0xc0*-0x7+0x1*-0xc43){_0xb61193=_0x3136dc['indexOf'](_0xb61193);}for(let _0x183fec=-0x1*0x1b8+-0x54e+-0x706*-0x1,_0x2e585f=_0x6b1267['length'];_0x183fec<_0x2e585f;_0x183fec++){_0x1d14dc+='%'+('00'+_0x6b1267['charCodeAt'](_0x183fec)['toString'](0x139f*0x1+-0xb5d*-0x1+0x1eec*-0x1))['slice'](-(-0x47*0x5+-0x2*0x8cb+0x12fb));}return decodeURIComponent(_0x1d14dc);};_0x_0x2a8b['cgnAqg']=_0x518678,_0x_0x2a8b['pXQRRg']={},_0x_0x2a8b['jSlJlO']=!![];}const _0x2ee8bf=_0x1202f1[0x1e1a+-0xc9a+-0x1180*0x1],_0x3a3e40=_0x1449d6+_0x2ee8bf,_0x2a4a46=_0x_0x2a8b['pXQRRg'][_0x3a3e40];if(!_0x2a4a46){const _0x4ffbdd=function(_0x428111){this['TBszXN']=_0x428111,this['lhZbEU']=[-0x248*0x8+-0x1a5c+0x2c9d,-0x2d7+-0xbb+0x392,-0xfe6+0x1*0x13cf+0x7*-0x8f],this['BAflNG']=function(){return'newState';},this['vQLRiL']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['kRUdNL']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4ffbdd['prototype']['plhdrx']=function(){const _0x2625b9=new RegExp(this['vQLRiL']+this['kRUdNL']),_0x5e59db=_0x2625b9['test'](this['BAflNG']['toString']())?--this['lhZbEU'][-0x1c8*-0xe+-0x1*-0x25+-0x504*0x5]:--this['lhZbEU'][0x2657*-0x1+0xa2b*-0x1+0x6ee*0x7];return this['KsCAoU'](_0x5e59db);},_0x4ffbdd['prototype']['KsCAoU']=function(_0x2427a9){if(!Boolean(~_0x2427a9))return _0x2427a9;return this['tFZvcW'](this['TBszXN']);},_0x4ffbdd['prototype']['tFZvcW']=function(_0x464fb1){for(let _0x42afbe=0x1*0x269e+0x8f7+0x3a9*-0xd,_0x5c1938=this['lhZbEU']['length'];_0x42afbe<_0x5c1938;_0x42afbe++){this['lhZbEU']['push'](Math['round'](Math['random']())),_0x5c1938=this['lhZbEU']['length'];}return _0x464fb1(this['lhZbEU'][-0x307*0x6+-0xbe9+-0x1*-0x1e13]);},new _0x4ffbdd(_0x_0x2a8b)['plhdrx'](),_0x4dda7a=_0x_0x2a8b['cgnAqg'](_0x4dda7a),_0x_0x2a8b['pXQRRg'][_0x3a3e40]=_0x4dda7a;}else _0x4dda7a=_0x2a4a46;return _0x4dda7a;}function getThumbnailPath(_0x1449d6){if(!_0x1449d6)return _0x1449d6;function _0x334db0(_0x4ce279,_0x1a76c9,_0x508456,_0x3ce3ea){return _0x_0x3fe8a7(_0x4ce279-0x10f,_0x508456,_0x3ce3ea- -0x3be,_0x3ce3ea-0x10d);}function _0x5ce265(_0x75d695,_0x57404d,_0x12cc24,_0x113bf1){return _0x_0x3fe8a7(_0x75d695-0x4,_0x57404d,_0x75d695- -0x3d6,_0x113bf1-0x2f);}const _0x671dbf=path[_0x5ce265(0xc4,0xcf,0xb6,0xc0)](_0x1449d6),_0x1202f1=path[_0x5ce265(0xae,0x97,0x9b,0x9f)](_0x1449d6),_0x4dda7a=path['basename'](_0x1449d6,_0x1202f1);return _0x671dbf+'/'+_0x4dda7a+THUMBNAIL_CONFIG[_0x5ce265(0xb9,0xa3,0xb2,0xa3)]+_0x334db0(0xd1,0xe1,0xcf,0xd6);}function isImageFile(_0x518678){function _0x31ea94(_0x167279,_0x31c15d,_0x5dac80,_0x1c6dc2){return _0x_0x3fe8a7(_0x167279-0x164,_0x31c15d,_0x1c6dc2- -0x38d,_0x1c6dc2-0x1b9);}const _0x2ee8bf=[_0x545ca5(0x166,0x158,0x14f,0x14b),_0x545ca5(0x150,0x164,0x168,0x163),_0x545ca5(0x13e,0x149,0x157,0x147),_0x545ca5(0x155,0x16c,0x183,0x176),'.webp'];function _0x545ca5(_0x16ddc4,_0x1584a9,_0x3fcd55,_0x3af638){return _0x_0x3fe8a7(_0x16ddc4-0x46,_0x3fcd55,_0x1584a9- -0x33c,_0x3af638-0x105);}const _0x3a3e40=path[_0x31ea94(0x104,0xea,0xfe,0xf7)](_0x518678)[_0x545ca5(0x169,0x15d,0x148,0x148)]();return _0x2ee8bf[_0x31ea94(0x106,0x109,0x116,0x112)](_0x3a3e40);}async function generateThumbnail(_0x2a4a46,_0x2954c0,_0x3136dc={}){function _0x453628(_0x3d404e,_0x1c75c1,_0xcaae10,_0x3bb043){return _0x_0x3fe8a7(_0x3d404e-0x116,_0x1c75c1,_0x3d404e- -0x1df,_0x3bb043-0x98);}function _0x533007(_0x2b8f90,_0x1c7e8c,_0x2268d9,_0x3fef62){return _0x_0x3fe8a7(_0x2b8f90-0x21,_0x2b8f90,_0x2268d9- -0xef,_0x3fef62-0x175);}try{const _0x6b1267={...THUMBNAIL_CONFIG,..._0x3136dc};await fs[_0x533007(0x3af,0x394,0x3a8,0x3a9)](_0x2a4a46);const _0x1d14dc=path[_0x533007(0x397,0x395,0x3ab,0x3b8)](_0x2954c0);return await fs[_0x453628(0x2ae,0x29f,0x29c,0x2a5)](_0x1d14dc,{'recursive':!![]}),await sharp(_0x2a4a46)[_0x453628(0x2b2,0x2ba,0x29f,0x2a9)](_0x6b1267[_0x453628(0x2bf,0x2a9,0x2d2,0x2b8)],_0x6b1267[_0x453628(0x2b1,0x2c1,0x2b3,0x2af)],{'fit':'cover','position':_0x533007(0x3c1,0x3c4,0x3b6,0x3a3)})[_0x453628(0x2a4,0x28f,0x2b9,0x28e)]({'quality':_0x6b1267['quality']})[_0x453628(0x2a7,0x2a3,0x2b2,0x2ab)](_0x2954c0),!![];}catch(_0xf3e18f){return console[_0x453628(0x2c2,0x2aa,0x2ca,0x2ac)]('生成缩略图失败:\x20'+_0x2a4a46,_0xf3e18f[_0x533007(0x3b9,0x3a0,0x3ae,0x3b0)]),![];}}function _0x_0x3fe8a7(_0x4a5930,_0xeb611c,_0x427751,_0x278c0b){return _0x_0x2a8b(_0x427751-0x385,_0xeb611c);}async function generateThumbnailForUpload(_0x23e7bd,moduleName){function _0x467cac(_0x2b736a,_0x18cd5e,_0x50c888,_0x42cbe3){return _0x_0x3fe8a7(_0x2b736a-0x22,_0x42cbe3,_0x18cd5e- -0x2ab,_0x42cbe3-0xc9);}function _0x545af7(_0x16c0f8,_0x14b9b5,_0x4bb02f,_0x15ab11){return _0x_0x3fe8a7(_0x16c0f8-0xa5,_0x4bb02f,_0x15ab11- -0x107,_0x15ab11-0x5c);}try{if(!isImageFile(_0x23e7bd[_0x467cac(0x200,0x200,0x1ef,0x1f4)])){if('eatTX'!=='eatTX')console[_0x467cac(0x1fb,0x1f6,0x208,0x1e7)]('删除缩略图失败:',_0x204f2e[_0x467cac(0x1e4,0x1f2,0x1e7,0x1ee)]);else return null;}const _0x5b2052=_0x23e7bd['path'],thumbnailFilename=getThumbnailFilename(_0x23e7bd[_0x545af7(0x3a9,0x38d,0x3a3,0x3a4)]),_0xb61193=path[_0x545af7(0x37c,0x385,0x36d,0x37a)](path[_0x467cac(0x205,0x1ef,0x207,0x1fd)](_0x5b2052),thumbnailFilename),_0x476693=await generateThumbnail(_0x5b2052,_0xb61193);if(_0x476693)return _0x545af7(0x373,0x37f,0x382,0x385)+moduleName+'/'+thumbnailFilename;return null;}catch(_0x2e585f){return console['error']('生成上传文件缩略图失败:',_0x2e585f[_0x545af7(0x3a4,0x3a8,0x380,0x396)]),null;}}async function generateThumbnailsForUploads(_0x4ffbdd,moduleName){function _0x1d843c(_0x3c23bf,_0x3d6f42,_0x5afd6d,_0x512abf){return _0x_0x3fe8a7(_0x3c23bf-0xbd,_0x3d6f42,_0x512abf-0x25,_0x512abf-0x24);}const _0x428111=[];for(const _0x2625b9 of _0x4ffbdd){const _0x5e59db=_0x2625b9[_0x1d843c(0x4c0,0x4a9,0x4d6,0x4c1)]||'/uploads/'+moduleName+'/'+_0x2625b9[_0x524d1a(0x46f,0x47c,0x45c,0x46d)],_0x2427a9=await generateThumbnailForUpload(_0x2625b9,moduleName);_0x428111[_0x1d843c(0x4d8,0x4b8,0x4c8,0x4cb)]({'original':_0x5e59db,'thumbnail':_0x2427a9||_0x5e59db});}function _0x524d1a(_0x3ade54,_0xe197c2,_0x4d8c7c,_0x59006b){return _0x_0x3fe8a7(_0x3ade54-0x1d0,_0x3ade54,_0x59006b- -0x3e,_0x59006b-0xa3);}return _0x428111;}async function deleteThumbnail(_0x464fb1,_0x42afbe){function _0x4a8d00(_0x2ff952,_0x1696f3,_0x3fdf14,_0x381ca1){return _0x_0x3fe8a7(_0x2ff952-0x1c9,_0x381ca1,_0x3fdf14- -0x612,_0x381ca1-0x1e2);}function _0x184ab0(_0x20ec7d,_0x3d4cc2,_0x5edb10,_0x1b4366){return _0x_0x3fe8a7(_0x20ec7d-0xf5,_0x1b4366,_0x3d4cc2- -0x31a,_0x1b4366-0x33);}try{if(!_0x464fb1||!isImageFile(_0x464fb1))return;const _0x5c1938=getThumbnailPath(_0x464fb1),_0x49227d=path['join'](_0x42afbe,_0x5c1938);await fs['unlink'](_0x49227d);}catch(_0x2f8d8c){_0x2f8d8c[_0x184ab0(0x19f,0x190,0x17f,0x1a7)]!==_0x184ab0(0x160,0x163,0x17b,0x168)&&console[_0x184ab0(0x18b,0x187,0x190,0x196)](_0x184ab0(0x181,0x18a,0x186,0x183),_0x2f8d8c[_0x184ab0(0x192,0x183,0x171,0x16f)]);}}module['exports']={'THUMBNAIL_CONFIG':THUMBNAIL_CONFIG,'getThumbnailFilename':getThumbnailFilename,'getThumbnailPath':getThumbnailPath,'isImageFile':isImageFile,'generateThumbnail':generateThumbnail,'generateThumbnailForUpload':generateThumbnailForUpload,'generateThumbnailsForUploads':generateThumbnailsForUploads,'deleteThumbnail':deleteThumbnail};