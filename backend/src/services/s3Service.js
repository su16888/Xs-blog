(function(_0x57bf21,_0x1b282b){const _0x5837b1=_0x57bf21();function _0x4ef92a(_0x30cd28,_0x4e336c,_0x15c9d6,_0x4faa69){return _0x_0x2054(_0x4faa69-0x2ae,_0x15c9d6);}function _0x24ef3d(_0xd6f3d8,_0xde2147,_0x5e9f31,_0x3604c3){return _0x_0x2054(_0x3604c3-0x258,_0xd6f3d8);}while(!![]){try{const _0x5b9386=-parseInt(_0x24ef3d(0x462,0x446,0x442,0x439))/(0x1*0x1541+0x161*0xd+0x1*-0x272d)*(parseInt(_0x4ef92a(0x458,0x4a3,0x482,0x47c))/(-0x657*0x5+0x85*0x4+0x5ed*0x5))+-parseInt(_0x4ef92a(0x497,0x487,0x4ba,0x4a4))/(-0x17f2+-0x1*0x1b3b+0x3330)*(parseInt(_0x24ef3d(0x431,0x421,0x437,0x43e))/(-0x43d+-0x1ae3+0x1f24))+-parseInt(_0x24ef3d(0x44e,0x469,0x44d,0x450))/(0x2de*0x9+-0x10e*-0x2+-0x1be5)*(-parseInt(_0x24ef3d(0x479,0x433,0x474,0x45d))/(0x17*0x173+0x1*0x6ed+0x4*-0xa0f))+-parseInt(_0x24ef3d(0x435,0x41c,0x430,0x42c))/(0x12e5+-0x96*-0x3f+-0x37c8)+parseInt(_0x4ef92a(0x48d,0x470,0x462,0x48b))/(0xd09*-0x2+-0x2613+0x402d)+-parseInt(_0x24ef3d(0x40e,0x420,0x424,0x429))/(-0xde9+-0x1*-0x68e+0x764)+parseInt(_0x24ef3d(0x485,0x478,0x488,0x462))/(0x1944+0x1cb*0x1+-0x1*0x1b05)*(parseInt(_0x4ef92a(0x4d3,0x4bc,0x4d7,0x4bb))/(0x21f+0x1bda+-0x1dee));if(_0x5b9386===_0x1b282b)break;else _0x5837b1['push'](_0x5837b1['shift']());}catch(_0x5686c4){_0x5837b1['push'](_0x5837b1['shift']());}}}(_0x_0x3e85,0x3323c+-0xc8e76+0x1*0x103721));const _0x_0x206d24=(function(){let _0x1266cb=!![];return function(_0x4e1cc6,_0x588135){function _0x366457(_0x438097,_0x4b4bf2,_0x26b4ce,_0x569fcb){return _0x_0x2054(_0x4b4bf2- -0x326,_0x438097);}function _0x2ce36b(_0x3926f8,_0x3cc62f,_0x6c3716,_0xa18124){return _0x_0x2054(_0x6c3716-0x131,_0x3926f8);}if(_0x2ce36b(0x30c,0x308,0x2f9,0x315)!==_0x366457(-0x153,-0x15e,-0x137,-0x148))_0x230206[_0x40b03c[_0x2ce36b(0x314,0x32c,0x325,0x307)]]=_0x2890b3[_0x2ce36b(0x33e,0x302,0x32a,0x325)];else{const _0x1ecd48=_0x1266cb?function(){function _0xfad111(_0x4b2680,_0xf5315a,_0x427bd2,_0x3fad67){return _0x2ce36b(_0x4b2680,_0xf5315a-0x11a,_0x427bd2- -0x1f1,_0x3fad67-0xb3);}function _0x49e3e0(_0x3fabb9,_0x53a669,_0xf6c272,_0x592f41){return _0x2ce36b(_0x592f41,_0x53a669-0xb5,_0x53a669- -0x293,_0x592f41-0xd0);}if(_0x49e3e0(0x39,0x5e,0x4c,0x6f)==='NVfDI'){if(_0x588135){const _0xaa4942=_0x588135[_0x49e3e0(0x85,0x5f,0x80,0x68)](_0x4e1cc6,arguments);return _0x588135=null,_0xaa4942;}}else{if(_0x5f4933[_0x49e3e0(0xb3,0x9d,0xbb,0xa6)]&&_0x2e6b1d[_0x49e3e0(0x78,0x83,0xa5,0x5e)](_0x49f194[_0xfad111(0x145,0x15c,0x13f,0x12b)]))_0x7c4982=_0x3ea7b0[_0x49e3e0(0xc6,0xa6,0xc8,0xbf)](_0xca80d5[_0xfad111(0x126,0x12a,0x13f,0x122)][_0x49e3e0(0x8c,0xa6,0xc3,0x8f)](/\/$/,'')+'/','');else{const _0x3de567=new URL(_0x267ca3);_0x1b0271=_0x3de567[_0x49e3e0(0x96,0x7a,0x52,0x90)][_0x49e3e0(0x96,0xa6,0xbd,0x82)](/^\//,''),_0x49679d[_0x49e3e0(0xb2,0xaa,0x8e,0xb6)]&&_0x3213a1[_0x49e3e0(0xaa,0x83,0x64,0x67)](_0x1671d3['bucket']+'/')&&(_0x3f51db=_0x2c31d9['replace'](_0x3ce623[_0x49e3e0(0x68,0x5d,0x64,0x82)]+'/',''));}}}:function(){};return _0x1266cb=![],_0x1ecd48;}};}()),_0x_0x437d4b=_0x_0x206d24(this,function(){function _0x38d0be(_0x49aabd,_0x5d1f92,_0xbcfd4d,_0x1becc6){return _0x_0x2054(_0x1becc6- -0x163,_0x5d1f92);}function _0x5188a1(_0x5132b0,_0x70ae4a,_0x503d9d,_0x3c2e83){return _0x_0x2054(_0x503d9d-0x338,_0x3c2e83);}return _0x_0x437d4b[_0x5188a1(0x51c,0x516,0x505,0x51a)]()[_0x38d0be(0x8e,0xbe,0x8d,0xa3)](_0x38d0be(0x9e,0xa3,0xc4,0x9b))[_0x38d0be(0x7b,0x6c,0x46,0x6a)]()['constructor'](_0x_0x437d4b)[_0x5188a1(0x555,0x554,0x53e,0x54a)]('(((.+)+)+)+$');});_0x_0x437d4b();function _0x_0x3e85(){const _0x36ccdd=['t0TAuwW','qwnJzxnZieTLEsbjrcdML6dMLyG','DxmTzwfZDc0X','q29Kzq','BMfTzq','Dg9tDhjPBMC','mJznCxDPuNG','ChjVDg9JB2W','zxHWB3j0CW','nJe0nte0nLz5EeHgEa','w1mZu2vYDMLJzv0Gz2v0uZndB25MAwCGCMvZDwX0oG','DhjPBq','ndm4mJeXmM9kCLjhEa','C2vUza','uZpOV57MJQxMTyVOR5xLPlhOTku6','5A2y5ykO5Qg25lIn5A2y5zYO','CZnby2nLC3nlzxLjza','zxjYB3i','zMLUzefSBa','DxbSB2fKCY8','Cgf0Ag5HBwu','nJq3mdi0mgPwtLPewq','ALzJDhq','Bg9JywW','C2vJCMv0qwnJzxnZs2v5','mtu1ndnxA3LvExm','zw5KCg9PBNq','A0jPyxq','CZnfBMrWB2LUDa','C3rHCNrZv2L0Aa','mZiWodi4uwPhruru','CMvNAw9U','y29UC3rYDwn0B3i','lI4U','u3L3tNu','C3vIC3rYAw5N','runptK5sruzvu0ve','zw1WDhK','uZpOV57MJQxMTyVOR5xMIjdLIP8','u2LNBMf0DxjLrg9LC05VDe1HDgnO','Dhj1zq','EgX0s0W','CZnszwDPB24','CZntzwnYzxrby2nLC3nlzxK','A2v5','CMvHzezPBgvtEw5J','oufPA3znBG','CZndDxn0B21eB21HAw4','nwjVsLHIEa','DMfSDwu','u2vJCMv0iefJy2vZCYblzxKG5PEG5Pwi','y1jRwxC','BgvUz3rO','CZnqyxrOu3r5Bgu','kcGOlISPkYKRksSK','y3vZDg9Trg9TywLU','tfHer0S','y29Kzq','rfnNEg8','zM9YrwfJAa','Ahr0Chm6lY8','mta3mJC3mg9uy050rW','C2vHCMnO','AxnfBMnYExb0zwq','CMvWBgfJzq','sw52ywXPzefJy2vZC0TLEuLK','mteXmZbMwKzYzuW','zgvJCNLWDezPzwXK','Cgf0Afn0EwXL','mte5otb2Bhvrt3i','tM90rM91BMq','ywnJzxnZs2v5swq','ru5pvezpvu5e','BwvZC2fNzq','yNvJA2v0','tLzMreK','yxbWBhK','C3rVCMfNzvr5Cgu','Ag9ZDa','ChvIBgLJlxjLywq','CZncDwnRzxq','5PEG5Rov6l+E5O6L5yIWuZpNQ6/NGRNVViZOR7FMO4dMN6xNQ6/NGRNLNldLNya','uZpLRQlMIlFNQ6/MNkRPHy3NVA7MIjBLRzJLGQJNSBVLNOVKUi3MMk9tmW'];_0x_0x3e85=function(){return _0x36ccdd;};return _0x_0x3e85();}const {S3Client,PutObjectCommand,DeleteObjectCommand,HeadBucketCommand}=require('@aws-sdk/client-s3'),fs=require('fs'),path=require('path'),Setting=require('../models/Setting'),databaseEncryption=require('../utils/databaseEncryption');let s3Client=null,s3Config=null;function _0x_0x6ef8a8(_0x538446,_0x42aec4,_0x4207a5,_0x2603e3){return _0x_0x2054(_0x2603e3- -0xe,_0x4207a5);}async function getS3Config(){function _0x5b836a(_0x32b089,_0x5d538e,_0x4b52e8,_0x3126c7){return _0x_0x2054(_0x4b52e8- -0x2a9,_0x5d538e);}function _0x57f58b(_0x5a2fe2,_0x561254,_0xc114e3,_0x5994dc){return _0x_0x2054(_0x5994dc- -0x2a4,_0x561254);}try{const _0x8c5db1=await Setting[_0x5b836a(-0xc9,-0xc4,-0xcf,-0xdb)]({'where':{'key':['storageType',_0x57f58b(-0x99,-0xa9,-0xdc,-0xc0),_0x5b836a(-0xc8,-0xca,-0xb7,-0xb0),_0x57f58b(-0xc8,-0x109,-0xe6,-0xdf),_0x57f58b(-0xa8,-0xa3,-0xe3,-0xcc),_0x5b836a(-0xd1,-0xd7,-0xb6,-0x94),_0x5b836a(-0xab,-0xab,-0xb2,-0xce),_0x57f58b(-0xc9,-0xc1,-0xcd,-0xa7)]}}),_0x52b9b7={};_0x8c5db1[_0x57f58b(-0xba,-0x82,-0xba,-0xa1)](_0x2bcc1f=>{function _0x2bb349(_0x5f3c58,_0x310e15,_0x2ec401,_0x125ff6){return _0x5b836a(_0x5f3c58-0x156,_0x125ff6,_0x310e15-0x58c,_0x125ff6-0x1e0);}function _0x3ba958(_0x33ffee,_0x50fb39,_0x3ed2ac,_0x2acca0){return _0x57f58b(_0x33ffee-0xe6,_0x50fb39,_0x3ed2ac-0x139,_0x2acca0-0x27e);}if(_0x3ba958(0x1c9,0x1ff,0x1fd,0x1dc)!==_0x3ba958(0x1c4,0x1e1,0x1ec,0x1dc))return _0x201ac0[_0x2bb349(0x496,0x4b0,0x4b3,0x4c0)]()['search']('(((.+)+)+)+$')[_0x3ba958(0x1bc,0x1ad,0x1ca,0x1a7)]()[_0x2bb349(0x4d9,0x4cb,0x4bc,0x4ba)](_0x48e9b3)['search']('(((.+)+)+)+$');else _0x52b9b7[_0x2bcc1f[_0x3ba958(0x1dc,0x1bf,0x1ed,0x1ce)]]=_0x2bcc1f[_0x3ba958(0x1e8,0x1d2,0x1d6,0x1d3)];});let _0x1bb9e5=_0x52b9b7[_0x57f58b(-0xe4,-0xab,-0xc9,-0xcc)]||'',_0x4035f0=_0x52b9b7[_0x57f58b(-0x9e,-0xb2,-0xa2,-0xb1)]||'';return databaseEncryption[_0x57f58b(-0xa9,-0xbe,-0x74,-0x9d)](_0x1bb9e5)&&('LXDGK'===_0x57f58b(-0x8f,-0x87,-0xcc,-0xa4)?_0x1bb9e5=databaseEncryption[_0x57f58b(-0xae,-0x97,-0x9b,-0x99)](_0x1bb9e5):_0x494f60=_0x4ffb53[_0x57f58b(-0xec,-0xb8,-0xea,-0xc2)]+'/'+_0x1342a5[_0x57f58b(-0xe1,-0xc7,-0xff,-0xe5)]+'/'+_0x2c7a45),databaseEncryption[_0x5b836a(-0xa5,-0xa5,-0xa2,-0xa4)](_0x4035f0)&&(_0x4035f0=databaseEncryption[_0x57f58b(-0x90,-0xa5,-0x96,-0x99)](_0x4035f0)),_0x1bb9e5=_0x1bb9e5['trim'](),_0x4035f0=_0x4035f0[_0x5b836a(-0xdc,-0xb4,-0xd6,-0xd2)](),{'storageType':_0x52b9b7['storageType']||'local','endpoint':_0x52b9b7['s3Endpoint']||'','region':_0x52b9b7[_0x57f58b(-0xdc,-0xd4,-0xd9,-0xb2)]||_0x57f58b(-0xe7,-0xc6,-0xb4,-0xda),'bucket':_0x52b9b7[_0x5b836a(-0xd8,-0xfd,-0xe4,-0xea)]||'','accessKeyId':_0x1bb9e5,'secretAccessKey':_0x4035f0,'customDomain':_0x52b9b7[_0x57f58b(-0xd2,-0x97,-0xa9,-0xad)]||'','pathStyle':_0x52b9b7['s3PathStyle']==='true'};}catch(_0x2bcc88){return console[_0x5b836a(-0xc5,-0xed,-0xd0,-0xb3)]('获取S3配置失败:',_0x2bcc88),{'storageType':_0x57f58b(-0xe9,-0xeb,-0xe2,-0xc5)};}}function _0x_0x2054(_0x550cb1,_0x18e5fa){_0x550cb1=_0x550cb1-(0x2*0x25f+0x121a+-0xb*0x1eb);const _0x33c569=_0x_0x3e85();let _0x42168a=_0x33c569[_0x550cb1];if(_0x_0x2054['RUHCLO']===undefined){var _0x262a12=function(_0x50fc22){const _0x3856e3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xeb12eb='',_0x2640eb='',_0x52dad9=_0xeb12eb+_0x262a12;for(let _0x5f4933=0xa31*-0x1+0x12a8+-0x877,_0x2e6b1d,_0x49f194,_0x60e7b=-0x24d7*0x1+0xb*-0x12e+0x109b*0x3;_0x49f194=_0x50fc22['charAt'](_0x60e7b++);~_0x49f194&&(_0x2e6b1d=_0x5f4933%(0x799+0x1*0x1273+-0x1a08)?_0x2e6b1d*(0x1*-0x2700+-0x557+0x2c97)+_0x49f194:_0x49f194,_0x5f4933++%(0x1290+0x1892+-0x2*0x158f))?_0xeb12eb+=_0x52dad9['charCodeAt'](_0x60e7b+(0x1063+0x25e4+-0x363d))-(0x67*-0x3+-0x1a5a+0x1b99)!==-0x10b2+-0x1*-0x107+0xfab?String['fromCharCode'](0x14ab+-0x17da+0x42e&_0x2e6b1d>>(-(-0xdee*-0x1+-0x5d6+-0x816)*_0x5f4933&-0x3*0x1ab+-0x75*-0x29+-0xdb6)):_0x5f4933:0x698+0x18a*0x4+-0x10*0xcc){_0x49f194=_0x3856e3['indexOf'](_0x49f194);}for(let _0x4e1ac3=0x176*0xa+-0x1a3*-0x9+-0x25*0xcb,_0x5c96ab=_0xeb12eb['length'];_0x4e1ac3<_0x5c96ab;_0x4e1ac3++){_0x2640eb+='%'+('00'+_0xeb12eb['charCodeAt'](_0x4e1ac3)['toString'](-0x1de6+0x1*-0x1717+0x350d))['slice'](-(0x1ceb+0x16ab+-0x3394));}return decodeURIComponent(_0x2640eb);};_0x_0x2054['gTZPaH']=_0x262a12,_0x_0x2054['ZDYBhO']={},_0x_0x2054['RUHCLO']=!![];}const _0x483c76=_0x33c569[-0x1*0x158d+-0xd21+0x22ae],_0x326117=_0x550cb1+_0x483c76,_0x2d3efb=_0x_0x2054['ZDYBhO'][_0x326117];if(!_0x2d3efb){const _0x224aec=function(_0x533ecf){this['dNOvqM']=_0x533ecf,this['LrBXhW']=[0x12a4+0x3d3*0x1+0xe6*-0x19,0x133e+0x4*-0x659+-0x1*-0x626,0x179e*-0x1+0x12b4+-0x2*-0x275],this['jhClAD']=function(){return'newState';},this['VjKYzl']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['rrGipA']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x224aec['prototype']['lGAPHQ']=function(){const _0x342c32=new RegExp(this['VjKYzl']+this['rrGipA']),_0x96d222=_0x342c32['test'](this['jhClAD']['toString']())?--this['LrBXhW'][-0x4c9+0x2101+-0x1c37]:--this['LrBXhW'][-0x261*0x3+-0x20e4+0x2807];return this['rBXDXp'](_0x96d222);},_0x224aec['prototype']['rBXDXp']=function(_0x3bce0d){if(!Boolean(~_0x3bce0d))return _0x3bce0d;return this['iAXnKM'](this['dNOvqM']);},_0x224aec['prototype']['iAXnKM']=function(_0x1512a0){for(let _0x155789=-0x978+0x1*-0x1486+0x1dfe,_0x4a6ec4=this['LrBXhW']['length'];_0x155789<_0x4a6ec4;_0x155789++){this['LrBXhW']['push'](Math['round'](Math['random']())),_0x4a6ec4=this['LrBXhW']['length'];}return _0x1512a0(this['LrBXhW'][0x2*-0x2b8+0x97a+-0x40a]);},new _0x224aec(_0x_0x2054)['lGAPHQ'](),_0x42168a=_0x_0x2054['gTZPaH'](_0x42168a),_0x_0x2054['ZDYBhO'][_0x326117]=_0x42168a;}else _0x42168a=_0x2d3efb;return _0x42168a;}async function getS3Client(_0xe1446d=![]){if(s3Client&&!_0xe1446d)return{'client':s3Client,'config':s3Config};function _0xe1abe8(_0x11df9e,_0x4fb2f5,_0x472d8c,_0x24db2f){return _0x_0x2054(_0x472d8c- -0x3a6,_0x11df9e);}s3Config=await getS3Config();if(s3Config[_0x10544b(0x200,0x1ef,0x20f,0x1f3)]!=='s3'||!s3Config[_0x10544b(0x235,0x220,0x236,0x213)]||!s3Config[_0xe1abe8(-0x1aa,-0x1aa,-0x197,-0x1b1)]||!s3Config[_0x10544b(0x21f,0x232,0x1f8,0x211)])return'GkVxJ'!==_0xe1abe8(-0x1c6,-0x1be,-0x1c3,-0x1da)?{'client':null,'config':s3Config}:{'client':null,'config':_0x41aa3f};function _0x10544b(_0x3e2044,_0x4b32e0,_0x509c21,_0x5f75c5){return _0x_0x2054(_0x5f75c5-0x31,_0x3e2044);}return s3Client=new S3Client({'endpoint':s3Config[_0xe1abe8(-0x1a4,-0x1d0,-0x1c4,-0x1c3)],'region':s3Config[_0x10544b(0x1f1,0x209,0x232,0x218)]||_0xe1abe8(-0x1d2,-0x1ce,-0x1dc,-0x1f2),'credentials':{'accessKeyId':s3Config[_0xe1abe8(-0x1a7,-0x178,-0x197,-0x1a2)],'secretAccessKey':s3Config[_0xe1abe8(-0x1a2,-0x1d9,-0x1c6,-0x1bd)]},'forcePathStyle':s3Config[_0x10544b(0x249,0x229,0x254,0x23d)]}),{'client':s3Client,'config':s3Config};}async function refreshS3Client(){return s3Client=null,s3Config=null,await getS3Client(!![]);}async function testS3Connection(_0x11d187){function _0x2f2dc4(_0x185204,_0x2f0d26,_0x401451,_0x37d284){return _0x_0x2054(_0x401451- -0x260,_0x2f0d26);}function _0x422d1d(_0x2090d5,_0x28cafb,_0x11381b,_0x22d290){return _0x_0x2054(_0x22d290-0x3d1,_0x28cafb);}try{const _0x1323c1=new S3Client({'endpoint':_0x11d187[_0x422d1d(0x5d4,0x592,0x5d4,0x5b3)],'region':_0x11d187['region']||'us-east-1','credentials':{'accessKeyId':_0x11d187['accessKeyId'],'secretAccessKey':_0x11d187[_0x2f2dc4(-0x80,-0xa8,-0x80,-0x65)]},'forcePathStyle':_0x11d187[_0x2f2dc4(-0x4b,-0x49,-0x54,-0x3c)]===!![]||_0x11d187['pathStyle']===_0x2f2dc4(-0x65,-0x7e,-0x70,-0x73)}),_0x100088=new HeadBucketCommand({'Bucket':_0x11d187['bucket']});return await _0x1323c1['send'](_0x100088),{'success':!![],'message':_0x422d1d(0x5ba,0x5a2,0x5cb,0x5bf)};}catch(_0x58d349){console['error'](_0x2f2dc4(-0x85,-0x69,-0x8a,-0x8e),_0x58d349);let _0x459ded='S3连接测试失败';if(_0x58d349[_0x422d1d(0x5bf,0x5ac,0x58e,0x59d)]===_0x422d1d(0x5bc,0x5de,0x604,0x5df)){if(_0x422d1d(0x5de,0x5ee,0x5bd,0x5cc)==='XdWTX'){const _0x5b5eb1=new URL(_0x34e8d8[_0x2f2dc4(-0x7a,-0x77,-0x7e,-0xa3)]);_0x2b06d=_0x5b5eb1[_0x2f2dc4(-0xaa,-0x9e,-0x91,-0x95)]+'//'+_0x290d23[_0x422d1d(0x597,0x5a4,0x597,0x590)]+'.'+_0x5b5eb1[_0x422d1d(0x58d,0x58d,0x5a4,0x594)]+'/'+_0x3b40a9;}else _0x459ded=_0x2f2dc4(-0x92,-0xa4,-0x89,-0x6e);}else{if(_0x58d349['name']===_0x2f2dc4(-0x75,-0x7d,-0x57,-0x7d)||_0x58d349[_0x422d1d(0x5c4,0x582,0x5a4,0x59c)]===_0x2f2dc4(-0x43,-0x7f,-0x57,-0x64))_0x459ded=_0x2f2dc4(-0x83,-0x99,-0x97,-0xbb);else{if(_0x58d349[_0x2f2dc4(-0xa8,-0xad,-0x94,-0x9f)]===_0x422d1d(0x5e9,0x5d6,0x5b1,0x5c0)||_0x58d349[_0x2f2dc4(-0x92,-0xbe,-0x95,-0xa8)]===_0x2f2dc4(-0x7f,-0x7c,-0x71,-0x4f))_0x459ded=_0x422d1d(0x5af,0x5d3,0x5a2,0x5cb);else{if(_0x58d349[_0x2f2dc4(-0x59,-0x61,-0x5f,-0x6a)]===_0x2f2dc4(-0x60,-0x41,-0x50,-0x26)||_0x58d349[_0x422d1d(0x5ca,0x5eb,0x5f2,0x5d2)]===_0x2f2dc4(-0x74,-0x84,-0x74,-0x7a))_0x459ded=_0x2f2dc4(-0x9f,-0xbc,-0x9a,-0x75);else _0x58d349[_0x2f2dc4(-0x48,-0x4a,-0x4f,-0x35)]&&(_0x459ded=_0x58d349[_0x2f2dc4(-0x6e,-0x4d,-0x4f,-0x68)]);}}}return{'success':![],'message':_0x459ded};}}async function uploadToS3(localFilePath,_0x4f2039,_0x472931){const {client:_0x2499a6,config:_0x514d79}=await getS3Client();if(!_0x2499a6)throw new Error(_0x29656e(0x21a,0x220,0x1f7,0x1dc));const _0x9856bb=fs[_0x32f020(0x5b7,0x5a5,0x59e,0x585)](localFilePath);function _0x29656e(_0x3b0b81,_0x42cd4,_0x3deb57,_0x2109ef){return _0x_0x2054(_0x3deb57-0x30,_0x3b0b81);}function _0x32f020(_0xf9001b,_0x268a3c,_0x188e97,_0x46b081){return _0x_0x2054(_0x268a3c-0x3b0,_0x46b081);}const _0x517ade=new PutObjectCommand({'Bucket':_0x514d79[_0x29656e(0x215,0x1f2,0x1ef,0x216)],'Key':_0x4f2039,'Body':_0x9856bb,'ContentType':_0x472931,'ACL':_0x32f020(0x55c,0x574,0x54b,0x566)});await _0x2499a6[_0x32f020(0x572,0x585,0x59a,0x574)](_0x517ade);let _0x1a45cc;if(_0x514d79['customDomain'])_0x1a45cc=_0x514d79[_0x29656e(0x218,0x247,0x22f,0x23d)][_0x32f020(0x59c,0x5b8,0x5bc,0x5a8)](/\/$/,'')+'/'+_0x4f2039;else{if(_0x514d79[_0x32f020(0x592,0x5bc,0x5ba,0x5b7)])_0x1a45cc=_0x514d79[_0x32f020(0x57c,0x592,0x59a,0x5af)]+'/'+_0x514d79[_0x29656e(0x20d,0x200,0x1ef,0x1c6)]+'/'+_0x4f2039;else{if(_0x29656e(0x207,0x1fe,0x221,0x218)==='xltKL'){const _0x474ea3=new URL(_0x514d79[_0x29656e(0x224,0x22b,0x212,0x1f8)]);_0x1a45cc=_0x474ea3[_0x32f020(0x5a5,0x57f,0x55c,0x597)]+'//'+_0x514d79[_0x29656e(0x1de,0x1f5,0x1ef,0x1c7)]+'.'+_0x474ea3['host']+'/'+_0x4f2039;}else throw new _0x2e9a75('S3客户端未配置或存储类型不是S3');}}return _0x1a45cc;}async function deleteFromS3(_0x459ff8){const {client:_0x209256,config:_0x47c370}=await getS3Client();if(!_0x209256)throw new Error(_0x88ba62(0x111,0x12b,0x129,0x10d));function _0x88ba62(_0x5defa5,_0x3431fe,_0x2e9002,_0x49894){return _0x_0x2054(_0x2e9002- -0x9e,_0x3431fe);}let _0x220355=_0x459ff8;if(_0x459ff8[_0x4f5a47(0x29f,0x291,0x27b,0x284)]('http://')||_0x459ff8['startsWith'](_0x4f5a47(0x2ba,0x279,0x29a,0x271))){if(_0x47c370['customDomain']&&_0x459ff8[_0x4f5a47(0x283,0x281,0x27b,0x292)](_0x47c370[_0x4f5a47(0x26d,0x2b7,0x295,0x294)]))_0x220355=_0x459ff8[_0x88ba62(0x176,0x148,0x16a,0x159)](_0x47c370['customDomain'][_0x4f5a47(0x2b2,0x2c4,0x29e,0x29a)](/\/$/,'')+'/','');else{const _0x4bb005=new URL(_0x459ff8);_0x220355=_0x4bb005[_0x4f5a47(0x286,0x295,0x272,0x25a)][_0x88ba62(0x162,0x176,0x16a,0x151)](/^\//,'');if(_0x47c370[_0x4f5a47(0x290,0x2a4,0x2a2,0x2cc)]&&_0x220355[_0x88ba62(0x127,0x138,0x147,0x12c)](_0x47c370['bucket']+'/')){if(_0x4f5a47(0x28c,0x261,0x280,0x2a6)==='LpfpU'){const _0x591c98=moduleName?_0x88ba62(0x159,0x139,0x13d,0x117)+moduleName+'/'+_0x6bdc6b:'uploads/'+_0x188288;return _0x20ed8d['customDomain'][_0x88ba62(0x193,0x14d,0x16a,0x14f)](/\/$/,'')+'/'+_0x591c98;}else _0x220355=_0x220355[_0x4f5a47(0x296,0x288,0x29e,0x2a6)](_0x47c370['bucket']+'/','');}}}const _0xc1aacd=new DeleteObjectCommand({'Bucket':_0x47c370[_0x88ba62(0x122,0x147,0x121,0x10d)],'Key':_0x220355});await _0x209256[_0x4f5a47(0x244,0x24a,0x26b,0x28f)](_0xc1aacd);function _0x4f5a47(_0x422543,_0x25b1ea,_0x3155f8,_0x8acea4){return _0x_0x2054(_0x3155f8-0x96,_0x422543);}return!![];}async function isS3Enabled(){const _0x1545ca=await getS3Config();function _0x190194(_0x3d11c7,_0x507b92,_0x3efb53,_0x264822){return _0x_0x2054(_0x3efb53- -0x5c,_0x3d11c7);}function _0x4e6831(_0x3d6162,_0x119baf,_0x4cde71,_0x455d9d){return _0x_0x2054(_0x3d6162-0xd2,_0x4cde71);}return console['log'](_0x4e6831(0x2a4,0x2ac,0x295,0x2a3),{'storageType':_0x1545ca[_0x4e6831(0x294,0x27a,0x289,0x28f)],'endpoint':_0x1545ca['endpoint'],'bucket':_0x1545ca[_0x4e6831(0x291,0x29b,0x294,0x2aa)],'hasAccessKeyId':!!_0x1545ca['accessKeyId'],'hasSecretAccessKey':!!_0x1545ca[_0x190194(0x191,0x182,0x184,0x193)],'accessKeyIdPreview':_0x1545ca[_0x190194(0x1d4,0x1c7,0x1b3,0x1af)]?_0x1545ca[_0x190194(0x1d4,0x1ca,0x1b3,0x1d1)][_0x190194(0x1a3,0x17c,0x18f,0x1b7)](0xef2*0x2+-0x2527*-0x1+-0x430b,0x1*-0x1f42+-0xb29+0x2a6f)+_0x190194(0x164,0x177,0x18d,0x1ac)+_0x1545ca[_0x4e6831(0x2e1,0x2e2,0x2f3,0x2c4)][_0x190194(0x1b9,0x173,0x18f,0x18c)](_0x1545ca[_0x4e6831(0x2e1,0x2cb,0x30a,0x2fb)][_0x4e6831(0x2ce,0x2ce,0x2f0,0x2cb)]-(-0x2490+-0x1853+0x3ce7*0x1)):_0x190194(0x180,0x185,0x191,0x1a2),'secretAccessKeyPreview':_0x1545ca['secretAccessKey']?_0x1545ca[_0x190194(0x199,0x189,0x184,0x170)][_0x190194(0x1ac,0x168,0x18f,0x185)](0x1d3*0xc+-0x1562+-0xa*0xd,0x1b6+0xf08+0x85d*-0x2)+'...'+_0x1545ca['secretAccessKey'][_0x190194(0x185,0x199,0x18f,0x195)](_0x1545ca['secretAccessKey'][_0x4e6831(0x2ce,0x2b6,0x2e9,0x2a9)]-(0x94e+-0x2f4+0x2*-0x32b)):_0x4e6831(0x2bf,0x2de,0x2aa,0x2cf),'accessKeyIdLength':_0x1545ca[_0x4e6831(0x2e1,0x2ed,0x2c6,0x2bd)]?.[_0x190194(0x1b6,0x1ad,0x1a0,0x190)]||0x1c*0x5f+0x1aaa+-0x3*0xc5a,'secretAccessKeyLength':_0x1545ca[_0x4e6831(0x2b2,0x2c9,0x2b7,0x2da)]?.[_0x4e6831(0x2ce,0x2c0,0x2dd,0x2bf)]||-0x44*0x85+0x1*0x80b+0x1b49}),_0x1545ca[_0x190194(0x161,0x13d,0x166,0x15c)]==='s3';}async function getFileUrl(_0x57872e,moduleName,_0x2e3029){function _0x51d4a5(_0x589fbe,_0x338f2b,_0x3504c0,_0x52ca5b){return _0x_0x2054(_0x52ca5b-0x19e,_0x589fbe);}const _0x1f0bda=await getS3Config();function _0x58aee6(_0x3d43f9,_0x464f6c,_0x2ae697,_0x58dceb){return _0x_0x2054(_0x2ae697-0x1f9,_0x464f6c);}if(_0x1f0bda[_0x58aee6(0x3dc,0x3ba,0x3bb,0x3d7)]==='s3'&&_0x1f0bda[_0x58aee6(0x3f4,0x413,0x3f8,0x3da)]){if(_0x51d4a5(0x36a,0x378,0x3a4,0x37c)===_0x58aee6(0x3eb,0x3e8,0x3d7,0x3c2)){const _0x3c2b98=moduleName?_0x51d4a5(0x360,0x387,0x372,0x379)+moduleName+'/'+_0x57872e:_0x51d4a5(0x37f,0x36e,0x395,0x379)+_0x57872e;return _0x1f0bda[_0x51d4a5(0x37b,0x3bb,0x3be,0x39d)][_0x51d4a5(0x3c2,0x3aa,0x3b0,0x3a6)](/\/$/,'')+'/'+_0x3c2b98;}else{const _0x2f83bf=_0x29063e[_0x51d4a5(0x348,0x374,0x352,0x35f)](_0x1b4fff,arguments);return _0x30f0f4=null,_0x2f83bf;}}const _0x211386=require('../config/config');return _0x211386['getFileUrl'](_0x57872e,_0x2e3029);}module[_0x_0x6ef8a8(0x1e7,0x1a3,0x1c6,0x1c2)]={'getS3Config':getS3Config,'getS3Client':getS3Client,'refreshS3Client':refreshS3Client,'testS3Connection':testS3Connection,'uploadToS3':uploadToS3,'deleteFromS3':deleteFromS3,'isS3Enabled':isS3Enabled,'getFileUrl':getFileUrl};