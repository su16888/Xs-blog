(function(_0x32a273,_0x3164c5){const _0x34fa49=_0x32a273();function _0x4164f4(_0x15f389,_0x32b5c8,_0x5ca34c,_0x5c85e1){return _0x_0x14b5(_0x32b5c8-0x70,_0x5c85e1);}function _0x86a7b3(_0x58567e,_0x45e357,_0x2beeae,_0x14d85b){return _0x_0x14b5(_0x14d85b-0x174,_0x58567e);}while(!![]){try{const _0x44ffea=-parseInt(_0x86a7b3(0x1ec,0x21f,0x1f9,0x1fd))/(-0x4a2+0xfa1+-0xafe)+-parseInt(_0x86a7b3(0x243,0x246,0x232,0x22d))/(-0x1e*-0x90+-0xf5e*-0x1+-0x203c)+-parseInt(_0x4164f4(0x141,0x123,0x124,0x10f))/(-0x3e9+-0x1e06+0x6e*0x4f)+-parseInt(_0x4164f4(0xf5,0xee,0xd3,0x113))/(0xb20+0x2*0x10f6+-0x2d08)*(parseInt(_0x4164f4(0x148,0x12f,0x117,0x11e))/(-0x43+0x2129+-0x20e1))+-parseInt(_0x86a7b3(0x1dd,0x1f4,0x1f8,0x1f6))/(0x1ac0+0x141b+-0x2ed5)*(parseInt(_0x86a7b3(0x239,0x22a,0x211,0x237))/(0x399*0x2+-0x11e*-0x1+-0x849))+parseInt(_0x4164f4(0x114,0x10a,0x12a,0x121))/(-0xbf7+0x466*0x7+-0x12cb)+parseInt(_0x4164f4(0x10c,0x102,0x10a,0xf7))/(0x393+0x1*0x2291+-0x79f*0x5);if(_0x44ffea===_0x3164c5)break;else _0x34fa49['push'](_0x34fa49['shift']());}catch(_0x5b7fe6){_0x34fa49['push'](_0x34fa49['shift']());}}}(_0x_0x347f,0x2343a*-0x2+0x2*-0x69185+-0x1f7*-0xd55));const _0x_0x28447c=(function(){let _0x4c6973=!![];return function(_0x53c6c9,_0x3738b2){const _0x53b8c0=_0x4c6973?function(){function _0x12a466(_0x22f48b,_0x5390df,_0x3c13e5,_0x5518ab){return _0x_0x14b5(_0x22f48b- -0x2b4,_0x5518ab);}function _0x43b2b2(_0x306d54,_0xe5f92f,_0x3ce3bc,_0xe4970d){return _0x_0x14b5(_0xe4970d-0x148,_0xe5f92f);}if('bLpRS'===_0x43b2b2(0x1f9,0x1f1,0x1e7,0x1f6))_0x10c21b=_0x89fbc1['customDomain'][_0x43b2b2(0x1e7,0x1ef,0x1f5,0x20d)](/\/$/,'')+'/'+_0x12c588;else{if(_0x3738b2){const _0x37b674=_0x3738b2[_0x12a466(-0x20b,-0x1f9,-0x20f,-0x20b)](_0x53c6c9,arguments);return _0x3738b2=null,_0x37b674;}}}:function(){};return _0x4c6973=![],_0x53b8c0;};}()),_0x_0x3f6553=_0x_0x28447c(this,function(){function _0x3f9fab(_0x4bfb52,_0x5eb85d,_0x412c4f,_0x5ebcb7){return _0x_0x14b5(_0x4bfb52- -0x230,_0x5ebcb7);}function _0x34137(_0x150c17,_0x7f8688,_0xedd502,_0x5114f5){return _0x_0x14b5(_0x150c17- -0x1c,_0xedd502);}return _0x_0x3f6553[_0x3f9fab(-0x17e,-0x169,-0x173,-0x16f)]()[_0x3f9fab(-0x175,-0x18c,-0x173,-0x161)](_0x34137(0x70,0x71,0x91,0x6c))[_0x34137(0x96,0x95,0x78,0xae)]()[_0x34137(0x73,0x62,0x68,0x5a)](_0x_0x3f6553)[_0x34137(0x9f,0x97,0xaa,0x89)](_0x3f9fab(-0x1a4,-0x1bd,-0x1b5,-0x190));});_0x_0x3f6553();const {S3Client,PutObjectCommand,DeleteObjectCommand,HeadBucketCommand}=require('@aws-sdk/client-s3'),fs=require('fs'),path=require('path'),Setting=require('../models/Setting'),databaseEncryption=require('../utils/databaseEncryption');let s3Client=null,s3Config=null;async function getS3Config(){function _0x34e347(_0xaeb5b7,_0x256645,_0x299645,_0x161fac){return _0x_0x14b5(_0xaeb5b7- -0x2a6,_0x256645);}function _0x507da2(_0x2cda72,_0x22f113,_0x5eab9c,_0x22e5ec){return _0x_0x14b5(_0x22e5ec- -0xdd,_0x22f113);}try{const _0x589e05=await Setting[_0x34e347(-0x210,-0x207,-0x219,-0x22e)]({'where':{'key':[_0x507da2(-0x34,-0x2d,-0x3a,-0x20),_0x34e347(-0x215,-0x227,-0x233,-0x206),_0x507da2(-0x52,-0x2c,-0x24,-0x33),_0x507da2(-0x58,-0x33,-0x64,-0x4a),_0x34e347(-0x200,-0x204,-0x20b,-0x216),_0x507da2(-0x5d,-0x61,-0x36,-0x4d),_0x507da2(-0x22,-0x59,-0x50,-0x44),_0x507da2(-0x10,-0x10,-0x20,-0x19)]}}),_0x324e87={};_0x589e05[_0x507da2(-0x37,-0x50,-0x78,-0x56)](_0x1f70a8=>{function _0x438a5d(_0x5b2fad,_0x2719e2,_0x19dd5e,_0x545403){return _0x507da2(_0x5b2fad-0x10b,_0x5b2fad,_0x19dd5e-0xeb,_0x19dd5e-0x47);}_0x324e87[_0x1f70a8[_0x438a5d(0x1,-0x11,-0x15,-0x3)]]=_0x1f70a8['value'];});let _0x13dc86=_0x324e87[_0x507da2(-0x47,-0x47,-0x1c,-0x37)]||'',_0x22451f=_0x324e87[_0x507da2(-0x5a,-0x33,-0x56,-0x4d)]||'';return databaseEncryption[_0x34e347(-0x219,-0x225,-0x228,-0x21e)](_0x13dc86)&&(_0x13dc86=databaseEncryption[_0x34e347(-0x212,-0x219,-0x1f1,-0x22c)](_0x13dc86)),databaseEncryption['isEncrypted'](_0x22451f)&&(_0x22451f=databaseEncryption[_0x507da2(-0x32,-0x41,-0x62,-0x49)](_0x22451f)),_0x13dc86=_0x13dc86['trim'](),_0x22451f=_0x22451f['trim'](),{'storageType':_0x324e87['storageType']||_0x507da2(-0x54,-0x1a,-0x2b,-0x3b),'endpoint':_0x324e87['s3Endpoint']||'','region':_0x324e87[_0x507da2(-0x2a,-0x23,-0x4b,-0x33)]||_0x34e347(-0x1f1,-0x1fe,-0x1ea,-0x1d8),'bucket':_0x324e87['s3Bucket']||'','accessKeyId':_0x13dc86,'secretAccessKey':_0x22451f,'customDomain':_0x324e87[_0x34e347(-0x20d,-0x1fe,-0x1f5,-0x201)]||'','pathStyle':_0x324e87['s3PathStyle']===_0x34e347(-0x20b,-0x227,-0x1f6,-0x210)};}catch(_0x1346b4){return console[_0x34e347(-0x1f0,-0x206,-0x1ed,-0x1d6)]('获取S3配置失败:',_0x1346b4),{'storageType':_0x507da2(-0x36,-0x34,-0x3f,-0x3b)};}}async function getS3Client(_0xf57846=![]){if(s3Client&&!_0xf57846)return{'client':s3Client,'config':s3Config};s3Config=await getS3Config();if(s3Config[_0x236944(0x1ff,0x212,0x215,0x22e)]!=='s3'||!s3Config[_0x236944(0x1e4,0x1d1,0x1db,0x1d0)]||!s3Config['accessKeyId']||!s3Config[_0x236944(0x1ea,0x1fd,0x1d7,0x1df)])return{'client':null,'config':s3Config};function _0x236944(_0x2fc02a,_0x19989c,_0x34ba28,_0x446769){return _0x_0x14b5(_0x19989c-0x155,_0x2fc02a);}function _0x4ec19b(_0x18aed9,_0xeb317c,_0x3c20ad,_0x2ef525){return _0x_0x14b5(_0x3c20ad-0x31b,_0x2ef525);}return s3Client=new S3Client({'endpoint':s3Config['endpoint'],'region':s3Config[_0x4ec19b(0x3d0,0x3ee,0x3d9,0x3c6)]||_0x4ec19b(0x3bf,0x3b6,0x3d0,0x3e9),'credentials':{'accessKeyId':s3Config[_0x236944(0x21c,0x1f6,0x1d0,0x1df)],'secretAccessKey':s3Config[_0x236944(0x1dc,0x1fd,0x222,0x1e9)]},'forcePathStyle':s3Config['pathStyle']}),{'client':s3Client,'config':s3Config};}async function refreshS3Client(){return s3Client=null,s3Config=null,await getS3Client(!![]);}function _0x_0x347f(){const _0x37a020=['CZntzwnYzxrby2nLC3nlzxK','CZnfBMrWB2LUDa','mtG3mteWodflwLzIzgK','CZncDwnRzxq','zgvJCNLWDezPzwXK','z2vZvMC','zMLUzefSBa','q29Kzq','uZpOV57MJQxMTyVOR5xLPlhOTku6','CZndDxn0B21eB21HAw4','mtCYnJiZmMLnD05bBW','Dhj1zq','BwvZC2fNzq','qvvrzK0','sw52ywXPzefJy2vZC0TLEuLK','Bg9N','ru5pvezpvu5e','ywnJzxnZs2v5swq','Bg9JywW','u2LNBMf0DxjLrg9LC05VDe1HDgnO','tM90rM91BMq','C3vIC3rYAw5N','CZnby2nLC3nlzxLjza','5A2y5ykO5Qg25lIn5A2y5zYO','C2vJCMv0qwnJzxnZs2v5','yxbWBhK','CZnszwDPB24','uZpOV57MJQxMTyVOR5xMIjdLIP8','y3vZDg9Trg9TywLU','yNvJA2v0','CgLYwwm','wvzIBxm','BMfTzq','Ahr0Chm6lY8','Dg9tDhjPBMC','mJCYnZG3sw9wDgrA','lI4U','DxmTzwfZDc0X','zxjYB3i','zw1WDhK','5PEG5Rov6l+E5O6L5yIWuZpNQ6/NGRNVViZOR7FMO4dMN6xNQ6/NGRNLNldLNya','otu0nta4DNjoz3jI','DxbSB2fKCY8','C2vHCMnO','z2v0rMLSzvvYBa','C3rVCMfNzvr5Cgu','CMvNAw9U','mZyYntG1rvj4Egjp','svrzEhq','ChvIBgLJlxjLywq','ChjVDg9JB2W','mJfXtwfPtKC','CZnqyxrOu3r5Bgu','CMvWBgfJzq','Ahr0CdOVlW','6i635y+wuZpPHy3NVA7LPlhOTku6','zw5KCg9PBNq','C3rHCNrZv2L0Aa','mtjxww13CKe','C2vUza','CLH5B0W','A2v5','mZC0mZGYvhjAyNzK','Cgf0Afn0EwXL','y29Kzq','sNnhr0q','uZpLRQlMIlFNQ6/MNkRPHy3NVA7MIjBLRzJLGQJNSBVLNOVKUi3MMk9tmW','zM9YrwfJAa','Ee5JwLa','nZu0otq2AKLpqvjx','BgvUz3rO','sw5iu1a','kcGOlISPkYKRksSK','AxnfBMnYExb0zwq','runptK5sruzvu0ve','y29UC3rYDwn0B3i'];_0x_0x347f=function(){return _0x37a020;};return _0x_0x347f();}async function testS3Connection(_0x27e01a){function _0xd57dcf(_0x5876e8,_0x39b15b,_0x4ab187,_0x12764b){return _0x_0x14b5(_0x4ab187- -0x2fd,_0x5876e8);}function _0x53b1ed(_0x403cdc,_0x7f281c,_0x566fb0,_0x472827){return _0x_0x14b5(_0x403cdc- -0x19,_0x566fb0);}try{const _0x31297f=new S3Client({'endpoint':_0x27e01a[_0x53b1ed(0x63,0x7d,0x51,0x7a)],'region':_0x27e01a[_0xd57dcf(-0x22a,-0x225,-0x23f,-0x227)]||_0xd57dcf(-0x256,-0x25b,-0x248,-0x241),'credentials':{'accessKeyId':_0x27e01a['accessKeyId'],'secretAccessKey':_0x27e01a[_0x53b1ed(0x8f,0xab,0xaf,0xa7)]},'forcePathStyle':_0x27e01a[_0x53b1ed(0x6a,0x7f,0x48,0x46)]===!![]||_0x27e01a['pathStyle']===_0x53b1ed(0x82,0x89,0x75,0xa6)}),_0x3e9e2b=new HeadBucketCommand({'Bucket':_0x27e01a[_0x53b1ed(0x94,0x89,0x9f,0x7f)]});return await _0x31297f[_0xd57dcf(-0x270,-0x28f,-0x27e,-0x28d)](_0x3e9e2b),{'success':!![],'message':_0x53b1ed(0x92,0xb8,0xb5,0xb1)};}catch(_0x384f50){console[_0x53b1ed(0x9d,0xa0,0xa3,0xb4)](_0xd57dcf(-0x247,-0x258,-0x265,-0x240),_0x384f50);let _0x30519c='S3连接测试失败';if(_0x384f50['name']===_0xd57dcf(-0x276,-0x25e,-0x259,-0x23f))_0x30519c='存储桶不存在';else{if(_0x384f50[_0x53b1ed(0x97,0x9f,0x97,0xa9)]===_0xd57dcf(-0x259,-0x25d,-0x25f,-0x27c)||_0x384f50[_0xd57dcf(-0x243,-0x248,-0x266,-0x24e)]===_0x53b1ed(0x85,0xa6,0x69,0x95))_0xd57dcf(-0x27d,-0x25d,-0x260,-0x282)===_0xd57dcf(-0x27d,-0x274,-0x275,-0x273)?_0x1624f5=_0x9252ea[_0xd57dcf(-0x254,-0x273,-0x269,-0x266)](_0x35e9b2):_0x30519c='Access\x20Key\x20ID\x20无效';else{if(_0x384f50[_0xd57dcf(-0x26e,-0x252,-0x24d,-0x253)]==='SignatureDoesNotMatch'||_0x384f50[_0xd57dcf(-0x25f,-0x26c,-0x266,-0x243)]===_0xd57dcf(-0x266,-0x253,-0x25a,-0x240))_0x30519c='Secret\x20Access\x20Key\x20无效';else{if(_0x384f50[_0xd57dcf(-0x29c,-0x26f,-0x279,-0x25b)]===_0xd57dcf(-0x256,-0x24c,-0x25d,-0x24a)||_0x384f50[_0x53b1ed(0x6b,0x7e,0x6d,0x90)]===_0xd57dcf(-0x278,-0x253,-0x26f,-0x260))_0x30519c=_0x53b1ed(0x9f,0xb1,0x8d,0x8a);else _0x384f50['message']&&(_0x30519c=_0x384f50[_0x53b1ed(0x83,0x94,0x9d,0x91)]);}}}return{'success':![],'message':_0x30519c};}}function _0x_0x14b5(_0x299301,_0xcb9709){_0x299301=_0x299301-(0x8*0x169+-0xf43+-0x23b*-0x2);const _0x591c8b=_0x_0x347f();let _0x279d9b=_0x591c8b[_0x299301];if(_0x_0x14b5['xzHPWl']===undefined){var _0x246eae=function(_0x1e8a63){const _0x1804f6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1c41d7='',_0x152820='',_0x13b342=_0x1c41d7+_0x246eae;for(let _0x29f05f=-0xdae*0x2+-0x11d*0xc+0x2*0x145c,_0x5be3f6,_0x3234f3,_0xf2c7e7=0x3e5*-0x9+-0x230d+0x175e*0x3;_0x3234f3=_0x1e8a63['charAt'](_0xf2c7e7++);~_0x3234f3&&(_0x5be3f6=_0x29f05f%(-0x6c7*-0x4+0x8*0x236+-0x4*0xb32)?_0x5be3f6*(-0x11ef*0x2+-0x1604+0x3a22)+_0x3234f3:_0x3234f3,_0x29f05f++%(-0x76d+-0x2544+0x147*0x23))?_0x1c41d7+=_0x13b342['charCodeAt'](_0xf2c7e7+(0xb*0x20b+-0x4*-0x320+-0xb*0x32d))-(-0x1*-0x239e+0x2585*-0x1+0x1*0x1f1)!==0x1*0x133b+-0xd04+0x1*-0x637?String['fromCharCode'](-0x21fd+-0x11a*0x13+0x37ea&_0x5be3f6>>(-(0x9c*0x1a+-0x2*-0x11b6+-0x3342)*_0x29f05f&-0x3*-0x35e+-0x3a4+-0x670)):_0x29f05f:-0x556*-0x2+0x1a8b+-0x2537*0x1){_0x3234f3=_0x1804f6['indexOf'](_0x3234f3);}for(let _0x16b37f=-0xe*-0x159+0x1b42+0x6*-0x7b0,_0x4935b3=_0x1c41d7['length'];_0x16b37f<_0x4935b3;_0x16b37f++){_0x152820+='%'+('00'+_0x1c41d7['charCodeAt'](_0x16b37f)['toString'](-0x1c6d+-0x1d3e+0x39bb))['slice'](-(-0x1b38+0xda4+-0x2f*-0x4a));}return decodeURIComponent(_0x152820);};_0x_0x14b5['uoQyfL']=_0x246eae,_0x_0x14b5['iVAGIJ']={},_0x_0x14b5['xzHPWl']=!![];}const _0x53b298=_0x591c8b[-0x1*0x97a+0x2e3*-0x1+0x1*0xc5d],_0x53d393=_0x299301+_0x53b298,_0x34c204=_0x_0x14b5['iVAGIJ'][_0x53d393];if(!_0x34c204){const _0x52f86e=function(_0x159f6b){this['PoWIyw']=_0x159f6b,this['bviyjm']=[-0x247+0x1*-0xd85+0xfcd*0x1,0x2026+0x1cd+-0x21f3,0x7*-0x4d5+-0x1f3c*0x1+0x410f],this['ypJLrm']=function(){return'newState';},this['najVsK']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['syfbJM']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x52f86e['prototype']['VFWbnZ']=function(){const _0x1f864f=new RegExp(this['najVsK']+this['syfbJM']),_0x511f4d=_0x1f864f['test'](this['ypJLrm']['toString']())?--this['bviyjm'][-0x147d+0x1263+0x21b]:--this['bviyjm'][-0x19c7*0x1+0x467+0x1560];return this['RtJMtQ'](_0x511f4d);},_0x52f86e['prototype']['RtJMtQ']=function(_0x5c1e90){if(!Boolean(~_0x5c1e90))return _0x5c1e90;return this['NpREvw'](this['PoWIyw']);},_0x52f86e['prototype']['NpREvw']=function(_0xf6d943){for(let _0x525b15=0x25ab+0x36d*-0x1+-0x223e,_0x535d83=this['bviyjm']['length'];_0x525b15<_0x535d83;_0x525b15++){this['bviyjm']['push'](Math['round'](Math['random']())),_0x535d83=this['bviyjm']['length'];}return _0xf6d943(this['bviyjm'][0x5d4+0x1*-0x14a1+-0x3*-0x4ef]);},new _0x52f86e(_0x_0x14b5)['VFWbnZ'](),_0x279d9b=_0x_0x14b5['uoQyfL'](_0x279d9b),_0x_0x14b5['iVAGIJ'][_0x53d393]=_0x279d9b;}else _0x279d9b=_0x34c204;return _0x279d9b;}async function uploadToS3(localFilePath,_0x2dd36e,_0x3c6a61){const {client:_0x39731f,config:_0x41ab94}=await getS3Client();function _0x2a6816(_0x15c90f,_0x1fc1e0,_0x18b160,_0x46e9ee){return _0x_0x14b5(_0x18b160-0x1d9,_0x46e9ee);}if(!_0x39731f){if('tBYtQ'!==_0x2a6816(0x270,0x25a,0x25e,0x26b))throw new Error(_0x2a6816(0x27b,0x244,0x25f,0x262));else{const _0x5535ca=moduleName?'uploads/'+moduleName+'/'+_0x2eb246:_0x4e7183(0x2d5,0x2e5,0x2ec,0x2b4)+_0x4e33f8;return _0x24bdd2['customDomain'][_0x4e7183(0x2e0,0x2fb,0x2bb,0x2ba)](/\/$/,'')+'/'+_0x5535ca;}}function _0x4e7183(_0xee208c,_0x5238f,_0xab1dd6,_0x45f322){return _0x_0x14b5(_0xee208c-0x21b,_0x5238f);}const _0x1b1f8c=fs['readFileSync'](localFilePath),_0x1893e7=new PutObjectCommand({'Bucket':_0x41ab94[_0x2a6816(0x299,0x260,0x286,0x279)],'Key':_0x2dd36e,'Body':_0x1b1f8c,'ContentType':_0x3c6a61,'ACL':_0x4e7183(0x2dc,0x2c4,0x2c6,0x2e0)});await _0x39731f[_0x4e7183(0x29a,0x2bb,0x294,0x2a2)](_0x1893e7);let _0x654cdb;if(_0x41ab94[_0x2a6816(0x27e,0x291,0x285,0x264)])_0x4e7183(0x2a6,0x28d,0x2bf,0x2c1)===_0x4e7183(0x2a6,0x2c0,0x29c,0x2c0)?_0x654cdb=_0x41ab94['customDomain'][_0x4e7183(0x2e0,0x2c2,0x2d9,0x2bd)](/\/$/,'')+'/'+_0x2dd36e:_0x3cb61c=_0x4e7183(0x2c2,0x2d8,0x2d2,0x2cf);else{if(_0x2a6816(0x296,0x27b,0x299,0x27e)!==_0x4e7183(0x2db,0x2c0,0x2c2,0x2c4))_0xa690e2=_0x4e7183(0x2d3,0x2f3,0x2f7,0x2d5);else{if(_0x41ab94[_0x4e7183(0x29e,0x2ba,0x28e,0x2a4)])_0x654cdb=_0x41ab94[_0x2a6816(0x238,0x243,0x255,0x25a)]+'/'+_0x41ab94[_0x4e7183(0x2c8,0x2c9,0x2db,0x2dd)]+'/'+_0x2dd36e;else{const _0x55b911=new URL(_0x41ab94['endpoint']);_0x654cdb=_0x55b911[_0x4e7183(0x2dd,0x2e5,0x2f8,0x2bc)]+'//'+_0x41ab94[_0x2a6816(0x27d,0x26b,0x286,0x2a4)]+'.'+_0x55b911['host']+'/'+_0x2dd36e;}}}return _0x654cdb;}async function deleteFromS3(_0x11224a){const {client:_0x285b42,config:_0x5851fe}=await getS3Client();if(!_0x285b42)throw new Error(_0x3a55b7(-0x21b,-0x22e,-0x227,-0x237));let _0x3ab979=_0x11224a;if(_0x11224a['startsWith'](_0x3a55b7(-0x1e2,-0x1ee,-0x1fa,-0x20b))||_0x11224a[_0x3a55b7(-0x252,-0x237,-0x24b,-0x255)](_0x4b1218(-0x119,-0xff,-0x107,-0x112))){if(_0x5851fe[_0x3a55b7(-0x218,-0x208,-0x200,-0x21e)]&&_0x11224a[_0x4b1218(-0x148,-0x128,-0x13b,-0x149)](_0x5851fe[_0x3a55b7(-0x215,-0x208,-0x22e,-0x209)])){if('rXyoL'===_0x4b1218(-0x129,-0x119,-0x138,-0x119))_0x3ab979=_0x11224a[_0x3a55b7(-0x1f0,-0x1ef,-0x1ec,-0x1d1)](_0x5851fe[_0x3a55b7(-0x1e7,-0x208,-0x1e8,-0x218)][_0x4b1218(-0x119,-0xe5,-0xf3,-0x112)](/\/$/,'')+'/','');else return _0x5de582['toString']()['search'](_0x4b1218(-0x121,-0x121,-0x12c,-0x10c))[_0x3a55b7(-0x200,-0x202,-0x20a,-0x221)]()[_0x3a55b7(-0x23f,-0x225,-0x243,-0x201)](_0x4bcc40)[_0x3a55b7(-0x200,-0x1f9,-0x211,-0x205)](_0x3a55b7(-0x244,-0x228,-0x240,-0x238));}else{const _0x54b470=new URL(_0x11224a);_0x3ab979=_0x54b470['pathname'][_0x4b1218(-0x10a,-0x117,-0xf3,-0xf3)](/^\//,'');if(_0x5851fe['pathStyle']&&_0x3ab979[_0x4b1218(-0x11a,-0x12c,-0x13b,-0x11d)](_0x5851fe[_0x4b1218(-0x113,-0xec,-0x10b,-0xf9)]+'/')){if(_0x3a55b7(-0x22e,-0x21f,-0x234,-0x205)!==_0x4b1218(-0x11b,-0x12a,-0x109,-0xf9))_0x3ab979=_0x3ab979['replace'](_0x5851fe[_0x3a55b7(-0x1e6,-0x207,-0x21f,-0x22a)]+'/','');else return console[_0x4b1218(-0x112,-0x107,-0x102,-0xdd)](_0x4b1218(-0x123,-0x121,-0x13d,-0x128),_0x21dfd2),{'storageType':_0x4b1218(-0x13b,-0x11a,-0x116,-0x10e)};}}}const _0x47c4f7=new DeleteObjectCommand({'Bucket':_0x5851fe[_0x4b1218(-0xe7,-0x123,-0x10b,-0x11e)],'Key':_0x3ab979});function _0x3a55b7(_0x124678,_0x104b03,_0x33d390,_0x234afd){return _0x_0x14b5(_0x104b03- -0x2b4,_0x234afd);}await _0x285b42[_0x4b1218(-0x132,-0x14b,-0x139,-0x11b)](_0x47c4f7);function _0x4b1218(_0x2a680d,_0x50de06,_0x3e6805,_0x13f52b){return _0x_0x14b5(_0x3e6805- -0x1b8,_0x13f52b);}return!![];}async function isS3Enabled(){function _0x1f1029(_0x3e5233,_0x68c4e9,_0x502d3c,_0x51f008){return _0x_0x14b5(_0x502d3c- -0x5f,_0x68c4e9);}function _0x270a3c(_0x17d4aa,_0x1665cb,_0x563ff1,_0x4bf70a){return _0x_0x14b5(_0x1665cb- -0x245,_0x17d4aa);}const _0x173a80=await getS3Config();return console[_0x270a3c(-0x1a6,-0x1a6,-0x1be,-0x1c1)]('[S3Service]\x20getS3Config\x20result:',{'storageType':_0x173a80[_0x1f1029(0x65,0x58,0x5e,0x73)],'endpoint':_0x173a80[_0x1f1029(0x3e,0x3,0x1d,0x10)],'bucket':_0x173a80[_0x1f1029(0x33,0x5d,0x4e,0x73)],'hasAccessKeyId':!!_0x173a80[_0x270a3c(-0x19b,-0x1a4,-0x1ad,-0x1c1)],'hasSecretAccessKey':!!_0x173a80[_0x1f1029(0x3e,0x46,0x49,0x24)],'accessKeyIdPreview':_0x173a80[_0x1f1029(0x34,0x57,0x42,0x54)]?_0x173a80['accessKeyId'][_0x1f1029(0x41,0x4e,0x46,0x51)](0x1040*0x1+-0x140*-0x1a+-0x30c0,0x124a*-0x1+-0xf6d+0x21bb*0x1)+_0x1f1029(0x58,0x7b,0x55,0x36)+_0x173a80['accessKeyId'][_0x270a3c(-0x1af,-0x1a0,-0x19c,-0x1c3)](_0x173a80[_0x270a3c(-0x1c1,-0x1a4,-0x198,-0x190)]['length']-(-0xc*-0x12e+0x1f76+-0x2d9a)):_0x1f1029(0x58,0x3c,0x58,0x3f),'secretAccessKeyPreview':_0x173a80[_0x1f1029(0x2a,0x25,0x49,0x55)]?_0x173a80[_0x1f1029(0x25,0x2a,0x49,0x66)][_0x270a3c(-0x1b5,-0x1a0,-0x192,-0x181)](-0x71+0x1208+-0x1197,-0x1a31+-0x1146+0x1*0x2b7b)+_0x1f1029(0x48,0x65,0x55,0x5c)+_0x173a80[_0x270a3c(-0x191,-0x19d,-0x19b,-0x1c2)][_0x270a3c(-0x1bb,-0x1a0,-0x1a7,-0x1b1)](_0x173a80['secretAccessKey'][_0x270a3c(-0x1bf,-0x1bb,-0x197,-0x1c6)]-(0xd*-0x101+-0x1c8c+0x299d)):_0x1f1029(0x3c,0x47,0x58,0x62),'accessKeyIdLength':_0x173a80[_0x1f1029(0x67,0x1e,0x42,0x46)]?.['length']||0x237b*-0x1+0x9df+-0x2c*-0x95,'secretAccessKeyLength':_0x173a80[_0x270a3c(-0x194,-0x19d,-0x18d,-0x192)]?.[_0x1f1029(0x4c,0x33,0x2b,0x10)]||-0x2*0x584+0x1397+-0x139*0x7}),_0x173a80[_0x1f1029(0x38,0x3b,0x5e,0x5c)]==='s3';}async function getFileUrl(_0x1c7aff,moduleName,_0x55320b){const _0x2ffc82=await getS3Config();function _0xd4ec1d(_0x3d23fc,_0xef55de,_0x5145b7,_0x4218c8){return _0x_0x14b5(_0x5145b7-0x22b,_0xef55de);}function _0x6b066a(_0x231edf,_0x557661,_0xe529b9,_0x474b1c){return _0x_0x14b5(_0xe529b9-0x19b,_0x474b1c);}if(_0x2ffc82[_0xd4ec1d(0x2d8,0x2fc,0x2e8,0x2f0)]==='s3'&&_0x2ffc82['customDomain']){const _0x306b08=moduleName?_0xd4ec1d(0x2f7,0x2ec,0x2e5,0x2f1)+moduleName+'/'+_0x1c7aff:_0x6b066a(0x278,0x265,0x255,0x26e)+_0x1c7aff;return _0x2ffc82['customDomain'][_0x6b066a(0x273,0x261,0x260,0x261)](/\/$/,'')+'/'+_0x306b08;}const _0x6911fb=require('../config/config');return _0x6911fb[_0xd4ec1d(0x30c,0x2f2,0x2e7,0x30d)](_0x1c7aff,_0x55320b);}module['exports']={'getS3Config':getS3Config,'getS3Client':getS3Client,'refreshS3Client':refreshS3Client,'testS3Connection':testS3Connection,'uploadToS3':uploadToS3,'deleteFromS3':deleteFromS3,'isS3Enabled':isS3Enabled,'getFileUrl':getFileUrl};