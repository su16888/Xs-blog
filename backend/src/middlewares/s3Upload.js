(function(_0x521a89,_0x5c5ccd){function _0x5ed4f5(_0x40d31b,_0x5969df,_0x3e03e4,_0x3e5818){return _0x_0x2aa2(_0x5969df-0x3c7,_0x3e5818);}const _0x30c0e1=_0x521a89();function _0x4e6fb4(_0x5cbfce,_0x491929,_0xcb6a6,_0x5777fa){return _0x_0x2aa2(_0x5cbfce-0x134,_0xcb6a6);}while(!![]){try{const _0x12f384=-parseInt(_0x5ed4f5(0x535,0x53e,0x548,0x555))/(0x15b7+-0xcfd+-0x1*0x8b9)+parseInt(_0x4e6fb4(0x294,0x2ab,0x2ae,0x28c))/(-0x2*0xb1e+-0x4*-0x54f+-0x102*-0x1)+-parseInt(_0x5ed4f5(0x534,0x521,0x508,0x51c))/(-0x2e*0x11+-0x9*-0x135+-0x7cc*0x1)+parseInt(_0x4e6fb4(0x2a5,0x298,0x289,0x29b))/(0x3f5*-0x2+-0x1a33+0x1*0x2221)+-parseInt(_0x5ed4f5(0x521,0x53a,0x545,0x53e))/(0x35*-0x83+-0x2*0x569+0x25f6)+parseInt(_0x4e6fb4(0x2b0,0x29c,0x295,0x29f))/(-0x16*-0x9a+0x1492+-0x178*0x17)+parseInt(_0x4e6fb4(0x2af,0x29a,0x2c9,0x294))/(0x9e2+0x3*-0xafb+-0x49e*-0x5);if(_0x12f384===_0x5c5ccd)break;else _0x30c0e1['push'](_0x30c0e1['shift']());}catch(_0x19323c){_0x30c0e1['push'](_0x30c0e1['shift']());}}}(_0x_0x1378,0x1*-0x79343+-0x2ba3f+-0x2*-0x7dfc5));const _0x_0xd075d7=(function(){let _0x4355c2=!![];return function(_0xae08dd,_0x133f1d){const _0x5d360b=_0x4355c2?function(){if(_0x133f1d){const _0x155427=_0x133f1d['apply'](_0xae08dd,arguments);return _0x133f1d=null,_0x155427;}}:function(){};return _0x4355c2=![],_0x5d360b;};}()),_0x_0x2a8f69=_0x_0xd075d7(this,function(){function _0xb138cd(_0x5b2d82,_0x393a70,_0x188e5c,_0x3abde4){return _0x_0x2aa2(_0x5b2d82- -0x248,_0x393a70);}function _0x5df450(_0xd094da,_0x6ac0a2,_0x38c265,_0x4bdb29){return _0x_0x2aa2(_0x4bdb29- -0x2ce,_0x38c265);}return _0x_0x2a8f69[_0xb138cd(-0xd9,-0xcf,-0xf5,-0xc9)]()[_0x5df450(-0x143,-0x135,-0x15b,-0x147)]('(((.+)+)+)+$')[_0xb138cd(-0xd9,-0xde,-0xd0,-0xc0)]()[_0xb138cd(-0xc2,-0xc9,-0xa9,-0xd5)](_0x_0x2a8f69)[_0xb138cd(-0xc1,-0xaa,-0xb7,-0xb3)](_0x5df450(-0x158,-0x160,-0x17b,-0x16f));});_0x_0x2a8f69();function _0x_0x1378(){const _0x3c6e2d=['zMLSzq','AM9PBG','BwvZC2fNzq','yNvJA2v0','Aw5KzxHpzG','Bhr3zxO','ndu5mJq5v3DVBMHO','zw52','zxjYB3i','Dw5SAw5Ru3LUyW','zMLSzxm','kcGOlISPkYKRksSK','mJy5mdC4CevSuvPM','Axntm0vUywjSzwq','AuHfDvK','C3vIC3rYAw5N','zgvSzxrLrNjVBvmZ','zMLAC2S','CgL4EeK','5yIG6zMK5PAh5lU25AsX6lsLoG','Bg9N','uZpLIkdPMAtOT7pOV4C6','5PAh5lU25yIG6zMK6k2M5zgkoG','yxbWBhK','v1L6Ave','CZnlzxK','zxHPC3rZu3LUyW','Dg9tDhjPBMC','vvbmt0fex0rjuG','mJyYnta4oeDizxz1uW','zw5KCg9PBNq','mtaZndeYmfz5ugThtG','w1mZvxbSB2fKxsbtm+ACQUwqR+EuQo+8Jos9V+EuQoACRowCSowTMowcQa','Cgf0Aa','ChvZAa','ntC5mdyZwfrtuKvI','BgvUz3rO','BwLTzxr5Cgu','CZnvCMW','mZq1mZK2oezpt2feDG','nJK2ndjjEK51ru4','z2v0rMLSzvbHDgHgCM9TvxjS','uZpKUiRKVkdLPitNKiBLPlhOTku6','CMvWBgfJzq','w1mZvxbSB2fKxsbPC1mZrw5HyMXLzdO','wuzkwMm','zxHWB3j0CW','zMLSzw5HBwu','DxbSB2fKCW','C3rHCNrZv2L0Aa','y29UC3rYDwn0B3i','C2vHCMnO','DxbSB2fKvg9tmW','C2XcsMy','y3vZDg9Trg9TywLU'];_0x_0x1378=function(){return _0x3c6e2d;};return _0x_0x1378();}const fs=require('fs'),path=require('path'),s3Service=require('../services/s3Service'),config=require('../config/config'),s3PostUpload=moduleName=>{return async(_0x56b187,_0x310fee,_0x17e64a)=>{function _0x50729b(_0x49dda5,_0x3037d7,_0x40104b,_0x49ace4){return _0x_0x2aa2(_0x40104b- -0x1e5,_0x49ace4);}function _0xf22c96(_0x42d992,_0x2c083b,_0x4e8c81,_0x3ab8f8){return _0x_0x2aa2(_0x42d992-0xaa,_0x4e8c81);}if(!_0x56b187[_0xf22c96(0x1fe,0x20e,0x1e2,0x1f1)]&&!_0x56b187[_0xf22c96(0x208,0x207,0x223,0x20b)])return _0x17e64a();try{if(_0x50729b(-0x4f,-0x69,-0x5c,-0x54)!=='FFIRA'){const _0x44f868=await s3Service[_0x50729b(-0x84,-0x79,-0x84,-0x79)]();console[_0xf22c96(0x212,0x20b,0x202,0x22c)](_0xf22c96(0x22a,0x210,0x217,0x222),_0x44f868);if(!_0x44f868)return'AtzVB'!=='AwNdx'?(console['log']('[S3Upload]\x20S3未启用，使用本地存储'),_0x17e64a()):(console[_0xf22c96(0x212,0x225,0x20c,0x22b)](_0x50729b(-0x7a,-0x71,-0x71,-0x7b)),_0x22bf5b());const _0x3f7a06=_0x56b187['files']||[_0x56b187['file']];for(const _0x5f7580 of _0x3f7a06){if(_0xf22c96(0x22b,0x237,0x21a,0x22f)===_0xf22c96(0x22b,0x21a,0x21e,0x210)){if(!_0x5f7580)continue;const _0xf9b7a4=process[_0xf22c96(0x205,0x1fa,0x1f5,0x1ec)][_0x50729b(-0x84,-0x84,-0x75,-0x76)]||_0x50729b(-0x57,-0x56,-0x61,-0x46);let _0x337189;if(moduleName)_0x337189=_0xf9b7a4+'/'+moduleName+'/'+_0x5f7580[_0x50729b(-0x53,-0x4f,-0x62,-0x52)];else{const _0x1937c7=_0x5f7580['path'][_0xf22c96(0x229,0x239,0x234,0x240)](/\\/g,'/'),_0x50b87a=_0x1937c7[_0x50729b(-0xa3,-0x79,-0x8d,-0x71)](_0xf9b7a4+'/');if(_0x50b87a!==-(0x86*0x2+-0x26bf+0x25b4)){if(_0xf22c96(0x210,0x22c,0x222,0x203)!=='xHqIV')_0x337189=_0x1937c7[_0x50729b(-0x80,-0x77,-0x82,-0x8d)](_0x50b87a);else return _0x33f7f0();}else _0x337189=_0xf9b7a4+'/'+_0x5f7580['filename'];}const _0x130e02=await s3Service[_0xf22c96(0x232,0x24d,0x23d,0x21c)](_0x5f7580[_0xf22c96(0x21f,0x22b,0x22e,0x22c)],_0x337189,_0x5f7580[_0x50729b(-0x64,-0x80,-0x6c,-0x68)]);_0x5f7580[_0x50729b(-0x51,-0x75,-0x6b,-0x52)]=_0x130e02,_0x5f7580[_0xf22c96(0x217,0x204,0x207,0x1fc)]=_0x337189,fs[_0xf22c96(0x218,0x22f,0x21a,0x234)](_0x5f7580[_0xf22c96(0x21f,0x233,0x214,0x230)])&&fs['unlinkSync'](_0x5f7580[_0xf22c96(0x21f,0x230,0x237,0x223)]);}else console['log'](_0xf22c96(0x213,0x200,0x217,0x215),_0x3c1ab9[_0xf22c96(0x200,0x1ee,0x21a,0x201)]);}_0x17e64a();}else{console[_0xf22c96(0x206,0x20c,0x207,0x201)](_0xf22c96(0x211,0x203,0x211,0x200),_0x4b815e);throw _0x1d814d;}}catch(_0x385d41){console[_0xf22c96(0x206,0x212,0x206,0x211)](_0xf22c96(0x228,0x21c,0x211,0x22f),_0x385d41),_0x17e64a();}};},getFileUrl=(_0x20829a,_0x263036)=>{function _0x49f089(_0x5dcbe3,_0x19e28a,_0xb6e364,_0x114a0e){return _0x_0x2aa2(_0x19e28a- -0x318,_0xb6e364);}if(_0x20829a[_0xa02e48(0x546,0x560,0x574,0x554)])return _0x20829a[_0x49f089(-0x1b8,-0x19e,-0x1a2,-0x1a0)];function _0xa02e48(_0x53192d,_0x5a3a02,_0x3dc8c4,_0x4cd66d){return _0x_0x2aa2(_0x5a3a02-0x3e6,_0x3dc8c4);}return config['getFileUrl'](_0x20829a[_0x49f089(-0x19f,-0x195,-0x1a7,-0x17d)],_0x263036);};function _0x_0x2aa2(_0xd07429,_0x3c1ab9){_0xd07429=_0xd07429-(-0x197+0x473+-0x188);const _0x2299fe=_0x_0x1378();let _0x21c536=_0x2299fe[_0xd07429];if(_0x_0x2aa2['pzrskC']===undefined){var _0x4e758c=function(_0x2e2294){const _0x499195='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x368a81='',_0x1a4a7c='',_0x17fd00=_0x368a81+_0x4e758c;for(let _0x7cfdf5=0x201*-0x13+-0x424+0x6b*0x65,_0x1a6195,_0x303993,_0x23db33=-0x1*0xd39+-0x5*-0x257+0x186;_0x303993=_0x2e2294['charAt'](_0x23db33++);~_0x303993&&(_0x1a6195=_0x7cfdf5%(-0x114e+-0x1039+0x218b)?_0x1a6195*(0x2e*-0x53+-0x6ca*0x4+0x1529*0x2)+_0x303993:_0x303993,_0x7cfdf5++%(0x1c07+0x133*-0x1e+0x7f7))?_0x368a81+=_0x17fd00['charCodeAt'](_0x23db33+(-0x11*-0xdb+-0x1947+0xac6))-(-0x349*0x7+0x22a*0x7+0x7e3)!==-0x10ec+0xf69+-0x81*-0x3?String['fromCharCode'](-0x54c+0x382+0x2c9&_0x1a6195>>(-(0x3*-0x817+-0x1a59+0x32a0)*_0x7cfdf5&-0x851*0x2+-0x18eb*0x1+0x2993)):_0x7cfdf5:-0x2*-0x20b+0x951+0xd67*-0x1){_0x303993=_0x499195['indexOf'](_0x303993);}for(let _0x2f0ef5=-0x89c+0x16f9+-0xe5d,_0x56daa1=_0x368a81['length'];_0x2f0ef5<_0x56daa1;_0x2f0ef5++){_0x1a4a7c+='%'+('00'+_0x368a81['charCodeAt'](_0x2f0ef5)['toString'](-0x11dc+0xe5e*-0x1+0x1*0x204a))['slice'](-(-0xfa*0x19+0x1d8*0x13+-0x1*0xa9c));}return decodeURIComponent(_0x1a4a7c);};_0x_0x2aa2['jSyzNa']=_0x4e758c,_0x_0x2aa2['KDsOCv']={},_0x_0x2aa2['pzrskC']=!![];}const _0x2522c2=_0x2299fe[-0x217*0x9+0x269a+-0x13cb],_0x3f191a=_0xd07429+_0x2522c2,_0x3e6806=_0x_0x2aa2['KDsOCv'][_0x3f191a];if(!_0x3e6806){const _0x31ee0f=function(_0x313353){this['wOQcTk']=_0x313353,this['KUroLN']=[0x24a1*-0x1+-0x26b*0x9+0x3a65,-0x11b+0x10f0+-0xfd5,-0x1*0x1dd1+0x449+0x13*0x158],this['SnVXuf']=function(){return'newState';},this['KwWFMh']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['CJeGjn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x31ee0f['prototype']['kYlsEM']=function(){const _0x297022=new RegExp(this['KwWFMh']+this['CJeGjn']),_0x4827ee=_0x297022['test'](this['SnVXuf']['toString']())?--this['KUroLN'][-0x2355+0x9*0x2b6+-0x50*-0x23]:--this['KUroLN'][0x16ca+-0x4b2*0x8+-0x1f*-0x7a];return this['ibIKIA'](_0x4827ee);},_0x31ee0f['prototype']['ibIKIA']=function(_0x6467cd){if(!Boolean(~_0x6467cd))return _0x6467cd;return this['bISlgH'](this['wOQcTk']);},_0x31ee0f['prototype']['bISlgH']=function(_0x2bce23){for(let _0x3587e3=-0xafd+-0x1*0x591+0x108e,_0x4238a5=this['KUroLN']['length'];_0x3587e3<_0x4238a5;_0x3587e3++){this['KUroLN']['push'](Math['round'](Math['random']())),_0x4238a5=this['KUroLN']['length'];}return _0x2bce23(this['KUroLN'][-0x1d*-0x59+-0x1*-0x1ff3+-0x2a08]);},new _0x31ee0f(_0x_0x2aa2)['kYlsEM'](),_0x21c536=_0x_0x2aa2['jSyzNa'](_0x21c536),_0x_0x2aa2['KDsOCv'][_0x3f191a]=_0x21c536;}else _0x21c536=_0x3e6806;return _0x21c536;}function _0x_0x4bad57(_0x26770c,_0x13debf,_0xaa9152,_0x524ed2){return _0x_0x2aa2(_0xaa9152- -0x2be,_0x13debf);}const deleteFile=async _0x3bf505=>{if(!_0x3bf505)return;function _0x5c5eba(_0x13b5dd,_0x325549,_0xf4fe77,_0x2275ba){return _0x_0x2aa2(_0xf4fe77-0x135,_0x325549);}function _0x104bcb(_0x30288e,_0x1279c7,_0x3b9c13,_0x36a50a){return _0x_0x2aa2(_0x30288e-0x305,_0x1279c7);}try{if('XEpHN'==='uMdZv')return _0x1655bf[_0x104bcb(0x47f,0x494,0x47b,0x473)];else{const _0x45638f=await s3Service[_0x5c5eba(0x28d,0x29e,0x296,0x27a)](),_0x5beed6=await s3Service['getS3Config'](),isS3File=_0x5beed6[_0x5c5eba(0x2ca,0x2aa,0x2bf,0x2ad)]&&_0x3bf505[_0x104bcb(0x48a,0x49c,0x477,0x487)](_0x5beed6[_0x104bcb(0x48f,0x49b,0x4a7,0x49d)])||_0x5beed6[_0x104bcb(0x477,0x45f,0x46f,0x48b)]&&_0x3bf505['includes'](_0x5beed6[_0x104bcb(0x45c,0x442,0x444,0x449)]);if(_0x45638f&&isS3File)await s3Service[_0x5c5eba(0x2b0,0x2ab,0x299,0x282)](_0x3bf505);else{const _0x4663bf=config[_0x104bcb(0x482,0x469,0x486,0x47c)](_0x3bf505);if(_0x4663bf&&fs[_0x5c5eba(0x295,0x2b8,0x2a3,0x2b2)](_0x4663bf)){if(_0x104bcb(0x467,0x45c,0x465,0x465)!==_0x104bcb(0x46a,0x482,0x480,0x452))fs['unlinkSync'](_0x4663bf);else{const _0x4183d3=_0x1a9171?function(){function _0x2ea6ca(_0x4479b9,_0x1995b7,_0x1de21b,_0x2a918a){return _0x5c5eba(_0x4479b9-0x1ad,_0x1995b7,_0x1de21b-0x1d6,_0x2a918a-0x1f0);}if(_0xe8b32f){const _0x36994c=_0x5fac38[_0x2ea6ca(0x46a,0x45b,0x476,0x47a)](_0x3b1830,arguments);return _0x49d4ef=null,_0x36994c;}}:function(){};return _0x1d7cdf=![],_0x4183d3;}}}}}catch(_0x151843){if(_0x104bcb(0x471,0x47f,0x488,0x47c)===_0x104bcb(0x471,0x45f,0x472,0x47e)){console[_0x5c5eba(0x288,0x2ad,0x291,0x27f)](_0x104bcb(0x46c,0x481,0x481,0x450),_0x151843);throw _0x151843;}else _0x1e27a1=_0x291483['substring'](_0x5c1ed9);}},smartDeleteFile=async _0x5621e6=>{if(!_0x5621e6)return;const _0x2eed6c=[];try{const _0x1176fc=config[_0x546a5f(0x2f,0x30,0x26,0x2c)](_0x5621e6);_0x1176fc&&fs[_0x546a5f(0x33,0x2f,0x24,0x1d)](_0x1176fc)&&fs[_0x387b70(0x1e8,0x1ef,0x206,0x1dd)](_0x1176fc);}catch(_0x176c96){_0x2eed6c[_0x387b70(0x200,0x208,0x223,0x214)]('本地删除失败:\x20'+_0x176c96[_0x546a5f(0x12,-0x3,0x12,0x5)]);}try{const _0x52e184=await s3Service[_0x387b70(0x1e1,0x1f3,0x1ef,0x208)]();_0x52e184&&await s3Service[_0x546a5f(0x11,0xd,0x2b,0x13)](_0x5621e6);}catch(_0x1fc33a){console[_0x387b70(0x202,0x1fa,0x1eb,0x1e2)](_0x387b70(0x1f2,0x1fb,0x206,0x20b),_0x1fc33a['message']);}function _0x546a5f(_0x47a233,_0x56b732,_0x1d8342,_0x15b75e){return _0x_0x2aa2(_0x15b75e- -0x151,_0x47a233);}function _0x387b70(_0x5ae54a,_0x5b944a,_0x5e02a4,_0xf8527c){return _0x_0x2aa2(_0x5b944a-0x92,_0x5ae54a);}if(_0x2eed6c[_0x546a5f(0x22,0x1c,0x42,0x27)]>-0x237b*0x1+0x763+0x1c18){if(_0x546a5f(0x14,-0xd,0x18,0x8)===_0x387b70(0x1f9,0x1eb,0x202,0x1d7))console['warn'](_0x387b70(0x204,0x1fc,0x214,0x1ea),_0x2eed6c[_0x387b70(0x1f0,0x1e7,0x1d5,0x1cd)](';\x20'));else{const _0x4aa600=_0x532e36[_0x387b70(0x1ee,0x1fd,0x1fc,0x1ff)](_0x1058db,arguments);return _0x1b0863=null,_0x4aa600;}}};module[_0x_0x4bad57(-0x13e,-0x146,-0x13c,-0x141)]={'s3PostUpload':s3PostUpload,'getFileUrl':getFileUrl,'deleteFile':deleteFile,'smartDeleteFile':smartDeleteFile};