(function(_0x2d10f0,_0x461142){function _0x5585ae(_0x3fe821,_0x5c1f48,_0x2d416e,_0x5b9d7d){return _0x_0x2ed1(_0x2d416e-0x19c,_0x5c1f48);}function _0x589b21(_0x5b13e5,_0x4e5ecf,_0x8a46e5,_0x375257){return _0x_0x2ed1(_0x375257- -0x166,_0x5b13e5);}const _0x12adee=_0x2d10f0();while(!![]){try{const _0x57f31a=-parseInt(_0x5585ae(0x2ed,0x2d3,0x2e1,0x30a))/(0x114e+-0xa08+0x745*-0x1)*(-parseInt(_0x589b21(-0x46,-0x89,-0x7e,-0x67))/(0x11*0x19c+-0x2*0xf43+-0x74*-0x7))+parseInt(_0x589b21(-0x41,-0x4,-0x2d,-0x2d))/(-0x1*0xad8+-0x38+0xb13)+parseInt(_0x589b21(-0x22,-0x54,-0x2b,-0x38))/(-0x15bc+0x135*-0x1+0x16f5)*(parseInt(_0x5585ae(0x2b7,0x26a,0x29d,0x2aa))/(-0x4a7+-0x3b8+0x166*0x6))+parseInt(_0x5585ae(0x2ca,0x2b3,0x299,0x270))/(0x133*-0x17+0x7d4+0x13c7)*(-parseInt(_0x589b21(-0xc,-0x30,-0x3b,-0x27))/(-0x11e2+0x2a*0x4f+0x4f3))+parseInt(_0x589b21(0x2,-0x28,-0x2d,-0x25))/(-0x1*0x97+0x175a+0x1*-0x16bb)*(parseInt(_0x5585ae(0x261,0x29f,0x27d,0x27c))/(-0x133d+0x1*-0x131b+0x2661))+parseInt(_0x5585ae(0x2e9,0x297,0x2c0,0x2a8))/(-0x1e40+0x12ae*0x2+-0x5*0x16a)+-parseInt(_0x589b21(-0x3e,-0x61,-0x4b,-0x64))/(0x1933+0xd*0xe3+-0x1*0x24af);if(_0x57f31a===_0x461142)break;else _0x12adee['push'](_0x12adee['shift']());}catch(_0x5297a8){_0x12adee['push'](_0x12adee['shift']());}}}(_0x_0x23ab,0xdc89+-0x401b4+-0x1*-0x6cfa7));function _0x_0x23ab(){const _0x436582=['6k6/6zEU6k6W5B2v5OIq5yQF','ntrduKL5yxm','tufy','nLvVC1zxqW','Dg9ju09tDhjPBMC','odmXmdm1Cw9SsLPi','oduZotiXmK9Syuzmyq','z2v0svbsyw5RAw5N','DvbUBfO','zeX3zxK','C3fSAxrL','rK1eAxe','zhPnCNK','C2vYDMLJzxm','C29JAwfSlwzLzwq','D2vLAW','zw52','Dw5YzwfK','lI4VlI4VlI4Vzg9JCW','y291BNq','y3jLyxrLzf9HDa','z2v0vMLZAxruCMvUzhm','z2v0rgfZAgjVyxjKt3zLCNzPzxC','BwLU','Ag91CG','u1vn','zM9YrwfJAa','DgHLBG','weXYzLa','uxvLCNLuExbLCW','C3bSAxq','6i635y+w6k6/6zEU6lAl5yQ/5AsX6lsLoG','wejquhu','q09vtLq','zw5KC1DPDgG','DMLZAxrFy291BNq','lM1K','z2v0','zMLUze9Uzq','Dg90ywXFDMLZAxrZ','mJmWnZC5mhDJu1vqtW','BwfW','5RIf55cg6k6/6zEU5PwW5O2U5AsX6lsLoG','z2v0rgLHBgvJDa','yM9KEq','y2f0y2G','BwvZC2fNzxm','u0vmrunu','y29UC3rYDwn0B3i','Dg9tDhjPBMC','og51B1b1vW','CxvLCNK','reLtveLoq1q','ChvZAa','BgvUz3rO','C3rHDhvZ','z3rL','yxbWBhK','6i635y+w6k6/6zEU6lAl5yQ/5AsX6lsL','zgf5','lI4VlI4VlI4VzNjVBNrLBMqVChvIBgLJl21HCMTKB3DU','mta2ndu0mw1KDLzVCa','y2XLyxjwAxnPDerHDge','6i635y+w5lUQ6kgO55Uy5QAc6kEi5AsX6lsLoG','CMvJB3jKvMLZAxq','Bwf4','q0ftvcHZDhjMDgLTzsGNjuGNlcbJCMvHDgvKx2f0ksbbuYbjtLrfr0vskq','mJaWmJm1yLvdEu55','q0ftrsbxsevoihn0yxr1CYa9icDWzw5KAw5NjYbusevoideGruXtrsaWievora','mJq4CgP4seP2','EM1wrgy','BM90zxm','Dw5PCxvLx2LWCW','ndyZotLLsvfVrfK','y3jLyxrL','wKLnz0m','uMvMzxjLCG','AM9PBG','nJi5mJHjuhP0s3y','6k6/6zEU5PwW5O2U5RIf55cg5OIq5yQF','zMXVB3i','6i635y+w5lUQ6kgO55Uy5QAc6kEi5AsX6lsL','6i635y+wsvdMJPlOOyZLPlhOTku6','s2PMDKG','zMLSDgvY','AxbFywrKCMvZCW','CMvHzgrPCG','kcGOlISPkYKRksSK','zxjYB3i','CgfNzv90ExbL','zgvZDhjVEq','DMLZAxrFzgf0zq','qvnd','ywXS','z2v0tw9KDwXLu3rHDhm','BMf2AwDHDgLVBG','zMLUzefSBa','C2v0rgf0zq','ANnVBG','EKDyrwS','zg9JCW','z2v0rgf0zq','6i635y+wsvdMJPlOOyZLPlhOTku','C2vHCMnO','zMLUza'];_0x_0x23ab=function(){return _0x436582;};return _0x_0x23ab();}function _0x_0x2ed1(_0x4da743,_0x46630c){_0x4da743=_0x4da743-(0x1a74+0x1*0x143d+-0x2dd4);const _0x5a03e1=_0x_0x23ab();let _0x54e72e=_0x5a03e1[_0x4da743];if(_0x_0x2ed1['HtPjRO']===undefined){var _0x8ffcde=function(_0x522dac){const _0x544b1f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1ac2cb='',_0x36c762='',_0x25c21a=_0x1ac2cb+_0x8ffcde;for(let _0x215ce1=-0xb7+0x13b6*-0x1+0x146d,_0x22e745,_0x4b7c64,_0x2c19f8=0xd9e+0x337*0x2+-0x140c*0x1;_0x4b7c64=_0x522dac['charAt'](_0x2c19f8++);~_0x4b7c64&&(_0x22e745=_0x215ce1%(0x117e+-0x938+-0x842)?_0x22e745*(0x7*-0x55b+-0x1a89+0x4046)+_0x4b7c64:_0x4b7c64,_0x215ce1++%(-0x8*0x49f+0xb88+0x1974))?_0x1ac2cb+=_0x25c21a['charCodeAt'](_0x2c19f8+(0x1a8e+-0xbd5*0x1+-0xeaf))-(0x453+0x12d7+-0x1720)!==-0x16*-0x61+-0x971*-0x1+-0x11c7?String['fromCharCode'](0x1a37+-0xeca+-0xa6e&_0x22e745>>(-(-0x1d2*-0x7+-0x833*0x1+-0x489)*_0x215ce1&0x1*0x1997+-0x9ea+-0xfa7*0x1)):_0x215ce1:-0x9*-0xff+-0x179d+-0x32*-0x4b){_0x4b7c64=_0x544b1f['indexOf'](_0x4b7c64);}for(let _0x342ec0=0x1c0*0x12+0x207a*0x1+-0x3ffa,_0x57b71e=_0x1ac2cb['length'];_0x342ec0<_0x57b71e;_0x342ec0++){_0x36c762+='%'+('00'+_0x1ac2cb['charCodeAt'](_0x342ec0)['toString'](-0x3ec*-0x3+0x12f9+-0x1ead))['slice'](-(-0x1310+-0xc70+-0x6d*-0x4a));}return decodeURIComponent(_0x36c762);};_0x_0x2ed1['tcEQGp']=_0x8ffcde,_0x_0x2ed1['sgCbQA']={},_0x_0x2ed1['HtPjRO']=!![];}const _0x16feb3=_0x5a03e1[-0x95e+0x630+0xb*0x4a],_0xa1cfae=_0x4da743+_0x16feb3,_0x2dc63c=_0x_0x2ed1['sgCbQA'][_0xa1cfae];if(!_0x2dc63c){const _0x57de66=function(_0x2aebd1){this['cFUnaR']=_0x2aebd1,this['IiYVGH']=[0x1aa*-0x1+-0x371*0x9+-0x2*-0x1052,0x5*-0x679+-0x2c*0xd1+0x1*0x4449,-0x67d*-0x1+0x86*-0x3+-0x4eb],this['NJDhAy']=function(){return'newState';},this['UhnPhT']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['bhZUNA']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x57de66['prototype']['GUFeKZ']=function(){const _0x1bdc86=new RegExp(this['UhnPhT']+this['bhZUNA']),_0x3d72b0=_0x1bdc86['test'](this['NJDhAy']['toString']())?--this['IiYVGH'][0x1007*0x1+-0x242c+0x1426]:--this['IiYVGH'][-0x1afd+0x850+0x7*0x2ab];return this['yLIZzu'](_0x3d72b0);},_0x57de66['prototype']['yLIZzu']=function(_0x45923c){if(!Boolean(~_0x45923c))return _0x45923c;return this['Zvshks'](this['cFUnaR']);},_0x57de66['prototype']['Zvshks']=function(_0x762660){for(let _0x423feb=0xf69+-0x2*-0x28d+0x1*-0x1483,_0x121472=this['IiYVGH']['length'];_0x423feb<_0x121472;_0x423feb++){this['IiYVGH']['push'](Math['round'](Math['random']())),_0x121472=this['IiYVGH']['length'];}return _0x762660(this['IiYVGH'][-0x8b4*-0x2+-0x1945+0x7dd]);},new _0x57de66(_0x_0x2ed1)['GUFeKZ'](),_0x54e72e=_0x_0x2ed1['tcEQGp'](_0x54e72e),_0x_0x2ed1['sgCbQA'][_0xa1cfae]=_0x54e72e;}else _0x54e72e=_0x2dc63c;return _0x54e72e;}const _0x_0x33658e=(function(){let _0x4c3bf9=!![];return function(_0x522246,_0x1e2737){const _0xcd47bf=_0x4c3bf9?function(){function _0x1817d1(_0x2dc42a,_0x65cfbf,_0x560706,_0x28a6f){return _0x_0x2ed1(_0x2dc42a- -0x379,_0x560706);}if(_0x1e2737){const _0x36f96a=_0x1e2737[_0x1817d1(-0x244,-0x236,-0x21c,-0x250)](_0x522246,arguments);return _0x1e2737=null,_0x36f96a;}}:function(){};return _0x4c3bf9=![],_0xcd47bf;};}()),_0x_0x311088=_0x_0x33658e(this,function(){function _0x2bfb0f(_0x5d9e10,_0x347e18,_0x43f85c,_0x208364){return _0x_0x2ed1(_0x347e18-0xd3,_0x5d9e10);}function _0x59732b(_0x339b67,_0x285da0,_0x5c4013,_0x22eaff){return _0x_0x2ed1(_0x285da0- -0x100,_0x22eaff);}return _0x_0x311088[_0x2bfb0f(0x208,0x200,0x213,0x1e5)]()[_0x2bfb0f(0x19e,0x1cd,0x1db,0x1cd)]('(((.+)+)+)+$')[_0x2bfb0f(0x1dc,0x200,0x1ef,0x1ee)]()[_0x59732b(-0x6,0x2c,-0x4,0x22)](_0x_0x311088)['search'](_0x2bfb0f(0x1be,0x1bd,0x1e5,0x1c0));});function _0x_0x4fee4f(_0x1d581f,_0x478909,_0x328a51,_0x32400c){return _0x_0x2ed1(_0x1d581f- -0x23c,_0x32400c);}_0x_0x311088();const {Op,fn,col,literal}=require('sequelize'),{sequelize}=require('../config/database'),PageVisit=require('../models/PageVisit'),Note=require('../models/Note'),Site=require('../models/Site'),StickyNote=require('../models/StickyNote'),Todo=require('../models/Todo'),Message=require('../models/Message'),Gallery=require('../models/Gallery'),Service=require('../models/Service'),{getClientIP}=require('../utils/ipHelper'),fs=require('fs').promises,path=require('path'),PAGE_TYPES={'home':'首页','social-feed':'动态','notes':'笔记','navigation':'导航','galleries':'图库','services':'服务','messages':'留言','docs':'文档'};exports[_0x_0x10c630(-0xa,-0x12,0x18,-0x27)]=async(_0x5cb46f,_0x327480)=>{function _0x295fe2(_0x2ae657,_0x198e5a,_0x1bdd4c,_0x320102){return _0x_0x10c630(_0x198e5a- -0xbd,_0x198e5a-0x1c0,_0x320102,_0x320102-0x5a);}function _0x2781ac(_0x272173,_0x19aa9c,_0x1e885b,_0x1b6a23){return _0x_0x10c630(_0x272173-0x47c,_0x19aa9c-0x1f1,_0x19aa9c,_0x1b6a23-0x78);}try{const {page_type:_0x230bc6,page_path:_0x11029b}=_0x5cb46f[_0x295fe2(-0xd8,-0xdb,-0xb1,-0xe3)],_0x1fac71=getClientIP(_0x5cb46f),_0x382338=_0x5cb46f[_0x295fe2(-0xe5,-0xe2,-0xf0,-0xd9)]('User-Agent'),_0xc27c=_0x5cb46f[_0x2781ac(0x457,0x471,0x435,0x484)](_0x2781ac(0x415,0x3ec,0x42d,0x421));if(!_0x230bc6||!PAGE_TYPES[_0x230bc6])return _0x327480[_0x2781ac(0x469,0x498,0x490,0x465)](-0x2f*0xcf+0x1*0x21b2+0x5df)[_0x295fe2(-0xe2,-0x10e,-0x12a,-0xf6)]({'success':![],'message':'无效的页面类型'});const _0x4aa92e=new Date()['toISOString']()['split']('T')[-0x2102+-0xcec*-0x2+-0x83*-0xe];await PageVisit[_0x295fe2(-0xfc,-0x126,-0x10c,-0x158)]({'page_type':_0x230bc6,'page_path':_0x11029b,'ip_address':_0x1fac71,'user_agent':_0x382338,'referer':_0xc27c,'visit_date':_0x4aa92e}),_0x327480['json']({'success':!![],'message':_0x295fe2(-0xd3,-0x107,-0x116,-0x119)});}catch(_0x4fa28f){if(_0x295fe2(-0x12e,-0x11d,-0xeb,-0x11e)===_0x2781ac(0x478,0x47f,0x475,0x49a)){const _0x58938e=new _0x8b0aed(_0x434007);_0x58938e[_0x2781ac(0x42a,0x41a,0x452,0x450)](_0x58938e[_0x295fe2(-0x114,-0x10b,-0x109,-0x11b)]()+_0x389cb3);const _0x5e9df8=_0x58938e['toISOString']()['split']('T')[-0x932+-0x3*0x8d1+0x5*0x721],_0xb9aa76=_0x54eb66['find'](_0x57b495=>_0x57b495['visit_date']===_0x5e9df8);_0x5e51cb['push']({'date':_0x5e9df8,'visit_count':_0xb9aa76?_0x2025c2(_0xb9aa76[_0x295fe2(-0xba,-0xe4,-0x111,-0xd1)]):-0x1aba+0x6d1+0x13e9,'unique_ips':_0xb9aa76?_0x18b74b(_0xb9aa76[_0x2781ac(0x47a,0x45f,0x485,0x495)]):0x1*0x7e7+-0x266b+0x45c*0x7});}else console[_0x295fe2(-0x10a,-0x118,-0x103,-0x149)]('记录访问失败:',_0x4fa28f),_0x327480[_0x295fe2(-0xa5,-0xd0,-0xb9,-0xb1)](-0x26da+-0x68+0x2936*0x1)[_0x295fe2(-0xef,-0x10e,-0xe4,-0xe8)]({'success':![],'message':'记录访问失败'});}},exports[_0x_0x10c630(-0x35,-0x58,-0x9,-0x2f)]=async(_0x12f544,_0x3974b1)=>{function _0x5e4d14(_0x2443da,_0x294049,_0x52b4f7,_0x25181a){return _0x_0x4fee4f(_0x2443da-0x13b,_0x294049-0x1ae,_0x52b4f7-0xc9,_0x294049);}function _0x2831e2(_0x4d185a,_0x5567c4,_0x3235fe,_0x440901){return _0x_0x4fee4f(_0x440901- -0x165,_0x5567c4-0x195,_0x3235fe-0xd0,_0x5567c4);}try{const {period:period='day',page_type:_0x4bda4b}=_0x12f544['query'],_0x4d85d5=new Date(),_0x1ea1de=_0x4d85d5[_0x2831e2(-0x2d3,-0x27d,-0x2a8,-0x2a1)]()[_0x2831e2(-0x265,-0x26b,-0x263,-0x287)]('T')[0x118f+0xec9+-0x2058],_0x42b382={};_0x4bda4b&&PAGE_TYPES[_0x4bda4b]&&(_0x42b382[_0x2831e2(-0x2b6,-0x2a8,-0x2b0,-0x2b5)]=_0x4bda4b);if(period===_0x5e4d14(0x36,0x65,0x40,0x5a)){if(_0x2831e2(-0x2c7,-0x299,-0x2b8,-0x2c3)!==_0x2831e2(-0x2b5,-0x2c2,-0x2b9,-0x2c3))_0x476446=_0x2a5e0a(_0x2831e2(-0x292,-0x246,-0x251,-0x263));else{const _0x472529={..._0x42b382,'visit_date':_0x1ea1de},_0x56864a=sequelize[_0x2831e2(-0x28b,-0x24f,-0x288,-0x27a)]();let _0x3865c5;_0x56864a===_0x2831e2(-0x2b2,-0x287,-0x27f,-0x29b)?_0x3865c5=literal(_0x5e4d14(0x3d,0xd,0x3e,0x1e)):_0x3865c5=fn('HOUR',col(_0x2831e2(-0x2ab,-0x26b,-0x261,-0x291)));const _0x2fef81=await PageVisit[_0x5e4d14(-0xe,0x13,-0x3e,0x12)]({'attributes':[[_0x3865c5,'hour'],[fn(_0x2831e2(-0x299,-0x284,-0x266,-0x284),col('id')),_0x2831e2(-0x257,-0x27d,-0x2b5,-0x282)],[fn('COUNT',fn(_0x5e4d14(0x2f,0x55,0x1d,-0x1),col(_0x2831e2(-0x2e7,-0x2a8,-0x2a4,-0x2b9)))),_0x2831e2(-0x246,-0x264,-0x274,-0x25d)]],'where':_0x472529,'group':[_0x3865c5],'order':[[_0x3865c5,_0x2831e2(-0x2bd,-0x29f,-0x2b3,-0x2b2)]],'raw':!![]}),_0x4ab705={};_0x2fef81[_0x5e4d14(0x15,0x13,0x48,0x15)](_0x547068=>{const _0x2885a9=parseInt(_0x547068[_0x3cc762(0x448,0x481,0x47d,0x482)]),_0x472edf=Math[_0x3cc762(0x44a,0x45a,0x44c,0x43a)](_0x2885a9/(-0x1366+-0x10*0xbf+-0x4b*-0x6b))*(-0x11*-0x61+-0x17bf+0x1151);!_0x4ab705[_0x472edf]&&(_0x4ab705[_0x472edf]={'visit_count':0x0,'unique_ips':0x0});_0x4ab705[_0x472edf]['visit_count']+=parseInt(_0x547068[_0x3cc762(0x471,0x465,0x488,0x489)])||-0x20af+0x1a4b+0x664;function _0x3cc762(_0x11feef,_0x4ae3c1,_0x258e6a,_0x43c2a0){return _0x5e4d14(_0x258e6a-0x46a,_0x43c2a0,_0x258e6a-0xce,_0x43c2a0-0xe);}function _0x48bb40(_0x63d7c8,_0x2eac91,_0x23612e,_0x1583ce){return _0x5e4d14(_0x23612e-0x202,_0x2eac91,_0x23612e-0xb,_0x1583ce-0x89);}_0x4ab705[_0x472edf]['unique_ips']+=parseInt(_0x547068['unique_ips'])||0x92d+0x2193+-0x2ac0;});const _0x1dab29=[];for(let _0x238168=0x1f10+-0xc01*0x1+-0x130f;_0x238168<0x1574+0x5*0x636+0x1a35*-0x2;_0x238168+=-0x1b*-0x87+0x2669+0xaf*-0x4d){_0x5e4d14(0x7,0x1b,0x1e,0x3a)!==_0x2831e2(-0x2a7,-0x2ca,-0x290,-0x299)?(console[_0x2831e2(-0x2a0,-0x2c1,-0x286,-0x2b6)]('获取访问趋势失败:',_0x427ebf),_0x35eab4[_0x5e4d14(0x32,0x2,0x12,0x4c)](0x2121+0x1*-0x14fe+-0xa2f)[_0x5e4d14(-0xc,0x3,-0x2a,-0x40)]({'success':![],'message':_0x2831e2(-0x290,-0x2a0,-0x27d,-0x26b)})):_0x1dab29[_0x2831e2(-0x296,-0x283,-0x2a1,-0x270)]({'date':_0x1ea1de,'hour':_0x238168,'visit_count':_0x4ab705[_0x238168]?.[_0x2831e2(-0x2a7,-0x24f,-0x29e,-0x282)]||0xecb+-0x6aa+-0x821,'unique_ips':_0x4ab705[_0x238168]?.[_0x2831e2(-0x242,-0x261,-0x264,-0x25d)]||0x1*0x234a+0x67f*0x4+-0x2c9*0x16});}return _0x3974b1[_0x2831e2(-0x2cd,-0x2e1,-0x2c2,-0x2ac)]({'success':!![],'data':{'period':period,'page_type':_0x4bda4b||_0x2831e2(-0x2bb,-0x28a,-0x2bf,-0x2b1),'trends':_0x1dab29}});}}let _0xe42890;switch(period){case _0x5e4d14(0xa,-0x7,-0x28,0x9):_0xe42890=-0x1214+-0x1d3c+-0x1*-0x2f57;break;case'month':_0xe42890=-0x1a5d+0x544+0x1537;break;default:_0xe42890=-0x1*0xcc7+-0x4f5+0x1*0x11c3;}const _0x23b9b6=new Date(_0x4d85d5);_0x23b9b6[_0x5e4d14(-0xd,-0xe,-0x2b,-0x2a)](_0x23b9b6[_0x2831e2(-0x283,-0x2a3,-0x275,-0x2a9)]()-_0xe42890+(0xb5*-0x35+0x676+0x1f04));const _0xcd5a3d=_0x23b9b6[_0x2831e2(-0x26d,-0x2b9,-0x286,-0x2a1)]()[_0x2831e2(-0x2b1,-0x285,-0x27b,-0x287)]('T')[0x19d+0xfaf+-0x114c],_0x2f03c1={..._0x42b382,'visit_date':{[Op[_0x5e4d14(0x33,0x34,0x36,-0x2)]]:_0xcd5a3d}},_0x5c14f1=await PageVisit[_0x5e4d14(-0xe,-0x3a,0x6,-0x42)]({'attributes':[_0x2831e2(-0x2a5,-0x2b9,-0x291,-0x2b3),[fn('COUNT',col('id')),_0x5e4d14(0x1e,-0x5,0x13,0x12)],[fn(_0x5e4d14(0x1c,0x41,0x4,0x30),fn('DISTINCT',col(_0x2831e2(-0x28f,-0x2d4,-0x2ed,-0x2b9)))),_0x5e4d14(0x43,0x28,0x2b,0x6b)]],'where':_0x2f03c1,'group':['visit_date'],'order':[[_0x2831e2(-0x2a5,-0x2b0,-0x2bb,-0x2b3),_0x2831e2(-0x27d,-0x29f,-0x2db,-0x2b2)]],'raw':!![]}),_0x464fa2=[];for(let _0x411cfb=0x1eb5+0x212e+0x5*-0xcc7;_0x411cfb<_0xe42890;_0x411cfb++){const _0x1cddea=new Date(_0x23b9b6);_0x1cddea[_0x2831e2(-0x283,-0x27d,-0x29a,-0x2ad)](_0x1cddea[_0x5e4d14(-0x9,-0x30,-0x14,0x10)]()+_0x411cfb);const _0x2eed48=_0x1cddea[_0x2831e2(-0x2a6,-0x294,-0x2c9,-0x2a1)]()[_0x5e4d14(0x19,0x3e,0xd,-0x2)]('T')[-0x26b3*0x1+0x1*-0x19c9+-0x203e*-0x2],_0x279df8=_0x5c14f1[_0x2831e2(-0x29b,-0x2c4,-0x27f,-0x2a6)](_0x528916=>_0x528916[_0x5e4d14(-0x13,-0x1,-0x7,-0x29)]===_0x2eed48);_0x464fa2[_0x2831e2(-0x287,-0x254,-0x28a,-0x270)]({'date':_0x2eed48,'visit_count':_0x279df8?parseInt(_0x279df8[_0x5e4d14(0x1e,0x1f,0x45,-0x14)]):0x194d+-0x18f5*0x1+-0x58,'unique_ips':_0x279df8?parseInt(_0x279df8[_0x2831e2(-0x23b,-0x24c,-0x242,-0x25d)]):0xec5+-0xa*0x3be+-0x16a7*-0x1});}_0x3974b1['json']({'success':!![],'data':{'period':period,'page_type':_0x4bda4b||_0x5e4d14(-0x11,-0x42,0x1c,-0x17),'trends':_0x464fa2}});}catch(_0x25d778){console[_0x5e4d14(-0x16,-0x3d,-0x37,-0x10)](_0x2831e2(-0x26e,-0x273,-0x2ab,-0x286),_0x25d778),_0x3974b1[_0x2831e2(-0x253,-0x28d,-0x250,-0x26e)](-0x169e+-0x84a+0x20dc)[_0x5e4d14(-0xc,-0x32,0xe,0x28)]({'success':![],'message':_0x5e4d14(0x35,0x1,0x3,0x4a)});}},exports[_0x_0x4fee4f(-0x14b,-0x166,-0x16f,-0x11b)]=async(_0x5b8797,_0x3d7f37)=>{function _0x15bbac(_0x542a4f,_0x48f4d4,_0x21b5b5,_0x1fb822){return _0x_0x10c630(_0x1fb822- -0x1e9,_0x48f4d4-0xcd,_0x48f4d4,_0x1fb822-0x16d);}function _0x5f414e(_0x1c99a6,_0x4f9c8d,_0x79121a,_0x1d5909){return _0x_0x10c630(_0x1c99a6-0x464,_0x4f9c8d-0x9a,_0x79121a,_0x1d5909-0x2a);}try{const _0x2816b7=new Date()['toISOString']()[_0x15bbac(-0x202,-0x229,-0x224,-0x215)]('T')[0xa9f+0x22b4*-0x1+0x1815],[_0x3af278,_0xa677e6,_0x21e38b,_0x5251d2,_0x36110a,_0x5d80a3,_0x43692b,_0x9a0123,_0x485456,_0x2f0648]=await Promise[_0x15bbac(-0x245,-0x23a,-0x243,-0x23f)]([sequelize[_0x15bbac(-0x204,-0x22d,-0x22b,-0x200)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20social_feed_posts\x20WHERE\x20status\x20=\x20\x27published\x27',{'type':sequelize[_0x15bbac(-0x1e3,-0x221,-0x1f9,-0x216)][_0x15bbac(-0x208,-0x236,-0x210,-0x204)]})['then'](_0x22021f=>_0x22021f[0x1b86+-0x146*-0x13+-0x33b8]?.[_0x15bbac(-0x23d,-0x20d,-0x233,-0x220)]||-0x75b+0x1*0x104d+-0x8f2)[_0x5f414e(0x447,0x448,0x443,0x42f)](()=>0x5d2+0x5c5+-0xb97),Note[_0x15bbac(-0x221,-0x22a,-0x20d,-0x220)]({'where':{'is_published':!![]}}),StickyNote['count'](),Site['count']({'where':{'is_visible':!![]}}),Gallery['count']({'where':{'is_visible':!![]}}),Service[_0x5f414e(0x42d,0x42c,0x45e,0x45a)]({'where':{'is_visible':!![]}}),Todo[_0x5f414e(0x42d,0x3fa,0x423,0x450)](),Message[_0x5f414e(0x411,0x41f,0x407,0x429)]({'attributes':[[fn('COUNT',col('id')),'total'],[fn(_0x5f414e(0x433,0x450,0x3ff,0x455),literal(_0x5f414e(0x45e,0x471,0x442,0x43f))),_0x5f414e(0x42b,0x3fe,0x415,0x451)]],'raw':!![]})[_0x5f414e(0x435,0x460,0x428,0x419)](_0x5b225e=>({'total':parseInt(_0x5b225e[0x59*-0x3b+-0x217b+-0x2*-0x1aff]?.['total'])||-0x1*0x1d44+-0xd74*0x1+0x2ab8,'unread':parseInt(_0x5b225e[0xa*-0x59+0x19*-0x113+0x1e55]?.['unread'])||-0x58*0x42+0x839*-0x2+0x2722})),countDocsFiles(),PageVisit['findAll']({'attributes':['page_type',[fn(_0x15bbac(-0x212,-0x1de,-0x218,-0x212),fn(_0x5f414e(0x44e,0x46d,0x457,0x47d),col('ip_address'))),'unique_ips']],'group':[_0x5f414e(0x40a,0x439,0x3dc,0x43b)],'raw':!![]})]),_0x55ea3f={};_0x2f0648[_0x15bbac(-0x21a,-0x208,-0x1e5,-0x219)](_0x3ed281=>{function _0x548fd8(_0x1dbc24,_0x1e7941,_0x82a84c,_0x5a24c6){return _0x15bbac(_0x1dbc24-0x104,_0x1dbc24,_0x82a84c-0x1f0,_0x5a24c6-0x46a);}function _0x31e57b(_0x2cb9c2,_0x1efec1,_0x10b396,_0x256d9f){return _0x15bbac(_0x2cb9c2-0x114,_0x2cb9c2,_0x10b396-0x29,_0x1efec1-0x3fd);}_0x55ea3f[_0x3ed281[_0x31e57b(0x1e3,0x1ba,0x1b0,0x1a6)]]=parseInt(_0x3ed281[_0x548fd8(0x28d,0x24d,0x271,0x27f)])||0x18+-0x2477+0x245f;});const _0x55d082={'socialFeed':{'count':parseInt(_0x3af278),'visits':_0x55ea3f[_0x5f414e(0x428,0x45a,0x418,0x3fb)]||-0x1*0x18d9+0x17b0+-0x129*-0x1,'label':'动态'},'notes':{'count':_0xa677e6,'visits':_0x55ea3f[_0x15bbac(-0x1f5,-0x211,-0x1f8,-0x1ec)]||-0x2097+0x31*-0x9d+0x3ea4,'label':'笔记'},'stickyNotes':{'count':_0x21e38b,'visits':0x0,'label':'便签'},'navigation':{'count':_0x5251d2,'visits':_0x55ea3f[_0x5f414e(0x410,0x41c,0x40e,0x428)]||-0x171f+0x2*-0x4b7+0x208d,'label':'导航'},'galleries':{'count':_0x36110a,'visits':_0x55ea3f['galleries']||-0x269b*-0x1+0xc7*0x1d+-0x3d26,'label':'图库'},'services':{'count':_0x5d80a3,'visits':_0x55ea3f[_0x15bbac(-0x1f7,-0x248,-0x240,-0x226)]||0x14*-0x178+-0xe83+0x2be3,'label':'服务'},'todos':{'count':_0x43692b,'visits':0x0,'label':'待办'},'messages':{'count':_0x9a0123['total'],'unread':_0x9a0123[_0x5f414e(0x42b,0x433,0x42f,0x422)],'visits':_0x55ea3f[_0x15bbac(-0x1f9,-0x21d,-0x220,-0x205)]||0x2093*0x1+-0x9*-0x3a1+-0x413c,'label':'留言'},'docs':{'count':_0x485456,'visits':_0x55ea3f[_0x15bbac(-0x237,-0x257,-0x22c,-0x238)]||0x1619*0x1+0x2074+-0x368d,'label':'文档'}};_0x3d7f37[_0x5f414e(0x413,0x43a,0x3eb,0x434)]({'success':!![],'data':_0x55d082});}catch(_0x29b8d4){_0x5f414e(0x436,0x421,0x463,0x454)===_0x15bbac(-0x231,-0x210,-0x21a,-0x228)?_0x37c362[_0x44ee6c[_0x5f414e(0x40a,0x43e,0x3d5,0x427)]]=_0x10d8d8(_0x557847[_0x15bbac(-0x1db,-0x1fc,-0x1f5,-0x1eb)])||0x3*0xc1b+-0x9b8+-0xb*0x26b:(console[_0x15bbac(-0x278,-0x232,-0x22a,-0x244)]('获取模块统计失败:',_0x29b8d4),_0x3d7f37[_0x5f414e(0x451,0x466,0x420,0x44c)](-0x259b+-0x662+0x2df1*0x1)['json']({'success':![],'message':'获取模块统计失败'}));}};function _0x_0x10c630(_0x1e3c6f,_0x5024d7,_0x387e2f,_0x4a2abb){return _0x_0x2ed1(_0x1e3c6f- -0x146,_0x387e2f);}exports[_0x_0x4fee4f(-0x139,-0x137,-0x152,-0x117)]=async(_0x4a9d29,_0x326762)=>{function _0x2c0057(_0x12c16c,_0xa4f06e,_0x2231b5,_0x161790){return _0x_0x4fee4f(_0xa4f06e- -0x1a4,_0xa4f06e-0xde,_0x2231b5-0x16d,_0x2231b5);}function _0x4472ba(_0x5a041a,_0x3bfd9f,_0x1724d6,_0x17fa83){return _0x_0x10c630(_0x17fa83- -0xec,_0x3bfd9f-0x139,_0x5a041a,_0x17fa83-0x101);}try{const {limit:limit=0xf4a+0x2*0xd03+-0x2946,days:days=0x2229+-0x4*-0x49+-0x2346}=_0x4a9d29[_0x2c0057(-0x298,-0x2b1,-0x29e,-0x2ca)],_0x432af5=Math[_0x2c0057(-0x2d9,-0x2cd,-0x2bb,-0x2e7)](Math['max'](parseInt(limit),0x12f+0x1a6a+-0x1b94),0x8e*0x1d+0xbce+-0x1bd0),_0x1f5c17=Math['min'](Math[_0x2c0057(-0x2d8,-0x2a3,-0x2d3,-0x293)](parseInt(days),0x10c1+-0x1*0x2127+0x1067),0x112f+-0xc74+-0x49d),_0x1147d5=new Date();_0x1147d5[_0x2c0057(-0x2d9,-0x2ec,-0x2d2,-0x2f5)](_0x1147d5[_0x2c0057(-0x30e,-0x2e8,-0x2c6,-0x30c)]()-_0x1f5c17);const _0x16b343=_0x1147d5[_0x2c0057(-0x2de,-0x2e0,-0x2ee,-0x311)]()[_0x4472ba(-0x13f,-0x145,-0xea,-0x118)]('T')[-0x3a0+0x28*0x3b+-0x8*0xb3],_0x539c6c=await PageVisit[_0x2c0057(-0x30c,-0x2ed,-0x2ef,-0x321)]({'attributes':[_0x4472ba(-0x175,-0x15f,-0x15c,-0x14a),[fn(_0x4472ba(-0x12f,-0x130,-0x125,-0x115),col('id')),_0x4472ba(-0x101,-0x123,-0x143,-0x113)],[fn(_0x2c0057(-0x2fb,-0x2e2,-0x311,-0x2fb),col(_0x4472ba(-0x114,-0x12e,-0x10c,-0x122))),'last_visit']],'where':{'visit_date':{[Op[_0x2c0057(-0x27f,-0x2ac,-0x2ae,-0x2a0)]]:_0x16b343}},'group':[_0x4472ba(-0x12b,-0x13d,-0x134,-0x14a)],'order':[[fn('COUNT',col('id')),'DESC']],'limit':_0x432af5,'raw':!![]}),_0x44adf6=await PageVisit[_0x2c0057(-0x309,-0x2ed,-0x2f5,-0x2e0)]({'attributes':[_0x4472ba(-0x14b,-0x12e,-0x139,-0x144),[fn(_0x4472ba(-0x12c,-0x11f,-0x12b,-0x115),fn(_0x2c0057(-0x2ae,-0x2b0,-0x2ce,-0x2b2),col(_0x2c0057(-0x2f5,-0x2f8,-0x314,-0x2ff)))),_0x4472ba(-0xec,-0xec,-0xde,-0xee)],[fn('COUNT',col('id')),'total_visits']],'where':{'visit_date':{[Op[_0x4472ba(-0x11c,-0x108,-0xe2,-0xfe)]]:_0x16b343}},'group':[_0x4472ba(-0x128,-0x152,-0x16f,-0x144)],'order':[['visit_date',_0x4472ba(-0x116,-0x112,-0x12c,-0x143)]],'raw':!![]});_0x326762[_0x2c0057(-0x2ee,-0x2eb,-0x2dc,-0x2e2)]({'success':!![],'data':{'ranking':_0x539c6c[_0x2c0057(-0x2e8,-0x2bb,-0x28a,-0x29a)](_0x541b39=>({'ip':_0x541b39[_0x4472ba(-0x175,-0x12d,-0x177,-0x14a)],'visits':parseInt(_0x541b39[_0x2c0057(-0x2c3,-0x2c1,-0x2de,-0x2c3)]),'lastVisit':_0x541b39['last_visit']})),'daily':_0x44adf6[_0x4472ba(-0x13c,-0x100,-0x125,-0x10d)](_0x334283=>({'date':_0x334283[_0x2c0057(-0x319,-0x2f2,-0x324,-0x300)],'uniqueIPs':parseInt(_0x334283[_0x2c0057(-0x28a,-0x29c,-0x2af,-0x2cc)]),'totalVisits':parseInt(_0x334283[_0x2c0057(-0x2a4,-0x2bd,-0x2b5,-0x2c9)])}))}});}catch(_0x27acfa){console[_0x4472ba(-0x14b,-0x125,-0x176,-0x147)](_0x2c0057(-0x2ec,-0x2fb,-0x327,-0x2c6),_0x27acfa),_0x326762[_0x4472ba(-0xf8,-0xf8,-0x121,-0xff)](-0xa69+0xed*-0x12+0x1d07)[_0x2c0057(-0x307,-0x2eb,-0x2ba,-0x30f)]({'success':![],'message':_0x4472ba(-0x117,-0x151,-0x147,-0x139)});}};async function countDocsFiles(){function _0x58f430(_0x2d5149,_0x3d8d82,_0x24ee25,_0x13d9a7){return _0x_0x4fee4f(_0x2d5149-0x4a1,_0x3d8d82-0x131,_0x24ee25-0x1c3,_0x24ee25);}function _0x3d1ed6(_0x3a7ebc,_0x4b04e4,_0x3aa694,_0x3c0a8e){return _0x_0x4fee4f(_0x3aa694-0x459,_0x4b04e4-0x18,_0x3aa694-0x25,_0x3a7ebc);}try{const _0x45e9ba=[path[_0x58f430(0x345,0x316,0x369,0x33c)](__dirname,_0x3d1ed6(0x320,0x340,0x355,0x381)),path[_0x3d1ed6(0x31e,0x2e5,0x2fd,0x321)](__dirname,_0x58f430(0x373,0x34e,0x36b,0x34b)),process[_0x58f430(0x371,0x385,0x356,0x34d)]['MARKDOWN_DIR']][_0x58f430(0x34c,0x36b,0x36c,0x345)](Boolean);for(const _0x3089c1 of _0x45e9ba){if(_0x58f430(0x36a,0x339,0x387,0x36f)!==_0x3d1ed6(0x31d,0x30b,0x321,0x310))try{const _0x587af6=await fs[_0x58f430(0x34e,0x360,0x377,0x379)](_0x3089c1),mdFiles=_0x587af6['filter'](_0x5dd021=>_0x5dd021[_0x3d1ed6(0x365,0x360,0x33b,0x354)](_0x58f430(0x385,0x36f,0x357,0x394)));return mdFiles[_0x3d1ed6(0x345,0x36b,0x34f,0x336)];}catch(_0x5193a1){continue;}else{const _0x795105=_0x450993?function(){function _0x431c93(_0x2c1361,_0x1b3fc9,_0x6a8b92,_0x4af925){return _0x58f430(_0x6a8b92- -0x506,_0x1b3fc9-0x2f,_0x2c1361,_0x4af925-0xd3);}if(_0xf4d3b7){const _0x16b0a8=_0x2f015d[_0x431c93(-0x14f,-0x15b,-0x16c,-0x197)](_0x290ffd,arguments);return _0x3dc2cf=null,_0x16b0a8;}}:function(){};return _0x1ef878=![],_0x795105;}}return-0x175d+0xba9*-0x1+-0x1*-0x2306;}catch(_0x223fe3){return 0x11c4+-0x32*-0x41+-0x7*0x45a;}}exports[_0x_0x10c630(-0xc,-0xe,0x10,-0x2e)]=async(_0x31343e,_0x3c460c)=>{function _0x3af058(_0x449e82,_0x47dc89,_0x2c1979,_0x585c16){return _0x_0x4fee4f(_0x585c16-0x492,_0x47dc89-0x14a,_0x2c1979-0x137,_0x47dc89);}function _0x5adeb6(_0x16e7ff,_0x5841a9,_0x2d9740,_0x1f0228){return _0x_0x10c630(_0x16e7ff-0x35a,_0x5841a9-0x145,_0x1f0228,_0x1f0228-0xa0);}try{if(_0x3af058(0x323,0x328,0x346,0x34c)!==_0x3af058(0x370,0x397,0x342,0x372)){const _0x41cb9b=await PageVisit[_0x3af058(0x313,0x317,0x351,0x343)]({'where':{},'truncate':!![]});_0x3c460c[_0x3af058(0x32b,0x364,0x379,0x34b)]({'success':!![],'message':_0x5adeb6(0x2f6,0x2cb,0x2c3,0x30c),'data':{'deletedCount':_0x41cb9b}});}else return _0x283d22[_0x3af058(0x378,0x379,0x369,0x389)](-0xe7d*0x1+-0x15cc+0x25d9)['json']({'success':![],'message':'无效的页面类型'});}catch(_0x46a92b){console['error'](_0x5adeb6(0x33a,0x320,0x324,0x36a),_0x46a92b),_0x3c460c[_0x5adeb6(0x347,0x350,0x35e,0x346)](0x1*-0x89a+-0x1980+0x240e)['json']({'success':![],'message':'清理访问数据失败'});}},exports[_0x_0x4fee4f(-0x12a,-0x105,-0x11f,-0x13a)]=async(_0x3e866f,_0x1e400f)=>{function _0x244cff(_0x37982c,_0x3cec58,_0xfa1fe9,_0x1a2a58){return _0x_0x4fee4f(_0x1a2a58-0x5eb,_0x3cec58-0xe0,_0xfa1fe9-0x1c0,_0xfa1fe9);}function _0x355851(_0x5f2a96,_0x35e1d9,_0x4220a2,_0x8aba2f){return _0x_0x4fee4f(_0x35e1d9-0x83,_0x35e1d9-0x70,_0x4220a2-0x75,_0x8aba2f);}try{const _0x5dd903=new Date()['toISOString']()[_0x244cff(0x4fa,0x4a6,0x497,0x4c9)]('T')[0x521+-0x20a9+0x1b88*0x1],_0x4ff8ef=new Date();_0x4ff8ef[_0x355851(-0xc0,-0xc5,-0xc1,-0xdd)](_0x4ff8ef[_0x244cff(0x487,0x4c9,0x4d6,0x4a7)]()-(-0x817*-0x1+-0xe3*-0x29+-0x2c6b));const _0x57167e=_0x4ff8ef[_0x355851(-0xdb,-0xb9,-0xad,-0xcf)]()['split']('T')[-0x3e2+-0x4eb*0x1+0x8cd],_0x2e59dc=await PageVisit[_0x244cff(0x4ba,0x4a1,0x505,0x4d1)]({'attributes':[[fn(_0x244cff(0x4ab,0x4d0,0x4a0,0x4cc),col('id')),_0x355851(-0x6b,-0x96,-0xa3,-0xc8)],[fn(_0x244cff(0x4d8,0x4d5,0x4f9,0x4cc),fn(_0x244cff(0x4f3,0x507,0x4ab,0x4df),col('ip_address'))),_0x355851(-0x5f,-0x75,-0x8e,-0x53)]],'where':{'visit_date':_0x5dd903},'raw':!![]}),_0x440108=await PageVisit['findOne']({'attributes':[[fn(_0x355851(-0xa2,-0x9c,-0x93,-0xcc),col('id')),_0x244cff(0x507,0x4bf,0x4d9,0x4d2)],[fn('COUNT',fn(_0x355851(-0x5d,-0x89,-0x96,-0xbc),col(_0x244cff(0x48b,0x494,0x49e,0x497)))),_0x355851(-0x8d,-0x75,-0x9d,-0x8f)]],'raw':!![]});_0x1e400f[_0x244cff(0x4ce,0x475,0x482,0x4a4)]({'success':!![],'data':{'today':{'visits':parseInt(_0x2e59dc?.['total_visits'])||-0x5fe+-0xb16+-0x1114*-0x1,'uniqueIPs':parseInt(_0x2e59dc?.[_0x244cff(0x4c3,0x51e,0x517,0x4f3)])||-0x1*-0x601+0x5*0x634+-0x2505*0x1},'total':{'visits':parseInt(_0x440108?.[_0x355851(-0xb3,-0x96,-0x79,-0x93)])||0x2*-0xeb9+0x4*-0x241+0x2676,'uniqueIPs':parseInt(_0x440108?.[_0x355851(-0x94,-0x75,-0x68,-0xa5)])||0x1b50+0x137c*0x1+0x95c*-0x5}}});}catch(_0x4fbb09){console['error'](_0x355851(-0xa4,-0x7e,-0x5d,-0x8c),_0x4fbb09),_0x1e400f[_0x355851(-0x5c,-0x86,-0xb9,-0x96)](0x2*-0x11ba+-0x2*0x10d7+0x4716)['json']({'success':![],'message':_0x355851(-0xe3,-0xd5,-0xc6,-0xec)});}};