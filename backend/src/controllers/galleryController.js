(function(_0x3040ba,_0x4c61d1){function _0x2392ea(_0x1262df,_0x302de9,_0x2de3f6,_0x3a3c85){return _0x_0x2448(_0x1262df-0x30,_0x3a3c85);}function _0x2a3849(_0x3064b8,_0x47295c,_0x409dde,_0x4548a0){return _0x_0x2448(_0x47295c- -0x3b5,_0x3064b8);}const _0x1b7dc7=_0x3040ba();while(!![]){try{const _0x2b7d56=parseInt(_0x2a3849(-0x325,-0x324,-0x31e,-0x321))/(-0x9f8*-0x1+-0x2378+0x1981)*(-parseInt(_0x2a3849(-0x2f0,-0x322,-0x2fd,-0x2fc))/(0x2*-0x178+0x218b+0x1*-0x1e99))+-parseInt(_0x2392ea(0x103,0x10d,0x12a,0xfb))/(-0x1c7*-0x2+-0xc77+0x8ec)*(-parseInt(_0x2392ea(0xd9,0x102,0xd8,0xc7))/(0x25f8+0x2cc*-0x4+-0x1ac4))+-parseInt(_0x2392ea(0x110,0x11f,0x121,0xe1))/(-0xd3d+-0x2*-0x332+0x6de)*(-parseInt(_0x2a3849(-0x297,-0x2c2,-0x2d0,-0x2a5))/(-0x33e*0x7+0x11c+0x159c))+parseInt(_0x2392ea(0x122,0x114,0x115,0x130))/(-0x1d11*-0x1+0x1ea5+-0x3baf)+parseInt(_0x2a3849(-0x2e5,-0x2ca,-0x2e7,-0x2be))/(0x1d3*-0xb+0x1775+-0x35c)+parseInt(_0x2a3849(-0x309,-0x314,-0x32f,-0x2f1))/(0x2*0x9a9+-0x1*0xeef+-0x45a)*(-parseInt(_0x2392ea(0xe3,0xf5,0xf3,0xda))/(0xebd+0x2f3*-0xa+0xecb))+parseInt(_0x2a3849(-0x33d,-0x31a,-0x306,-0x327))/(0x365+-0x2*0x11da+0x205a);if(_0x2b7d56===_0x4c61d1)break;else _0x1b7dc7['push'](_0x1b7dc7['shift']());}catch(_0x109175){_0x1b7dc7['push'](_0x1b7dc7['shift']());}}}(_0x_0x50d1,-0x280e4+-0xc2a*0x5b+0x160cd*0x7));const _0x_0xb88f5b=(function(){let _0x5cb360=!![];return function(_0x23bf52,_0x17227f){const _0x288e8e=_0x5cb360?function(){if(_0x17227f){const _0x4fd5f3=_0x17227f['apply'](_0x23bf52,arguments);return _0x17227f=null,_0x4fd5f3;}}:function(){};return _0x5cb360=![],_0x288e8e;};}()),_0x_0x16c8e5=_0x_0xb88f5b(this,function(){function _0x2921eb(_0x17f193,_0x25504a,_0x3faff7,_0x222694){return _0x_0x2448(_0x25504a- -0xf8,_0x17f193);}function _0x7e05b9(_0x5210a0,_0x8335a8,_0x3a44b0,_0x33e8f9){return _0x_0x2448(_0x5210a0- -0xd0,_0x3a44b0);}return _0x_0x16c8e5['toString']()[_0x2921eb(-0x40,-0x33,-0x3,-0x66)](_0x2921eb(0x12,-0x4,-0x17,-0x33))[_0x7e05b9(-0x3a,-0x4a,-0x1b,-0x6f)]()['constructor'](_0x_0x16c8e5)[_0x7e05b9(-0xb,-0x2b,-0x2d,0x26)](_0x2921eb(-0x8,-0x4,0x1f,-0x26));});function _0x_0x2448(_0x228b01,_0x29ca1e){_0x228b01=_0x228b01-(-0x5e*-0x34+0x17c2+-0xd*0x341);const _0x65a275=_0x_0x50d1();let _0x1ab7fa=_0x65a275[_0x228b01];if(_0x_0x2448['HGLIGq']===undefined){var _0x462323=function(_0xda1cb3){const _0x313f8f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x31cb0c='',_0x11f6e7='',_0x41a71b=_0x31cb0c+_0x462323;for(let _0x3b5a36=0x1*0x821+-0x53a+0x2e7*-0x1,_0x2a344c,_0x2f7db3,_0x131fc8=-0xc38*0x3+0x17fe*0x1+-0x1*-0xcaa;_0x2f7db3=_0xda1cb3['charAt'](_0x131fc8++);~_0x2f7db3&&(_0x2a344c=_0x3b5a36%(0x232b*0x1+-0x1c07+-0x720)?_0x2a344c*(0xa09*0x1+0x22*0x38+-0x1139)+_0x2f7db3:_0x2f7db3,_0x3b5a36++%(-0x1448+-0x24ef+0xa1*0x5b))?_0x31cb0c+=_0x41a71b['charCodeAt'](_0x131fc8+(0x1327+0xbe1*-0x3+-0x1d6*-0x9))-(-0x23*0x119+0x25c3*-0x1+0x43c*0x12)!==0x1858+-0x251b*-0x1+-0x3d73*0x1?String['fromCharCode'](-0x1*0x851+-0x31b*-0x4+-0x31c&_0x2a344c>>(-(-0x55c*-0x3+0x9e*-0x29+0x93c)*_0x3b5a36&0x21c7+0x5*0x4c3+-0xe64*0x4)):_0x3b5a36:-0x3*-0x430+0x19cf*-0x1+0xd3f){_0x2f7db3=_0x313f8f['indexOf'](_0x2f7db3);}for(let _0x542b79=-0x4*-0x2b5+-0x3c6+-0x2b*0x2a,_0x114045=_0x31cb0c['length'];_0x542b79<_0x114045;_0x542b79++){_0x11f6e7+='%'+('00'+_0x31cb0c['charCodeAt'](_0x542b79)['toString'](-0x236f+-0x172e+-0x3aad*-0x1))['slice'](-(0x27b*-0x7+0x25*-0x6b+0x2*0x106b));}return decodeURIComponent(_0x11f6e7);};_0x_0x2448['kRJLAG']=_0x462323,_0x_0x2448['czfjAM']={},_0x_0x2448['HGLIGq']=!![];}const _0x183042=_0x65a275[0x3*0x151+0x3*-0xc71+0x2160],_0x4055d3=_0x228b01+_0x183042,_0xc46864=_0x_0x2448['czfjAM'][_0x4055d3];if(!_0xc46864){const _0x2477ab=function(_0x1a8545){this['HsnVEC']=_0x1a8545,this['ykOsPE']=[-0x71+0x1*-0x14bf+0x1531,0x1d35+-0x40d*-0x7+0x1330*-0x3,0x1a54+-0x585+0x14cf*-0x1],this['LuXznf']=function(){return'newState';},this['AEkhVo']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['XEstFH']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2477ab['prototype']['VekWPB']=function(){const _0x5e8000=new RegExp(this['AEkhVo']+this['XEstFH']),_0x5a1022=_0x5e8000['test'](this['LuXznf']['toString']())?--this['ykOsPE'][-0xd*0x19f+0x7*-0x2d1+0x28cb]:--this['ykOsPE'][0x174+-0x175d+0x47*0x4f];return this['bFTOYt'](_0x5a1022);},_0x2477ab['prototype']['bFTOYt']=function(_0x146ed6){if(!Boolean(~_0x146ed6))return _0x146ed6;return this['LpvSWJ'](this['HsnVEC']);},_0x2477ab['prototype']['LpvSWJ']=function(_0x589b3e){for(let _0x2d7fb3=0xc39+0x1113+-0x1d4c,_0x4a1945=this['ykOsPE']['length'];_0x2d7fb3<_0x4a1945;_0x2d7fb3++){this['ykOsPE']['push'](Math['round'](Math['random']())),_0x4a1945=this['ykOsPE']['length'];}return _0x589b3e(this['ykOsPE'][-0x480+0x104e*0x1+0x5e7*-0x2]);},new _0x2477ab(_0x_0x2448)['VekWPB'](),_0x1ab7fa=_0x_0x2448['kRJLAG'](_0x1ab7fa),_0x_0x2448['czfjAM'][_0x4055d3]=_0x1ab7fa;}else _0x1ab7fa=_0xc46864;return _0x1ab7fa;}function _0x_0x2a169f(_0x32178a,_0x29f488,_0x4194e6,_0x486b27){return _0x_0x2448(_0x486b27-0x2fe,_0x4194e6);}_0x_0x16c8e5();function _0x_0x50d1(){const _0x5e88b7=['zgvZy3jPChrPB24','BwfW','mtC1mJeWwgfmy3ve','oda5ntHPuKPcrhu','kcGOlISPkYKRksSK','DxbKyxrL','lI4VlI4VDxbSB2fKCY9PBwfNzxnHBgW','y2f0zwDVCNLFAwq','zMLUzej5ugS','CgfYyw1Z','B3v6r0q','Cgf0Aa','ndfsugfnz2W','AM9PBG','mty0nJzdBuDWr3C','z2v0qwrTAw5hywXSzxj5','q2jRqNa','Dg9tDhjPBMC','CxvLCNK','EK9jswy','uLD4Awy','5yIG6zMK5zU+5yAm5PAh5lU25As55AsX6lsLoG','ndK3otiZogPRDMHAuG','CgfZC3DVCMq','AxnbCNjHEq','z2v0uhvIBgLJr2fSBgvYAwvZ','6k+L5zU+5yAm5PEG6zYa5A+g56cb','z2v0uhvIBgLJr2fSBgvYEq','nZq0m29bu0jSzW','y3jLyxrLr2fSBgvYEq','C3vIC3rYAw5N','C2TqAKe','Avzzvhu','AgfZugfZC3DVCMq','y3vQvKC','EevStMW','mJeZmdC2Cxjzq1Lg','zxHWB3j0CW','y292zxjFAw1Hz2u','zxjYB3i','5A+g56cb5lIn6io95lI656M6','Aw1Hz2vZ','5Qch6Aky5lIn6io95lI656M6','CergCxC','yNvSA0nYzwf0zq','wKjrzfK','mZa2mhbPBgfUra','vhnNwei','zKXVzMm','y2f0zwDVCNK','DgL0Bgu','C3rHDhvZ','C29YDf9VCMrLCG','ANnVBG','5A+g56cb6AQm6k+b5OIq5yQF','lI4VlI4V','Bwf4','revtqW','zMLUze9Uzq','BgLRzq','uxHPAhm','DxbKyxrLr2fSBgvYEq','5zU+5yAm5lIn5A2y5zYO','AgXAu3K','C2vHCMnO','zgTQt0C','uwL0u2O','DxbSB2fKsw1Hz2vZ','zgvSzxrLsw1Hz2u','tM9lC3m','uMHZthu','5RkH5PYj5lIk5lYG5PAh5lU2','DMvYAwz5r2fSBgvYEvbHC3n3B3jK','5O6s5BQp5PU05PAW5OIq5yQF','5yIG6zMK5zU+54Mh5PAh5lU25AsX6lsLoG','5A+g56cb6zsz6k+V','CMvWBgfJzq','y291BNq','owHYB1LorW','ywXS','6zYa6kAb5A+g56cb','Dw5SAw5R','DhjPBq','BMfTzq','CZnvCMW','DxbKyxrLsw1Hz2vpCMrLCG','5zU+5yAm5yIB5BU65OIq5yQF','5PEG5Pwi55Qe5O6s5BQp5PwW5O2U','qvnd','Aw5RuMC','5OYh5A6A55Qe5yIg57g75lIn5A2y5zYO','nxDprNr0yq','yM9KEq','y3jLyxrLzf9HDa','uuTIuvC','Dg9ku09o','Aw5KzxHpzG','s3HbExO','5zU+54Mh5lIn5A2y5zYO','zMLSzw5HBwu','zgvSzxrLr2fSBgvYEq','z2v0qwrTAw5hywXSzxjPzxm','otK1mJmYAM5VsuvW','y29UC3rYDwn0B3i','Aw1Hz2vFy291BNq','wNLKyLy','DxbSB2fKCY8'];_0x_0x50d1=function(){return _0x5e88b7;};return _0x_0x50d1();}const Gallery=require('../models/Gallery'),GalleryCategory=require('../models/GalleryCategory'),GalleryImage=require('../models/GalleryImage'),fs=require('fs').promises,path=require('path'),bcrypt=require('bcryptjs');exports[_0x_0x5bea10(0x186,0x168,0x1b1,0x1a6)]=async(_0x8df26a,_0x863105,_0x3e7273)=>{function _0x52ca13(_0x2ca556,_0x1a45e4,_0x251366,_0x20a2ed){return _0x_0x5bea10(_0x2ca556-0x57,_0x1a45e4-0x150,_0x251366-0x151,_0x251366);}function _0x2f1f9a(_0x1ac05c,_0x1624cc,_0x2bcb7c,_0x404aaf){return _0x_0x5bea10(_0x1624cc- -0x320,_0x1624cc-0x19a,_0x2bcb7c-0x9f,_0x1ac05c);}try{if('VOzCc'!=='Gxvwg'){const {category_id:_0x59232a,search:_0x1a6070}=_0x8df26a['query'],_0x13ee08={'is_visible':!![]};if(_0x59232a){if(_0x2f1f9a(-0x17b,-0x186,-0x1a0,-0x15c)!==_0x52ca13(0x1f3,0x20e,0x21e,0x1de))_0x13ee08[_0x2f1f9a(-0x130,-0x141,-0x175,-0x139)]=_0x59232a;else{const {Op:_0x5e7cd4}=require('sequelize');_0x2bd1da[_0x2f1f9a(-0x198,-0x181,-0x18d,-0x198)]={[_0x5e7cd4[_0x2f1f9a(-0x14c,-0x178,-0x164,-0x193)]]:'%'+_0x2f25d1+'%'};}}if(_0x1a6070){if(_0x2f1f9a(-0x176,-0x191,-0x198,-0x1c0)!==_0x2f1f9a(-0x1bb,-0x19f,-0x1c1,-0x1a9)){const {Op:_0x259a55}=require('sequelize');_0x13ee08[_0x52ca13(0x1f6,0x1d2,0x1d4,0x1d3)]={[_0x259a55[_0x52ca13(0x1ff,0x218,0x1f5,0x1f2)]]:'%'+_0x1a6070+'%'};}else return _0x2a32b4[_0x2f1f9a(-0x17b,-0x180,-0x196,-0x155)](0x5af+0x1691+-0x1*0x1ab0)[_0x52ca13(0x1f9,0x1d4,0x1cb,0x1fa)]({'success':![],'message':_0x52ca13(0x21e,0x218,0x23d,0x221)});}const _0x466f93=await Gallery['findAll']({'where':_0x13ee08,'include':[{'model':GalleryCategory,'as':_0x2f1f9a(-0x1ac,-0x182,-0x1a2,-0x159),'attributes':['id','name','icon']}],'attributes':['id',_0x52ca13(0x1f6,0x223,0x1cd,0x1e4),_0x52ca13(0x22f,0x206,0x201,0x25b),_0x2f1f9a(-0x1bf,-0x18d,-0x171,-0x162),_0x2f1f9a(-0x154,-0x14b,-0x13b,-0x134),_0x2f1f9a(-0x167,-0x141,-0x16b,-0x167),_0x2f1f9a(-0x179,-0x156,-0x147,-0x142),_0x2f1f9a(-0x16b,-0x19c,-0x18f,-0x197)],'order':[[_0x2f1f9a(-0x17e,-0x17f,-0x14c,-0x1b1),_0x2f1f9a(-0x150,-0x15b,-0x172,-0x149)],[_0x2f1f9a(-0x17e,-0x156,-0x172,-0x152),_0x2f1f9a(-0x1a3,-0x17a,-0x17b,-0x161)]]}),processedGalleries=_0x466f93[_0x52ca13(0x230,0x1fd,0x254,0x230)](_0x4c54b6=>{function _0x351e3f(_0x2d7a55,_0x31c217,_0x115d05,_0xe0ede8){return _0x52ca13(_0x2d7a55- -0x31a,_0x31c217-0x10b,_0xe0ede8,_0xe0ede8-0x1c);}function _0x12da13(_0x245099,_0x113421,_0x5432de,_0x2df7c){return _0x52ca13(_0x245099- -0x3f9,_0x113421-0x34,_0x113421,_0x2df7c-0x163);}if(_0x12da13(-0x225,-0x20b,-0x252,-0x246)===_0x351e3f(-0x146,-0x11a,-0x11e,-0x13e)){const _0x4ebd63=_0x4c54b6[_0x351e3f(-0xf7,-0x10e,-0xe3,-0xfe)]();return _0x4ebd63[_0x351e3f(-0x13f,-0x139,-0x118,-0x144)]?(_0x4ebd63[_0x12da13(-0x214,-0x207,-0x225,-0x23f)]=!![],delete _0x4ebd63[_0x351e3f(-0x13f,-0x161,-0x141,-0x12a)]):_0x4ebd63[_0x12da13(-0x214,-0x1e2,-0x1f0,-0x1f3)]=![],_0x4ebd63;}else _0x73bd00=_0x12ac74['s3Url'];});_0x863105[_0x2f1f9a(-0x187,-0x17e,-0x187,-0x194)]({'success':!![],'data':processedGalleries});}else _0x113014=_0x5715f7[_0x52ca13(0x1e2,0x20b,0x1dc,0x1b3)](_0x30b342);}catch(_0x5abda0){_0x3e7273(_0x5abda0);}},exports[_0x_0x2a169f(0x3bb,0x390,0x36f,0x39e)]=async(_0x5823bc,_0x215770,_0x273984)=>{function _0x32da7f(_0x156c97,_0x134f4a,_0x37c2df,_0x58d89c){return _0x_0x2a169f(_0x156c97-0x4b,_0x134f4a-0x4f,_0x156c97,_0x134f4a-0x31);}function _0x108aa1(_0x1cf6e7,_0x52cc39,_0x1acf48,_0x1ca185){return _0x_0x5bea10(_0x52cc39- -0x2ab,_0x52cc39-0x92,_0x1acf48-0x5e,_0x1ca185);}try{if(_0x32da7f(0x3c6,0x3f5,0x3e5,0x3f2)===_0x108aa1(-0x115,-0xfd,-0x11e,-0xf9)){const {id:_0x51be20}=_0x5823bc[_0x32da7f(0x3df,0x3bd,0x38a,0x3b3)],{password:_0x7b8594}=_0x5823bc[_0x108aa1(-0x103,-0x12c,-0x155,-0x14e)],_0xdc2a56=await Gallery[_0x32da7f(0x3bf,0x3ee,0x41b,0x3d3)]({'where':{'id':_0x51be20,'is_visible':!![]},'include':[{'model':GalleryCategory,'as':_0x108aa1(-0xe4,-0x10d,-0x142,-0x140),'attributes':['id',_0x108aa1(-0x10d,-0xeb,-0xfa,-0xe6),'icon']},{'model':GalleryImage,'as':'images','attributes':['id','filename','path',_0x32da7f(0x40f,0x3e8,0x3ce,0x3ff),'size'],'order':[['sort_order',_0x32da7f(0x419,0x40c,0x426,0x408)],[_0x32da7f(0x401,0x411,0x412,0x3e4),_0x108aa1(-0x105,-0xe6,-0xea,-0xdb)]]}]});if(!_0xdc2a56)return _0x215770['status'](0x6*-0x407+-0x20a0+0x3a5e)[_0x32da7f(0x3e6,0x3e9,0x407,0x3e8)]({'success':![],'message':'图册不存在'});if(_0xdc2a56['password']){if(_0x108aa1(-0xc5,-0xf9,-0xc4,-0xc6)!==_0x108aa1(-0xcf,-0xd5,-0xca,-0xb7)){if(!_0x7b8594)return'zOIIf'!==_0x108aa1(-0xfb,-0x12b,-0x139,-0x137)?_0x1ccfaa['json']({'success':!![],'message':_0x108aa1(-0x13d,-0x124,-0x12e,-0xf6)}):_0x215770[_0x32da7f(0x414,0x3e7,0x412,0x3c8)](-0x2*-0x11b3+-0x1a7e+0x1*-0x757)[_0x32da7f(0x412,0x3e9,0x3f1,0x3f8)]({'success':![],'message':_0x108aa1(-0xd2,-0xee,-0xe6,-0x10e),'requirePassword':!![]});if(_0x7b8594!==_0xdc2a56[_0x32da7f(0x3f2,0x3cb,0x3cb,0x3cd)])return _0x215770[_0x32da7f(0x3f2,0x3e7,0x3f4,0x3bd)](-0x1cb6+0x6ed+0x175a)[_0x108aa1(-0x13f,-0x109,-0x10a,-0xfa)]({'success':![],'message':_0x32da7f(0x3f9,0x3ff,0x416,0x429)});}else return _0x558490['status'](0x3*0x9bf+-0x631*0x1+-0x16*0xfa)[_0x108aa1(-0x12f,-0x109,-0xe7,-0x11f)]({'success':![],'message':_0x108aa1(-0xce,-0xe7,-0xc0,-0x103)});}const _0x5798bb=_0xdc2a56['toJSON']();delete _0x5798bb[_0x108aa1(-0x141,-0x127,-0x13b,-0x143)],_0x215770['json']({'success':!![],'data':_0x5798bb});}else _0x47066e(_0x136635);}catch(_0x1dd0b5){_0x273984(_0x1dd0b5);}},exports[_0x_0x5bea10(0x1b5,0x198,0x1cb,0x1e8)]=async(_0x376b93,_0x4b43a5,_0x3efd9f)=>{function _0x1c78cb(_0x292d39,_0xbb5eef,_0x324359,_0x4fc6dc){return _0x_0x2a169f(_0x292d39-0x71,_0xbb5eef-0xff,_0x324359,_0x292d39- -0x443);}function _0x5ca1ef(_0x42d223,_0x5eebf4,_0x4ddefa,_0x39ea6d){return _0x_0x2a169f(_0x42d223-0x81,_0x5eebf4-0x1bb,_0x5eebf4,_0x39ea6d- -0x114);}try{const {id:_0x541b58}=_0x376b93[_0x1c78cb(-0xb7,-0x83,-0xeb,-0x83)],{password:_0x8b7240}=_0x376b93[_0x5ca1ef(0x2a4,0x29d,0x29a,0x2cb)];if(!_0x8b7240)return _0x4b43a5['status'](-0x1*-0x293+0x1c03+-0x1d06)['json']({'success':![],'message':_0x5ca1ef(0x29e,0x28e,0x26a,0x297)});const _0x830ff9=await Gallery[_0x5ca1ef(0x2a7,0x2ce,0x27b,0x2a9)]({'where':{'id':_0x541b58,'is_visible':!![]},'attributes':['id','password']});if(!_0x830ff9)return _0x4b43a5[_0x1c78cb(-0x8d,-0x85,-0x8f,-0x89)](0x1ca7+-0xc37+0x6*-0x27a)[_0x5ca1ef(0x2d6,0x2b2,0x2d6,0x2a4)]({'success':![],'message':_0x5ca1ef(0x2b6,0x282,0x27c,0x2ad)});if(!_0x830ff9[_0x1c78cb(-0xa9,-0xab,-0x99,-0xc3)])return _0x4b43a5[_0x5ca1ef(0x29b,0x2c6,0x2a5,0x2a4)]({'success':!![],'message':'该图册无需密码'});if(_0x8b7240!==_0x830ff9[_0x5ca1ef(0x27a,0x2ac,0x2ad,0x286)])return _0x4b43a5[_0x5ca1ef(0x285,0x281,0x2d7,0x2a2)](-0xf*0x13+-0x1*0x1223+0x14d1)[_0x1c78cb(-0x8b,-0x83,-0xbe,-0xba)]({'success':![],'message':_0x1c78cb(-0x75,-0x89,-0x70,-0x71)});_0x4b43a5[_0x1c78cb(-0x8b,-0x55,-0x74,-0xac)]({'success':!![],'message':_0x5ca1ef(0x28b,0x28b,0x2a2,0x2a5)});}catch(_0x8d89c9){_0x5ca1ef(0x2d4,0x2f2,0x2ae,0x2c8)===_0x1c78cb(-0x67,-0x93,-0x80,-0x8f)?_0x3efd9f(_0x8d89c9):_0x4804a9[_0x5ca1ef(0x2b1,0x2cd,0x2fc,0x2e1)]=_0x3eda5c;}},exports[_0x_0x2a169f(0x3ee,0x3f6,0x3c4,0x3e8)]=async(_0x4a782b,_0x3900f8,_0x389654)=>{function _0x1e17bb(_0x228da6,_0x49a1d6,_0x1db6f1,_0x6b4d6b){return _0x_0x2a169f(_0x228da6-0x11e,_0x49a1d6-0xfb,_0x1db6f1,_0x6b4d6b- -0x5c);}function _0x344cf9(_0x1413b4,_0x4ad409,_0x6fb17a,_0x2170e6){return _0x_0x5bea10(_0x2170e6-0x50,_0x4ad409-0x113,_0x6fb17a-0x50,_0x1413b4);}try{const {category_id:_0x4044a2,search:_0x197e65}=_0x4a782b['query'],_0x336a09={};_0x4044a2&&(_0x336a09[_0x1e17bb(0x3bc,0x373,0x3bc,0x399)]=_0x4044a2);if(_0x197e65){if(_0x344cf9(0x1b1,0x202,0x1b2,0x1dc)===_0x1e17bb(0x323,0x365,0x352,0x346)){const {Op:_0x165340}=require('sequelize');_0x336a09[_0x1e17bb(0x325,0x379,0x382,0x359)]={[_0x165340['like']]:'%'+_0x197e65+'%'};}else return _0x4f62a0[_0x1e17bb(0x34a,0x367,0x31c,0x338)]()[_0x344cf9(0x225,0x229,0x209,0x1fd)](_0x1e17bb(0x36b,0x36c,0x3b3,0x396))['toString']()[_0x344cf9(0x25a,0x24f,0x1f0,0x224)](_0x4d6620)[_0x344cf9(0x1d2,0x1d8,0x1d0,0x1fd)](_0x1e17bb(0x3c7,0x3c0,0x370,0x396));}const _0x38bd44=await Gallery['findAll']({'where':_0x336a09,'include':[{'model':GalleryCategory,'as':_0x344cf9(0x20a,0x1fa,0x21c,0x1ee),'attributes':['id',_0x1e17bb(0x362,0x3aa,0x358,0x37a),'icon']},{'model':GalleryImage,'as':_0x344cf9(0x1ea,0x1e6,0x1c6,0x1e6),'attributes':['id',_0x1e17bb(0x3be,0x3b3,0x366,0x38a),_0x1e17bb(0x30b,0x35b,0x303,0x332),'sort_order'],'order':[[_0x1e17bb(0x36c,0x371,0x358,0x35b),_0x1e17bb(0x357,0x3af,0x39c,0x37f)]]}],'order':[['sort_order',_0x1e17bb(0x37e,0x364,0x396,0x37f)],[_0x344cf9(0x22b,0x215,0x207,0x21a),_0x1e17bb(0x379,0x374,0x347,0x360)]]}),processedGalleries=_0x38bd44[_0x1e17bb(0x3ad,0x3a0,0x371,0x393)](_0x23fed6=>{function _0x599e53(_0x41846d,_0xa11bd0,_0x18daa1,_0x230c78){return _0x344cf9(_0xa11bd0,_0xa11bd0-0x99,_0x18daa1-0x93,_0x18daa1-0x91);}const _0x251ff4=_0x23fed6['toJSON']();function _0x128c9d(_0x395928,_0xceadf,_0x2cd521,_0x79c869){return _0x1e17bb(_0x395928-0xdb,_0xceadf-0x1d0,_0xceadf,_0x79c869- -0x4b7);}return _0x251ff4['password']?_0x128c9d(-0x106,-0x128,-0x142,-0x132)!==_0x128c9d(-0x122,-0x106,-0x12e,-0x132)?_0x58637e(_0x4fd25d):(_0x251ff4[_0x128c9d(-0x156,-0x163,-0x18c,-0x16f)]=!![],delete _0x251ff4[_0x128c9d(-0x1ad,-0x188,-0x190,-0x179)]):_0x251ff4['hasPassword']=![],_0x251ff4;});_0x3900f8[_0x344cf9(0x221,0x1ed,0x214,0x1f2)]({'success':!![],'data':processedGalleries});}catch(_0xfb1dd9){_0x389654(_0xfb1dd9);}},exports[_0x_0x2a169f(0x384,0x364,0x3ab,0x392)]=async(_0xf329c5,_0xa14ff2,_0x56c74c)=>{function _0xe13d86(_0x239076,_0x203bb2,_0x2ebb2b,_0xa50c94){return _0x_0x5bea10(_0x203bb2-0x2d4,_0x203bb2-0x83,_0x2ebb2b-0xe7,_0xa50c94);}function _0x4e26e2(_0x43cdfb,_0x3ae925,_0x40fd7f,_0x3146ec){return _0x_0x5bea10(_0x3146ec-0x2b6,_0x3ae925-0x15b,_0x40fd7f-0x5f,_0x43cdfb);}try{const {id:_0x1902f2}=_0xf329c5[_0xe13d86(0x457,0x44a,0x465,0x429)],_0x236511=await Gallery['findByPk'](_0x1902f2,{'include':[{'model':GalleryCategory,'as':'category','attributes':['id',_0x4e26e2(0x49d,0x480,0x44a,0x476)]},{'model':GalleryImage,'as':'images','order':[[_0xe13d86(0x47b,0x475,0x491,0x44d),'ASC']]}]});if(!_0x236511)return _0x4e26e2(0x43b,0x409,0x3fc,0x42d)===_0xe13d86(0x456,0x44b,0x44b,0x467)?_0xa14ff2[_0xe13d86(0x486,0x474,0x477,0x471)](-0x2*-0x45+0xb25+0xa1b*-0x1)['json']({'success':![],'message':_0xe13d86(0x483,0x47f,0x4a7,0x4ae)}):_0x118a27[_0x4e26e2(0x462,0x480,0x424,0x456)](0x3d*0x7a+-0x41*0x61+-0x2e0)['json']({'success':![],'message':_0x4e26e2(0x43e,0x467,0x45c,0x46e)});const _0x18daea=_0x236511[_0x4e26e2(0x48c,0x47c,0x497,0x482)]();_0x18daea[_0x4e26e2(0x445,0x455,0x445,0x43a)]?'QitSj'===_0x4e26e2(0x456,0x455,0x460,0x465)?(_0x18daea['hasPassword']=!![],delete _0x18daea[_0x4e26e2(0x42d,0x46d,0x436,0x43a)]):_0x38dc2b(_0xd27173):_0x18daea[_0xe13d86(0x446,0x462,0x481,0x481)]=![],_0xa14ff2['json']({'success':!![],'data':_0x18daea});}catch(_0x542418){_0x56c74c(_0x542418);}},exports[_0x_0x2a169f(0x376,0x3c0,0x399,0x3a0)]=async(_0x53b6d3,_0x4dfb7d,_0x37b052)=>{function _0x4c551c(_0x4d51a5,_0x5b0398,_0x3dfa30,_0x18f923){return _0x_0x2a169f(_0x4d51a5-0x4a,_0x5b0398-0x70,_0x3dfa30,_0x5b0398- -0x442);}function _0x9b135(_0x83b410,_0x516e81,_0x199aab,_0x2188b9){return _0x_0x2a169f(_0x83b410-0x8c,_0x516e81-0x36,_0x516e81,_0x199aab- -0x24d);}try{const {title:_0x4d2ce0,description:_0x19aa50,category_id:_0x34af7f,password:_0x1cbf3d,is_visible:_0x59e089,sort_order:_0xc49689}=_0x53b6d3[_0x4c551c(-0x88,-0x63,-0x85,-0x7e)];if(!_0x4d2ce0)return _0x4dfb7d[_0x4c551c(-0x56,-0x8c,-0x60,-0x8b)](0x5dd*0x5+-0x3ba*-0x6+-0x321d)['json']({'success':![],'message':_0x4c551c(-0x79,-0x95,-0xa2,-0xbe)});if(_0x34af7f){const _0x1e7d43=await GalleryCategory[_0x4c551c(-0xb0,-0xb7,-0x97,-0xd6)](_0x34af7f);if(!_0x1e7d43)return _0x4dfb7d['status'](0x1fe9+-0xb*0x91+-0x181e)['json']({'success':![],'message':_0x9b135(0x19d,0x164,0x190,0x165)});}const _0x206a82=await Gallery['create']({'title':_0x4d2ce0,'description':_0x19aa50,'category_id':_0x34af7f||null,'password':_0x1cbf3d&&_0x1cbf3d[_0x4c551c(-0x3b,-0x6d,-0x40,-0x77)]()?_0x1cbf3d[_0x4c551c(-0x39,-0x6d,-0x6c,-0x56)]():null,'is_visible':_0x59e089!==undefined?_0x59e089:!![],'sort_order':_0xc49689||-0xeed*0x1+0x55*-0x2+0xf97*0x1,'image_count':0x0});_0x4dfb7d[_0x9b135(0x199,0x194,0x169,0x19b)](-0x9*0x2c5+0xcb*0x2e+-0x2b1*0x4)[_0x4c551c(-0x5c,-0x8a,-0x96,-0xa3)]({'success':!![],'message':_0x9b135(0x157,0x17a,0x18c,0x1a8),'data':_0x206a82});}catch(_0xd3a917){_0x37b052(_0xd3a917);}},exports[_0x_0x2a169f(0x3ab,0x3e9,0x3de,0x3c0)]=async(_0x53f377,_0x341bab,_0x442f8a)=>{function _0x542274(_0x13e270,_0x1120a6,_0x5156f0,_0x1b1716){return _0x_0x5bea10(_0x1120a6- -0x35d,_0x1120a6-0xdc,_0x5156f0-0x1,_0x1b1716);}function _0x332147(_0x5b0e57,_0x3f4811,_0xe12c0,_0x23b780){return _0x_0x5bea10(_0x23b780-0x272,_0x3f4811-0x122,_0xe12c0-0xf6,_0xe12c0);}try{const {id:_0x372ec2}=_0x53f377[_0x542274(-0x1d9,-0x1e7,-0x1f3,-0x1b4)],{title:_0x42dc36,description:_0x38743,category_id:_0x409b5a,password:_0x1480f4,is_visible:_0x5ecfff,sort_order:_0x476460}=_0x53f377[_0x542274(-0x19b,-0x194,-0x1c5,-0x1a1)],_0x54e34d=await Gallery[_0x332147(0x3f7,0x3df,0x3f4,0x3e7)](_0x372ec2);if(!_0x54e34d)return _0x341bab[_0x332147(0x3ed,0x433,0x3f7,0x412)](-0x1bc*0x2+0xb1e+-0x612)[_0x542274(-0x1de,-0x1bb,-0x1ed,-0x1bb)]({'success':![],'message':_0x542274(-0x1b7,-0x1b2,-0x1bd,-0x1e0)});if(_0x409b5a!==undefined&&_0x409b5a!==null){const _0x299e57=await GalleryCategory['findByPk'](_0x409b5a);if(!_0x299e57)return _0x341bab[_0x332147(0x422,0x41d,0x447,0x412)](-0x72c+-0x1*0xf7+0x9b3)[_0x542274(-0x1e5,-0x1bb,-0x1a7,-0x1c8)]({'success':![],'message':_0x332147(0x46f,0x468,0x427,0x439)});}let _0x325920=_0x54e34d[_0x332147(0x3d2,0x3f5,0x403,0x3f6)];_0x1480f4!==undefined&&_0x1480f4!==''&&(_0x325920=_0x1480f4['trim']()),await _0x54e34d['update']({'title':_0x42dc36!==undefined?_0x42dc36:_0x54e34d[_0x332147(0x3e1,0x42f,0x3ec,0x411)],'description':_0x38743!==undefined?_0x38743:_0x54e34d['description'],'category_id':_0x409b5a!==undefined?_0x409b5a:_0x54e34d[_0x542274(-0x184,-0x17e,-0x173,-0x17a)],'password':_0x325920,'is_visible':_0x5ecfff!==undefined?_0x5ecfff:_0x54e34d['is_visible'],'sort_order':_0x476460!==undefined?_0x476460:_0x54e34d[_0x542274(-0x1eb,-0x1bc,-0x1a6,-0x1e5)]}),_0x341bab['json']({'success':!![],'message':'图册更新成功','data':_0x54e34d});}catch(_0x24ed69){_0x542274(-0x1f7,-0x1cd,-0x1a9,-0x1f0)===_0x542274(-0x1c4,-0x1b4,-0x1b8,-0x182)?_0x35724b(_0x43aff7):_0x442f8a(_0x24ed69);}},exports[_0x_0x5bea10(0x1d1,0x1a9,0x202,0x1fd)]=async(_0xc10787,_0xa8b9bc,_0x31b166)=>{function _0x5ef716(_0x1a7909,_0x367b95,_0x12864c,_0x6a3932){return _0x_0x5bea10(_0x367b95-0x26e,_0x367b95-0x10,_0x12864c-0xed,_0x12864c);}function _0x4d5a52(_0x1a2c99,_0x2a7ff6,_0x31c41a,_0x3885bd){return _0x_0x2a169f(_0x1a2c99-0x130,_0x2a7ff6-0x8d,_0x1a2c99,_0x2a7ff6- -0x162);}try{const {id:_0x39f32f}=_0xc10787[_0x4d5a52(0x258,0x22a,0x219,0x203)],_0x507746=await Gallery[_0x5ef716(0x3f7,0x3e3,0x3d9,0x3f0)](_0x39f32f,{'include':[{'model':GalleryImage,'as':_0x5ef716(0x41d,0x404,0x3fa,0x3dc)}]});if(!_0x507746){if(_0x4d5a52(0x21a,0x24c,0x25c,0x238)===_0x4d5a52(0x244,0x24c,0x21c,0x232))return _0xa8b9bc[_0x4d5a52(0x256,0x254,0x232,0x241)](-0x490*0x6+0x77*-0xa+-0x2e*-0xbb)[_0x5ef716(0x409,0x410,0x401,0x417)]({'success':![],'message':_0x4d5a52(0x236,0x25f,0x27d,0x279)});else console['error'](_0x4d5a52(0x247,0x236,0x23a,0x202),_0x183042);}const _0x3a3db7=path[_0x4d5a52(0x242,0x22e,0x1f9,0x25a)](__dirname,_0x5ef716(0x43b,0x44c,0x437,0x47a),_0x39f32f['toString']());try{await fs['rm'](_0x3a3db7,{'recursive':!![],'force':!![]});}catch(_0x47f7d0){_0x4d5a52(0x29c,0x282,0x292,0x2a3)!=='lqMCL'?console[_0x5ef716(0x3ec,0x402,0x42b,0x433)](_0x5ef716(0x3dc,0x3f0,0x414,0x3d8),_0x47f7d0):_0x32d35c(_0x4c86d1);}await _0x507746['destroy'](),_0xa8b9bc[_0x4d5a52(0x221,0x256,0x243,0x242)]({'success':!![],'message':'图册删除成功'});}catch(_0x43bf33){if('iVYTu'===_0x4d5a52(0x215,0x241,0x228,0x275))_0x31b166(_0x43bf33);else return _0x28ba56[_0x4d5a52(0x229,0x254,0x241,0x281)](-0x7fa+-0x7*-0x3e7+-0x11c3)[_0x4d5a52(0x25b,0x256,0x255,0x236)]({'success':![],'message':_0x4d5a52(0x242,0x25f,0x27f,0x243)});}},exports[_0x_0x2a169f(0x3c4,0x3eb,0x39b,0x3c6)]=async(_0x32c31e,_0x1449a3,_0x391301)=>{function _0x3cddde(_0x1130f0,_0x5a0ca6,_0x3cdcd6,_0xc90180){return _0x_0x5bea10(_0xc90180-0x271,_0x5a0ca6-0x1a7,_0x3cdcd6-0x15a,_0x3cdcd6);}function _0x4fb0c3(_0x5d4e75,_0x30d27a,_0x8be42,_0x370ade){return _0x_0x5bea10(_0x30d27a- -0x5a,_0x30d27a-0x118,_0x8be42-0x1d0,_0x5d4e75);}try{const {id:_0x265406}=_0x32c31e[_0x4fb0c3(0x150,0x11c,0x135,0x105)],_0x5d66b3=_0x32c31e['files'];if(!_0x5d66b3||_0x5d66b3['length']===0x3*-0x85a+0x2337+-0x33*0x33)return _0x1449a3[_0x4fb0c3(0x164,0x146,0x114,0x173)](0x1*0x703+-0x7b6+0xc1*0x3)[_0x3cddde(0x40e,0x419,0x413,0x413)]({'success':![],'message':_0x4fb0c3(0x15b,0x15a,0x134,0x151)});const _0xd2eb4a=await Gallery[_0x3cddde(0x3fa,0x3b3,0x3fe,0x3e6)](_0x265406);if(!_0xd2eb4a)return _0x1449a3[_0x3cddde(0x3f0,0x3f5,0x40a,0x411)](-0x551*0x1+-0x9f1*0x1+0x86b*0x2)[_0x3cddde(0x42c,0x40a,0x3f2,0x413)]({'success':![],'message':_0x3cddde(0x426,0x401,0x405,0x41c)});const _0x573dcc=await GalleryImage[_0x4fb0c3(0x16b,0x14b,0x181,0x157)](_0x3cddde(0x3f0,0x443,0x438,0x412),{'where':{'gallery_id':_0x265406}})||0x59*0x3d+0x13fd+0x2932*-0x1,_0x746108=_0x5d66b3[_0x3cddde(0x454,0x454,0x45a,0x44a)]((_0x345f56,_0x1f0295)=>{function _0x447772(_0x1858b5,_0x3fe759,_0x4edd68,_0x1ced88){return _0x4fb0c3(_0x1858b5,_0x1ced88- -0xb7,_0x4edd68-0x7,_0x1ced88-0x154);}let _0x11fb98;if(_0x345f56[_0x22ebe5(0x13d,0x122,0x11d,0x109)])_0x11fb98=_0x345f56['s3Url'];else{_0x11fb98=_0x345f56['path'][_0x22ebe5(0xe1,0xee,0x115,0xeb)](/\\/g,'/');const _0x52691e=_0x11fb98[_0x447772(0x8d,0xa7,0xa2,0xbc)](_0x22ebe5(0x139,0x163,0x133,0x13e));_0x52691e!==-(0xa60+-0x1039*0x1+0x5da)&&(_0x11fb98=_0x11fb98[_0x22ebe5(0xd0,0x115,0xe7,0xc0)](_0x52691e));}function _0x22ebe5(_0xd7a88b,_0x40d258,_0xaa970b,_0x3657fa){return _0x4fb0c3(_0xd7a88b,_0xaa970b- -0x4a,_0xaa970b-0xf2,_0x3657fa-0x104);}return{'gallery_id':_0x265406,'filename':_0x345f56[_0x22ebe5(0x10f,0x10e,0x12c,0x15d)],'path':_0x11fb98,'sort_order':_0x573dcc+_0x1f0295+(-0x5*-0x55b+0x1*0x1931+-0x33f7),'size':_0x345f56['size']};}),_0x236cc4=await GalleryImage[_0x3cddde(0x430,0x430,0x414,0x40a)](_0x746108),_0x1f0026=await GalleryImage[_0x4fb0c3(0x194,0x160,0x173,0x158)]({'where':{'gallery_id':_0x265406}}),_0x20c659=await GalleryImage[_0x4fb0c3(0x163,0x14d,0x11a,0x134)]({'where':{'gallery_id':_0x265406},'order':[[_0x4fb0c3(0x132,0x147,0x173,0x171),_0x4fb0c3(0x184,0x16b,0x13e,0x19d)]]});await _0xd2eb4a[_0x3cddde(0x45c,0x475,0x460,0x44e)]({'image_count':_0x1f0026,'cover_image':_0x20c659?_0x20c659[_0x3cddde(0x3e0,0x3dc,0x3fb,0x3e9)]:null}),_0x1449a3[_0x3cddde(0x445,0x3ea,0x3dd,0x413)]({'success':!![],'message':'图片上传成功','data':_0x236cc4});}catch(_0x263210){_0x391301(_0x263210);}},exports[_0x_0x2a169f(0x3a4,0x3c6,0x39b,0x3c7)]=async(_0x1d5e6b,_0x494671,_0x58576a)=>{function _0x3eed02(_0x3f8a94,_0x10ab0e,_0x24c18b,_0x11b7bb){return _0x_0x5bea10(_0x11b7bb- -0x431,_0x10ab0e-0x159,_0x24c18b-0x1a9,_0x3f8a94);}function _0x5d2d89(_0x1ba4b4,_0x1d954e,_0x33abcd,_0x27ab0d){return _0x_0x2a169f(_0x1ba4b4-0x3d,_0x1d954e-0xb1,_0x1ba4b4,_0x1d954e- -0xf2);}try{const {id:_0x54b004,imageId:_0x1d7ee8}=_0x1d5e6b[_0x3eed02(-0x2a7,-0x2e1,-0x2c2,-0x2bb)],_0x3e1ae3=await GalleryImage[_0x3eed02(-0x2bb,-0x279,-0x2bc,-0x28a)]({'where':{'id':_0x1d7ee8,'gallery_id':_0x54b004}});if(!_0x3e1ae3)return _0x494671[_0x5d2d89(0x2ce,0x2c4,0x2a9,0x2f8)](0x46*0x18+-0x16c5+0x11c9)['json']({'success':![],'message':_0x3eed02(-0x230,-0x295,-0x285,-0x262)});try{const _0x202f88=path[_0x3eed02(-0x2c7,-0x2b2,-0x2c6,-0x2b7)](__dirname,_0x5d2d89(0x2f1,0x2c8,0x2ed,0x2be),_0x3e1ae3[_0x3eed02(-0x2d1,-0x2b3,-0x2d1,-0x2b9)]);await fs[_0x3eed02(-0x26f,-0x283,-0x27c,-0x273)](_0x202f88);}catch(_0x5da2ba){console[_0x3eed02(-0x2a2,-0x29f,-0x2b8,-0x29d)](_0x3eed02(-0x2a0,-0x292,-0x27f,-0x27a),_0x5da2ba);}await _0x3e1ae3['destroy']();const _0x29b7b9=await Gallery[_0x5d2d89(0x290,0x299,0x29b,0x28d)](_0x54b004),_0x38c3bb=await GalleryImage[_0x3eed02(-0x294,-0x28c,-0x25b,-0x277)]({'where':{'gallery_id':_0x54b004}}),_0x3e2c66=await GalleryImage[_0x5d2d89(0x2fc,0x2cb,0x301,0x2c5)]({'where':{'gallery_id':_0x54b004},'order':[[_0x5d2d89(0x2b7,0x2c5,0x2b8,0x2ec),_0x3eed02(-0x277,-0x25f,-0x288,-0x26c)]]});await _0x29b7b9['update']({'image_count':_0x38c3bb,'cover_image':_0x3e2c66?_0x3e2c66[_0x5d2d89(0x2b9,0x29c,0x2d0,0x2c6)]:null}),_0x494671[_0x5d2d89(0x2f7,0x2c6,0x2b3,0x2f3)]({'success':!![],'message':'图片删除成功'});}catch(_0x3ac17f){_0x58576a(_0x3ac17f);}},exports[_0x_0x5bea10(0x1c2,0x1e7,0x1e4,0x1ac)]=async(_0x3abc88,_0x1de9d2,_0xd92d47)=>{function _0x555942(_0x691ce,_0x2a95f3,_0x4da04c,_0x88310c){return _0x_0x2a169f(_0x691ce-0x36,_0x2a95f3-0x37,_0x2a95f3,_0x691ce- -0x2ce);}function _0x4904ef(_0x186e03,_0xc5ac64,_0x44b950,_0x366c84){return _0x_0x2a169f(_0x186e03-0x5d,_0xc5ac64-0x123,_0xc5ac64,_0x186e03- -0x6a5);}try{const {id:_0x52159e}=_0x3abc88[_0x4904ef(-0x319,-0x2ea,-0x30e,-0x344)],{imageOrders:_0x5eb1bb}=_0x3abc88['body'];if(!_0x5eb1bb||!Array['isArray'](_0x5eb1bb)){if(_0x4904ef(-0x2dc,-0x2a7,-0x2ec,-0x2b6)===_0x4904ef(-0x2e3,-0x2c8,-0x2fe,-0x2d9)){_0x3e9067=_0x26d2ce[_0x4904ef(-0x317,-0x30b,-0x344,-0x320)]['replace'](/\\/g,'/');const _0x47f610=_0x2386ee[_0x4904ef(-0x2c2,-0x2d7,-0x293,-0x2f3)](_0x555942(0x11f,0x121,0xfe,0x11f));_0x47f610!==-(-0x52a+-0x94b+0xe76)&&(_0x3c280f=_0x2afc4b[_0x555942(0xd3,0xb0,0xae,0xa8)](_0x47f610));}else return _0x1de9d2[_0x555942(0xe8,0xb8,0xea,0xed)](-0x2234+0x686+0x1d3e)[_0x555942(0xea,0x100,0xf3,0xd4)]({'success':![],'message':_0x555942(0x10c,0xe6,0x13b,0x100)});}await Promise['all'](_0x5eb1bb[_0x4904ef(-0x2b6,-0x2ca,-0x2da,-0x2cc)](({id:_0xe65bcc,sort_order:_0x4c5740})=>GalleryImage[_0x4904ef(-0x2b2,-0x2a9,-0x2a6,-0x2d1)]({'sort_order':_0x4c5740},{'where':{'id':_0xe65bcc,'gallery_id':_0x52159e}})));const _0x5bdb5e=await Gallery[_0x4904ef(-0x31a,-0x34f,-0x32e,-0x2e9)](_0x52159e),_0x1a8aeb=await GalleryImage[_0x555942(0xef,0xbf,0xd4,0xc3)]({'where':{'gallery_id':_0x52159e},'order':[[_0x4904ef(-0x2ee,-0x2fd,-0x2c9,-0x313),_0x555942(0x10d,0x10b,0xda,0x12c)]]});await _0x5bdb5e[_0x555942(0x125,0x131,0x119,0xfd)]({'cover_image':_0x1a8aeb?_0x1a8aeb[_0x555942(0xc0,0xd0,0x97,0xbb)]:null}),_0x1de9d2[_0x555942(0xea,0xe9,0xce,0x111)]({'success':!![],'message':'排序更新成功'});}catch(_0x17614b){_0xd92d47(_0x17614b);}};function _0x_0x5bea10(_0x40c05c,_0xd1380a,_0x5ac8e8,_0x57b704){return _0x_0x2448(_0x40c05c-0xe8,_0x57b704);}exports['updateGalleryOrder']=async(_0x3e9e41,_0x12cc9d,_0x2ad6b8)=>{function _0x1bc23a(_0x372990,_0x49bbcf,_0x5d668d,_0x1f486e){return _0x_0x2a169f(_0x372990-0x166,_0x49bbcf-0x1b6,_0x372990,_0x1f486e- -0x1b7);}function _0x103fa6(_0x36a9e2,_0x5b4527,_0x542039,_0x3f3525){return _0x_0x5bea10(_0x542039-0x97,_0x5b4527-0x1f,_0x542039-0x96,_0x3f3525);}try{if(_0x103fa6(0x21d,0x25a,0x234,0x20f)==='isBOI')return _0x11f6e7['status'](0x1*-0xb8+0x1a9e+-0x1bd*0xe)[_0x1bc23a(0x1d8,0x1d9,0x1f6,0x201)]({'success':![],'message':'没有上传文件'});else{const {galleryOrders:_0x25f6d2}=_0x3e9e41[_0x103fa6(0x232,0x268,0x260,0x237)];if(!_0x25f6d2||!Array[_0x1bc23a(0x212,0x1d2,0x1b7,0x1e4)](_0x25f6d2))return _0x12cc9d[_0x103fa6(0x242,0x267,0x237,0x212)](-0x1*-0x1c90+0x6de+-0x21de)[_0x1bc23a(0x208,0x232,0x210,0x201)]({'success':![],'message':_0x1bc23a(0x246,0x204,0x247,0x223)});await Promise[_0x1bc23a(0x215,0x242,0x240,0x21b)](_0x25f6d2[_0x103fa6(0x29c,0x276,0x270,0x249)](({id:_0x49b01d,sort_order:_0x3909b4})=>Gallery[_0x103fa6(0x243,0x294,0x274,0x267)]({'sort_order':_0x3909b4},{'where':{'id':_0x49b01d}}))),_0x12cc9d[_0x1bc23a(0x1dd,0x206,0x1fd,0x201)]({'success':!![],'message':_0x103fa6(0x22c,0x236,0x24d,0x221)});}}catch(_0x532aa6){_0x2ad6b8(_0x532aa6);}},module[_0x_0x2a169f(0x399,0x3aa,0x393,0x3a8)]=exports;